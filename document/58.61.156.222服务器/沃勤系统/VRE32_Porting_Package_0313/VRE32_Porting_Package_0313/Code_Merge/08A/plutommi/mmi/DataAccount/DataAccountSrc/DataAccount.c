/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * DataAccount.c
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   This file is intends for ¡K.
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/

 /**
 * Copyright Notice
 * ?2002 - 2003, Pixtel Communications, Inc., 1489 43rd Ave. W.,
 * Vancouver, B.C. V6M 4K8 Canada. All Rights Reserved.
 *  (It is illegal to remove this copyright notice from this software or any
 *  portion of it)
 */

#ifdef __TCPIP__

#include "DataAccountCommon.h"
#include "ProtocolEvents.h"
#include "PhoneBookTypes.h"

#include "SimDetectionGexdcl.h"
#include "abm_soc_enums.h"
#include "abm_util.h"
#include "ConnectManageResDef.h"

#if defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__)
#include "CentralConfigAgentGProt.h"
/*
#include "CentralConfigAgentDefs.h"
#include "CentralConfigAgentConst.h"
*/
#include "cbfunc.h"

extern void mmi_dm_set_check_function(dm_setting_type_enum type, DMCheckCBFunc func);
#endif /* defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__) */

#include "ConnectManageGprot.h"

#ifdef __MMI_CBM_CONNECTION_MANAGER__
extern U8 g_cbm_dtcnt_init_status;
#endif /* __MMI_CBM_CONNECTION_MANAGER__ */
extern wgui_inline_item wgui_inline_items[];
extern void mmi_frm_add_history_before_cm_marker(U16 scrn_id, FuncPtr func_ptr);

void (*g_DTCNTReadyCallback) (void) = NULL;
DataAccountNode g_DataAccount[MAX_DATA_ACCOUNT_GSM_LIMIT + 1]; /* add a sim account */
/* Vogins Start */
#ifdef __VRE__
DataAccountNodeDisplay g_DataAccount_Display;
#else
static DataAccountNodeDisplay g_DataAccount_Display;
#endif
/* Vogins End */
mmi_dtcnt_account_selection_struct g_mmi_dtcnt_account_selection;
mmi_dtcnt_always_ask_struct g_mmi_dtcnt_always_ask;
mmi_dtcnt_select_account_option_struct  g_mmi_dtcnt_select_account;

BOOL mmi_dtcnt_check_UCS2(U16 *buf, U16 charNum);

#define MMI_DTCNT_INVALID_ID (0x00003e3e)   /* (cbm_encode_data_account_id(CBM_INVALID_NWK_ACCT_ID, CBM_SIM_ID_SIM1, 0, 0)) */
#define MMI_DTCNT_DEFAULT_ID (0x00003e00)

static void mmi_dtcnt_list_callback_csd(U32 index);
#ifdef __MMI_GPRS_FEATURES__
static void mmi_dtcnt_list_callback_gprs(U32 index);
#endif /* __MMI_GPRS_FEATURES__ */

#ifdef __MMI_WLAN_FEATURES__
static void mmi_dtcnt_list_callback_wifi(U32 index);
#endif /* __MMI_WLAN_FEATURES__ */
static void mmi_ps_dtcnt_list_ind_handler(void *info);
static void mmi_dtcnt_send_msg2ps(void);
static void mmi_ps_dtcnt_main_list(void);
static void mmi_dtcnt_list_highlight_hdlr(S32 nIndex);
static void mmi_dtcnt_list_show(void);
#ifdef __MMI_CBM_ALWAYS_ASK__
static void mmi_dtcnt_list_callback_always_ask(U32 index);
#endif /* __MMI_CBM_ALWAYS_ASK__ */
static U8 mmi_dtcnt_list_check_app_para(void);

#ifdef __MMI_GPRS_FEATURES__
static void mmi_dtcnt_list_by_app_confirm(U16 msg, FuncPtr lskFuncPtr);
static void mmi_dtcnt_list_confirm(void);
static void mmi_dtcnt_list_by_app_confirm_gprs(void);
static void mmi_dtcnt_list_by_app_confirm_csd(void);
#endif /* __MMI_GPRS_FEATURES__ */

static void mmi_dtcnt_list_go_back_gprs(void);

#ifdef __MMI_GPRS_FEATURES__
static void mmi_dtcnt_list_back_handler(void);
#endif /* __MMI_GPRS_FEATURES__ */

static void mmi_dtcnt_csd_viewer_highlight_hdlr(S32 nIndex);
static void mmi_dtcnt_csd_viewer(void);
#ifdef __MMI_GPRS_FEATURES__
static void mmi_dtcnt_gprs_viewer_highlight_hdlr(S32 nIndex);
static void mmi_dtcnt_gprs_viewer(void);
#endif /* __MMI_GPRS_FEATURES__ */
static void mmi_dtcnt_show_an_account_req(U8 bearer_type, U8 profile_type, U8 sim_id, U8 profile_id);
static void mmi_dtcnt_show_an_account_rsp(void *info);
static void mmi_dtcnt_switch_acct_view(void);
static void mmi_dtcnt_display_one_acct(void);

#define DTCNT_LIST_BEARER_CSD   0
#define DTCNT_LIST_BEARER_GPRS  1

#ifdef __MMI_GPRS_FEATURES__

#if 0
#ifdef __MMI_OP01_GPRS_DATACFG__
/* under construction !*/
#else /* __MMI_OP01_GPRS_DATACFG__ */
/* under construction !*/
#endif /* __MMI_OP01_GPRS_DATACFG__ */
#endif /* 0 */
GPRSDataAccountNode g_GPRS_DataAccount[MAX_DATA_ACCOUNT_GPRS_LIMIT + 1]; /* add a sim account */

#endif /* __MMI_GPRS_FEATURES__ */ 
/*
 * decalaration for data account
 * fallback bearer selection
 */
static void mmi_dtcnt_entry_select_bearers_switch_account_opt(void);
static void mmi_dtcnt_entry_select_account_without_bearer_switch(void);
static void mmi_dtcnt_entry_select_bearers_switch_account(void);
static void mmi_dtcnt_entry_select_bearers_switch_account_highlight_hdlr(S32 nIndex);
static void mmi_dtcnt_select_primary_account(void);
static void mmi_dtcnt_primary_account_callback_hdlr(U32 primary_id);
static void mmi_dtcnt_select_bearers_account_option_done(void);
static void mmi_dtcnt_select_secondary_account(void);
static void mmi_dtcnt_secondary_account_callback_hdlr(U32 secondary_id);
static void mmi_dtcnt_select_secondary_account_none(void);
static void mmi_dtcnt_select_secondary_account_option_edit(FuncPtrU32 callback, 
                                                        U16 AppMenuID, 
                                                        U8 bearers, 
                                                        dtcnt_select_type_enum sim_info, 
                                                        dtcnt_select_type_enum always_ask,
                                                        U32 account_id);
/* end of fallback-bearer selection */

typedef struct
{
    U8 bearer;
    U8 bearer_enum;
    U16 name;
    FuncPtr func;
} dtcnt_select_op_struct;

typedef struct 
{
    U16   appid;              /* appid */
    U32   bearer_scrope;     /* bearer type */
    U32   bearer_type[2];
    U16   menu_id;            /* menu id */
    U8    num_id;
    U32  net_id[2];
    U8    sim_info;
    U8    app_id;
    U8    index;
    U8    highlight_csd;
    U8    highlight_gprs;
    U8    highlight_gprs_csd;
    U8    switch_bearer_flag;
    U8    gprs_bearer_flag;
    U8    csd_bearer_flag;
    U8    wifi_bearer_flag;
    U8    always_ask_flag;
    U8    entry_gprs_list_num;
    U8    bearer_list[DTCNT_LIST_BEARER_TOTAL];
    U16   curr_msg;
    FuncPtr curr_lskFuncPtr;
    U32    src_mod;
} dtcnt_list_by_app_struct;

dtcnt_list_by_app_struct g_dtcnt_list_cnt;

void mmi_dtcnt_entry_account_select(void);
void mmi_dtcnt_account_select_highlight_hdlr(S32 nIndex);
void mmi_dtcnt_always_ask_account_select_highlight_hdlr(S32 nIndex);
void mmi_dtcnt_account_sim_select_highlight_hdlr(S32 nIndex);

void mmi_dtcnt_account_select_ok(void);
void mmi_dtcnt_account_bearer_select_ok(void);
void mmi_dtcnt_always_ask_select_ok(void);

void mmi_dtcnt_select_account_entry_option(void);
void mmi_dtcnt_select_account_entry_option_ext(void);
U16 mmi_dtcnt_is_sim_valid(void);

U8 g_sim_info;
U8 g_always_ask_sim_info;
U8 g_entry_option_back_flag;
U8 g_bearer_num_flag;

static void mmi_dtcnt_always_ask_entry_account_select_ext(void);
static void mmi_dtcnt_always_ask_select_sim1(void);
static void mmi_dtcnt_always_ask_select_sim2(void);
static void mmi_dtcnt_entry_account_select_ext(void);
static void mmi_dtcnt_select_sim1(void);
static void mmi_dtcnt_select_sim2(void);

#ifdef __MMI_CBM_ALWAYS_ASK__
static void mmi_dtcnt_always_ask(void);
extern void mmi_wlan_entry_network_settings_ext(void);
#endif /* __MMI_CBM_ALWAYS_ASK__ */

extern void mmi_always_ask_delete_screen(void);

extern pBOOL mmi_bootup_is_sim_valid(void);
#if defined(__MMI_DUAL_SIM_MASTER__)	
extern pBOOL mmi_bootup_is_sim2_valid(void);
#endif /* __MMI_DUAL_SIM_MASTER__ */

U8 g_entry_option_back_flag;
U8 g_always_ask_screen_del_handler_flag;

#ifdef __MMI_GPRS_FEATURES__
static void mmi_dtcnt_select_account_gprs_back(void);
#endif /* __MMI_GPRS_FEATURES__ */

static void mmi_dtcnt_always_ask_cancel(void);

U8 mmi_dtcnt_always_ask_screen_del_handler(void *in_param);

#ifdef __MMI_WLAN_FEATURES__
extern U8 g_wlan_highlight_index;
#endif /* __MMI_WLAN_FEATURES__ */
extern U16 simErrorDisplayString;
extern void InitAlwaysAsk(void);

extern void mmi_dtcnt_account_view(U32 acct_id);
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_pre_entry_app_csd_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_pre_entry_app_csd_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DataAccountReadyCheck(EntryAppDTCNTList);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_pre_entry_app_csd_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_pre_entry_app_csd_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DataAccountReadyCheck(mmi_dtcnt_always_ask_entry_csd_list);
}

#ifdef __MMI_OP01_DCD__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_dcd_acct_id
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U32 mmi_dtcnt_get_dcd_acct_id(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return abm_get_dcd_total_bearer();
}
#endif /* __MMI_OP01_DCD__ */

#ifdef __MMI_GPRS_FEATURES__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_pre_entry_app_gprs_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_pre_entry_app_gprs_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DataAccountReadyCheck(EntryGPRSAppDTCNTList);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_pre_entry_app_gprs_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_pre_entry_app_gprs_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DataAccountReadyCheck(mmi_dtcnt_always_ask_entry_gprs_list);
}

#endif /* __MMI_GPRS_FEATURES__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_app_wlan_select
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_app_wlan_select(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_dtcnt_account_selection.app_callback)
    {
        kal_uint32 id;
        abm_bearer2nw_id(ABM_E_SOCKET_BEARER_WIFI, 0, &id);
        g_mmi_dtcnt_account_selection.app_callback((U16) id);
        g_mmi_dtcnt_account_selection.app_callback = NULL;
    }
}

#ifdef __MMI_WLAN_FEATURES__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_app_wlan_select_ext
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_app_wlan_select_ext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_dtcnt_account_selection.app_callback)
    {
        kal_uint32 id;
        abm_bearer2nw_id(ABM_E_SOCKET_BEARER_WIFI, 0, &id);
        g_mmi_dtcnt_account_selection.app_callback((U16) id);
        g_mmi_dtcnt_account_selection.app_callback = NULL;
    }
    else
    {
        MMI_ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_always_ask_wlan_select_ext
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_wlan_select_ext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_dtcnt_always_ask.app_callback_ext)
    {
        if (g_wlan_display_context.state == WLAN_STATE_CONNECT_WAIT)
        {/* block connection initiated by always-ask if previous connection is suspending */
            DisplayPopup(
                (PU8) GetString(STR_GLOBAL_BUSY_TRY_LATER),
                IMG_GLOBAL_ERROR,
                1,
                DATA_ACCOUNT_NOTIFY_TIMEOUT,
                ERROR_TONE);
        }
        else
        {
            mmi_wlan_entry_network_settings_ext();
        }
    }
    else
    {
        MMI_ASSERT(0);
    }
}

#endif /* __MMI_WLAN_FEATURES__ */


static dtcnt_select_op_struct g_dtcnt_selections[] = 
{
#ifdef __MMI_DUAL_SIM__

#ifdef __MMI_CBM_ALWAYS_ASK__
    {DATA_ACCOUNT_ALWAYS_ASK, DATA_ACCOUNT_ALWAYS_ASK, STR_ID_DTCNT_ALWAYS_ASK,
        mmi_dtcnt_always_ask},
#endif /*__MMI_CBM_ALWAYS_ASK__*/
    {DATA_ACCOUNT_SIM1, DATA_ACCOUNT_SIM1, STR_ID_DTCNT_SIM1,
    mmi_dtcnt_select_sim1},
    {DATA_ACCOUNT_SIM2, DATA_ACCOUNT_SIM2, STR_ID_DTCNT_SIM2,
    mmi_dtcnt_select_sim2},
#ifdef __MMI_WLAN_FEATURES__
    {DATA_ACCOUNT_BEARER_WIFI, ABM_E_SOCKET_BEARER_WIFI, SERVICES_DATA_CONNECT_WLAN_STRING_ID,
    mmi_dtcnt_app_wlan_select},
#endif /* __MMI_WLAN_FEATURES__ */ 
    {0, 0, 0, NULL}

#else /* __MMI_DUAL_SIM__ */

#ifdef __MMI_CBM_ALWAYS_ASK__
    {DATA_ACCOUNT_ALWAYS_ASK, DATA_ACCOUNT_ALWAYS_ASK, STR_ID_DTCNT_ALWAYS_ASK,
        mmi_dtcnt_always_ask},
#endif /*__MMI_CBM_ALWAYS_ASK__*/
    {DATA_ACCOUNT_BEARER_CSD, ABM_E_SOCKET_BEARER_GSM_CSD, SERVICES_DATA_CONNECT_GSM_STRING_ID,
     mmi_dtcnt_pre_entry_app_csd_list},
 #ifdef __MMI_GPRS_FEATURES__
    {DATA_ACCOUNT_BEARER_GPRS, ABM_E_SOCKET_BEARER_GSM_GPRS, SERVICES_DATA_CONNECT_GPRS_STRING_ID,
     mmi_dtcnt_pre_entry_app_gprs_list},
 #endif /* __MMI_GPRS_FEATURES__ */ 
 #ifdef __MMI_WLAN_FEATURES__
    {DATA_ACCOUNT_BEARER_WIFI, ABM_E_SOCKET_BEARER_WIFI, SERVICES_DATA_CONNECT_WLAN_STRING_ID,
     mmi_dtcnt_app_wlan_select},
 #endif /* __MMI_WLAN_FEATURES__ */ 
    {0, 0, 0, NULL}

#endif /* __MMI_DUAL_SIM__ */

};

static dtcnt_select_op_struct g_dtcnt_selections_ext_sim[] = 
{
    {DATA_ACCOUNT_INVALID_ID, DATA_ACCOUNT_INVALID_ID, STR_GLOBAL_NONE,
        mmi_dtcnt_select_secondary_account_none},    
#ifdef __MMI_CBM_ALWAYS_ASK__
    {DATA_ACCOUNT_ALWAYS_ASK, DATA_ACCOUNT_ALWAYS_ASK, STR_ID_DTCNT_ALWAYS_ASK,
        mmi_dtcnt_always_ask},
#endif /*__MMI_CBM_ALWAYS_ASK__*/
    {DATA_ACCOUNT_SIM1, DATA_ACCOUNT_SIM1, STR_ID_DTCNT_SIM1,
    mmi_dtcnt_select_sim1},
    {DATA_ACCOUNT_SIM2, DATA_ACCOUNT_SIM2, STR_ID_DTCNT_SIM2,
    mmi_dtcnt_select_sim2},
#ifdef __MMI_WLAN_FEATURES__
    {DATA_ACCOUNT_BEARER_WIFI, ABM_E_SOCKET_BEARER_WIFI, SERVICES_DATA_CONNECT_WLAN_STRING_ID,
    mmi_dtcnt_app_wlan_select_ext},
#endif /* __MMI_WLAN_FEATURES__ */ 
    {0, 0, 0, NULL}
};

static dtcnt_select_op_struct g_dtcnt_selections_ext[] = 
{
    {DATA_ACCOUNT_INVALID_ID, DATA_ACCOUNT_INVALID_ID, STR_GLOBAL_NONE,
        mmi_dtcnt_select_secondary_account_none},    
#ifdef __MMI_CBM_ALWAYS_ASK__
    {DATA_ACCOUNT_ALWAYS_ASK, DATA_ACCOUNT_ALWAYS_ASK, STR_ID_DTCNT_ALWAYS_ASK,
    mmi_dtcnt_always_ask},
#endif /*__MMI_CBM_ALWAYS_ASK__*/
    {DATA_ACCOUNT_BEARER_CSD, ABM_E_SOCKET_BEARER_GSM_CSD, SERVICES_DATA_CONNECT_GSM_STRING_ID,
    mmi_dtcnt_pre_entry_app_csd_list},
#ifdef __MMI_GPRS_FEATURES__
    {DATA_ACCOUNT_BEARER_GPRS, ABM_E_SOCKET_BEARER_GSM_GPRS, SERVICES_DATA_CONNECT_GPRS_STRING_ID,
    mmi_dtcnt_pre_entry_app_gprs_list},
#endif /* __MMI_GPRS_FEATURES__ */ 
#ifdef __MMI_WLAN_FEATURES__
    {DATA_ACCOUNT_BEARER_WIFI, ABM_E_SOCKET_BEARER_WIFI, SERVICES_DATA_CONNECT_WLAN_STRING_ID,
    mmi_dtcnt_app_wlan_select_ext},
#endif /* __MMI_WLAN_FEATURES__ */ 
    {0, 0, 0, NULL}
};

static dtcnt_select_op_struct g_dtcnt_selections_dual[] = 
{
    {DATA_ACCOUNT_BEARER_CSD, ABM_E_SOCKET_BEARER_GSM_CSD, SERVICES_DATA_CONNECT_GSM_STRING_ID,
        mmi_dtcnt_pre_entry_app_csd_list},
#ifdef __MMI_GPRS_FEATURES__
    {DATA_ACCOUNT_BEARER_GPRS, ABM_E_SOCKET_BEARER_GSM_GPRS, SERVICES_DATA_CONNECT_GPRS_STRING_ID,
    mmi_dtcnt_pre_entry_app_gprs_list},
#endif /* __MMI_GPRS_FEATURES__ */ 
    {0, 0, 0, NULL}
};


/*
 * Only for always-ask
 */
static dtcnt_select_op_struct g_dtcnt_always_ask_selections[] = 
{
    {DATA_ACCOUNT_BEARER_CSD, ABM_E_SOCKET_BEARER_GSM_CSD, SERVICES_DATA_CONNECT_GSM_STRING_ID,
    mmi_dtcnt_always_ask_pre_entry_app_csd_list},
#ifdef __MMI_GPRS_FEATURES__
    {DATA_ACCOUNT_BEARER_GPRS, ABM_E_SOCKET_BEARER_GSM_GPRS, SERVICES_DATA_CONNECT_GPRS_STRING_ID,
    mmi_dtcnt_always_ask_pre_entry_app_gprs_list},
#endif /* __MMI_GPRS_FEATURES__ */ 
#ifdef __MMI_WLAN_FEATURES__
    {DATA_ACCOUNT_BEARER_WIFI, ABM_E_SOCKET_BEARER_WIFI, SERVICES_DATA_CONNECT_WLAN_STRING_ID,
    mmi_dtcnt_always_ask_wlan_select_ext},
#endif /* __MMI_WLAN_FEATURES__ */ 
    {0, 0, 0, NULL}
};

static dtcnt_select_op_struct g_dtcnt_always_ask_selections_sim[] = 
{
    {DATA_ACCOUNT_SIM1, DATA_ACCOUNT_SIM1, STR_ID_DTCNT_SIM1,
    mmi_dtcnt_always_ask_select_sim1},
    {DATA_ACCOUNT_SIM2, DATA_ACCOUNT_SIM2, STR_ID_DTCNT_SIM2,
    mmi_dtcnt_always_ask_select_sim2},
#ifdef __MMI_WLAN_FEATURES__
    {DATA_ACCOUNT_BEARER_WIFI, ABM_E_SOCKET_BEARER_WIFI, SERVICES_DATA_CONNECT_WLAN_STRING_ID,
    mmi_dtcnt_always_ask_wlan_select_ext},
#endif /* __MMI_WLAN_FEATURES__ */ 
    {0, 0, 0, NULL}
};

static dtcnt_select_op_struct g_dtcnt_always_ask_selections_dual[] = 
{
    {DATA_ACCOUNT_BEARER_CSD, ABM_E_SOCKET_BEARER_GSM_CSD, SERVICES_DATA_CONNECT_GSM_STRING_ID,
        mmi_dtcnt_always_ask_pre_entry_app_csd_list},
#ifdef __MMI_GPRS_FEATURES__
    {DATA_ACCOUNT_BEARER_GPRS, ABM_E_SOCKET_BEARER_GSM_GPRS, SERVICES_DATA_CONNECT_GPRS_STRING_ID,
    mmi_dtcnt_always_ask_pre_entry_app_gprs_list},
#endif /* __MMI_GPRS_FEATURES__ */ 
    {0, 0, 0, NULL}
};
/* mmi_bootup_is_sim_valid */

/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_highlight_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
void mmi_dtcnt_select_highlight_handler(U32 acct_id, U8 bearers)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    kal_uint8 bearer;
    kal_uint8 id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (abm_nw2bearer_id(acct_id, &bearer, &id) == KAL_TRUE)
    {
        if ((bearers & DATA_ACCOUNT_BEARER_CSD) && (bearer == ABM_E_SOCKET_BEARER_GSM_CSD))
        {
            g_mmi_dtcnt_account_selection.CurrAppSelectItem = id;
        }
#ifdef __MMI_GPRS_FEATURES__
        else if((bearers & DATA_ACCOUNT_BEARER_GPRS) && (bearer == ABM_E_SOCKET_BEARER_GSM_GPRS))
        {
            g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = id - 1;
        }
#endif /* __MMI_GPRS_FEATURES__ */ 
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_bearer_type
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U8 mmi_dtcnt_get_bearer_type(U32 account_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    kal_uint8 bearer;
    kal_uint8 id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (abm_nw2bearer_id(account_id, &bearer, &id) == KAL_FALSE)
    {
        return 0; /* Invalid account id */
    }

    switch(bearer)
    {
        case ABM_E_SOCKET_BEARER_GSM_CSD:
            return DATA_ACCOUNT_BEARER_CSD;
            
        case ABM_E_SOCKET_BEARER_GSM_GPRS:
            return DATA_ACCOUNT_BEARER_GPRS;
            
        case ABM_E_SOCKET_BEARER_WIFI:
            return DATA_ACCOUNT_BEARER_WIFI;
    }
    return 0;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_first_account_id
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U32 mmi_dtcnt_get_first_account_id(U8 bearers)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 i, account_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (i = 0; g_dtcnt_selections_ext[i].bearer > 0; i++)
    {
        if (bearers & g_dtcnt_selections_ext[i].bearer)
        {
            /* Special case for GPRS */
            if (g_dtcnt_selections_ext[i].bearer_enum == ABM_E_SOCKET_BEARER_GSM_GPRS)
            {
                if (abm_bearer2nw_id(g_dtcnt_selections_ext[i].bearer_enum, 1, &account_id) == TRUE)
                {
                    return account_id;
                }
            }
            else
            {
                if (abm_bearer2nw_id(g_dtcnt_selections_ext[i].bearer_enum, 0, &account_id) == TRUE)
                {
                    return account_id;
                }
            }
        }
    }
    ASSERT(0);
    return 0xFF;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_account_ext
 * DESCRIPTION
 *  
 * PARAMETERS
 *  callback        [IN]        
 *  AppMenuID       [IN]        
 *  bearers         [IN]        
 *  account_id      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_select_account_ext(FuncPtrU32 callback, U16 AppMenuID, U8 bearers, U32 account_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#if !defined(__MMI_DUAL_SIM__)
    kal_uint8 bearer;
    kal_uint8 id;
    U8 i, count = 0;
    FuncPtr funcs[DATA_ACCOUNT_BEARER_TOTAL];
#endif /* !defined(__MMI_DUAL_SIM__) */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* g_mmi_dtcnt_account_selection.sel_acct_procedure = MMI_DTCNT_SELECT_SINGLE_ACCOUNT; */
    g_mmi_dtcnt_account_selection.app_callback = callback;
    g_mmi_dtcnt_account_selection.AppMenuID = AppMenuID;
    g_mmi_dtcnt_account_selection.CurrAppMainSelectItem = 0;
    g_mmi_dtcnt_account_selection.CurrAppSelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 
    g_mmi_dtcnt_account_selection.bearers = bearers;

#ifdef __MMI_DUAL_SIM__
    mmi_dtcnt_entry_account_select();
#else /* __MMI_DUAL_SIM__ */
    for (i = 0; g_dtcnt_selections[i].bearer > 0; i++)
    {
        if (bearers & g_dtcnt_selections[i].bearer)
        {
            funcs[count++] = g_dtcnt_selections[i].func;
        }
    }
#ifdef __MMI_WLAN_FEATURES__
    if(count == 1)
    {
        if((mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY) &&
            ((bearers == DATA_ACCOUNT_BEARER_CSD)||(bearers == DATA_ACCOUNT_BEARER_GPRS)))
        {
            DisplayPopup((PU8) GetString(STR_GLOBAL_NOT_DONE), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
            return;
        }
    }
#endif /* __MMI_WLAN_FEATURES__ */
    if (abm_nw2bearer_id(account_id, &bearer, &id) == KAL_TRUE)
    {
        if ((bearers & DATA_ACCOUNT_BEARER_CSD) && (bearer == ABM_E_SOCKET_BEARER_GSM_CSD))
        {
            g_mmi_dtcnt_account_selection.CurrAppSelectItem = id;
        }
#ifdef __MMI_GPRS_FEATURES__
        else if((bearers & DATA_ACCOUNT_BEARER_GPRS) && (bearer == ABM_E_SOCKET_BEARER_GSM_GPRS))
        {
            g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = id - 1;
        }
#endif /* __MMI_GPRS_FEATURES__ */ 
    }

    if (count == 1)
    {
        funcs[0] ();
        return;
    }
    mmi_dtcnt_entry_account_select();
#endif /* __MMI_DUAL_SIM__ */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_account
 * DESCRIPTION
 *  
 * PARAMETERS
 *  callback        [IN]        
 *  AppMenuID       [IN]        
 *  bearers         [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_select_account(FuncPtrU32 callback, U16 AppMenuID, U8 bearers)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_dtcnt_select_account_ext(callback, AppMenuID, bearers, 0);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_apn
 * DESCRIPTION
 *  
 * PARAMETERS
 *  account_id      [IN]        
 *  dest            [OUT]         
 *  len             [IN]        
 * RETURNS
 *  
 *****************************************************************************/
BOOL mmi_dtcnt_get_apn(U32 account_id, S8 *dest, U8 len)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_GPRS_FEATURES__
    kal_uint8 bearer;
    kal_uint8 id;   /* dummy */
    U8 length;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_GPRS_FEATURES__
    return FALSE;
#else /* __MMI_GPRS_FEATURES__ */
    if(!dest)
    {
        return FALSE;
    }
    
    length = (len < (MAX_GPRS_MMI_APN_LEN+ 1) * ENCODING_LENGTH) ? len : (MAX_GPRS_MMI_APN_LEN + 1) * ENCODING_LENGTH;
        
    if (abm_nw2bearer_id(account_id, &bearer, &id) == KAL_TRUE)
    {
        if(bearer == ABM_E_SOCKET_BEARER_GSM_GPRS)
        {
            mmi_ucs2ncpy(dest, (S8*) g_GPRS_DataAccount[id - 1].APN, length);
            return TRUE;
        }
    }
    memset(dest, 0, len);
    return FALSE;
#endif /* __MMI_GPRS_FEATURES__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_csd_number
 * DESCRIPTION
 *  
 * PARAMETERS
 *  account_id      [IN]        
 *  dest            [OUT]         
 *  len             [IN]        
 * RETURNS
 *  
 *****************************************************************************/
BOOL mmi_dtcnt_get_csd_number(U32 account_id, S8 *dest, U8 len)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    kal_uint8 bearer;
    kal_uint8 id;   /* dummy */
    U8 length;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(!dest)
    {
        return FALSE;
    }
    
    length = (len < (MAX_DIAL_NUM_LEN+ 1) * ENCODING_LENGTH) ? len : (MAX_DIAL_NUM_LEN + 1) * ENCODING_LENGTH;
        
    if (abm_nw2bearer_id(account_id, &bearer, &id) == KAL_TRUE)
    {
        if(bearer == ABM_E_SOCKET_BEARER_GSM_CSD)
        {
            mmi_ucs2ncpy(dest, (S8*) g_DataAccount[id].DialNumber, length);
            return TRUE;
        }
    }
    memset(dest, 0, len);
    return FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_account_name
 * DESCRIPTION
 *  Display bearers info included within a data-account ID.
 * PARAMETERS
 *  account_id      [IN]        
 *  dest            [OUT]         
 *  len             [IN]        
 * RETURNS
 *  
 *****************************************************************************/
BOOL mmi_dtcnt_get_account_name(U32 account_id, S8 *dest, U8 len)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    kal_uint8 bearer;
    kal_uint8 id;   /* dummy */
    U8 length =
        len <
        (MAX_DATA_ACCOUNT_NAME_LEN + 1) * ENCODING_LENGTH ? len : (MAX_DATA_ACCOUNT_NAME_LEN + 1) * ENCODING_LENGTH;
    cbm_account_info_struct *acct_info_ptr = NULL;
    MMI_BOOL ret_val = MMI_TRUE;

    U8 sim_id = CBM_SIM_ID_SIM1;
    U8 bearer_type = ABM_E_SOCKET_BEARER_GSM_GPRS;
    U8 profile_id = 0;
    U8 profile_type = CBM_NVRAM_PROFILE;
#ifdef __MMI_SIM_PROVISIONING_SUPPORT__
    UI_character_type temp_num[] = L"1";
#endif /* __MMI_SIM_PROVISIONING_SUPPORT__ */
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(dest == NULL)
    {
        return MMI_FALSE;
    }
    acct_info_ptr = OslMalloc(sizeof(cbm_account_info_struct));
    cbm_decode_data_account_id_ext(account_id, acct_info_ptr);
#ifdef __MMI_CBM_BEARER_FALLBACK__
    if (acct_info_ptr->acct_num > 1)
    {
        /* Primary Account */
    #ifdef __MMI_CBM_ALWAYS_ASK__
        if (acct_info_ptr->account[0].is_always_ask)
        {
            mmi_ucs2cpy((S8*)dest, (S8*)GetString(STR_ID_DTCNT_ALWAYS_ASK));
        }
        else 
    #endif /* __MMI_CBM_ALWAYS_ASK__ */
        {
            if (abm_nw2bearer_id((U32)acct_info_ptr->account[0].account_id, &bearer, &id))
            {
                switch (bearer)
                {
                    case ABM_E_SOCKET_BEARER_GSM_CSD:
                        mmi_ucs2cpy((S8*)dest, 
                            (S8*)GetString(SERVICES_DATA_CONNECT_GSM_STRING_ID));
                        break;
                #ifdef __MMI_GPRS_FEATURES__
                    case ABM_E_SOCKET_BEARER_GSM_GPRS:
                        mmi_ucs2cpy((S8*)dest, 
                            (S8*)GetString(SERVICES_DATA_CONNECT_GPRS_STRING_ID));
                        break;
                #endif /* __MMI_GPRS_FEATURES__ */ 
                #ifdef __MMI_WLAN_FEATURES__
                    case ABM_E_SOCKET_BEARER_WIFI:
                        mmi_ucs2cpy((S8*)dest, 
                            GetString(SERVICES_DATA_CONNECT_WLAN_STRING_ID));
                        break;
                #endif /* __MMI_WLAN_FEATURES__ */ 
                    default:
                        mmi_ucs2cpy((S8*)dest, 
                            (S8*)GetString(STR_GLOBAL_INVALID));
                        ret_val = MMI_FALSE;
                }
            }
            else
            {
                mmi_ucs2cpy((S8*)dest, (S8*)GetString(STR_GLOBAL_INVALID));
                ret_val = MMI_FALSE;
            }
        }
        /* Seperated by "/" */
        mmi_ucs2cat((S8*)dest, (S8*)(L"/"));
        /* Secondary Account */
    #ifdef __MMI_CBM_ALWAYS_ASK__
        if (acct_info_ptr->account[1].is_always_ask)
        {
            mmi_ucs2cat(dest, GetString(STR_ID_DTCNT_ALWAYS_ASK));
        }
        else 
    #endif /* __MMI_CBM_ALWAYS_ASK__ */
        {
            if (abm_nw2bearer_id(acct_info_ptr->account[1].account_id, &bearer, &id))
            {
                switch (bearer)
                {
                    case ABM_E_SOCKET_BEARER_GSM_CSD:
                        mmi_ucs2cat((S8*)dest, 
                            (S8*)GetString(SERVICES_DATA_CONNECT_GSM_STRING_ID));
                        break;
                #ifdef __MMI_GPRS_FEATURES__
                    case ABM_E_SOCKET_BEARER_GSM_GPRS:
                        mmi_ucs2cat((S8*)dest, 
                            (S8*)GetString(SERVICES_DATA_CONNECT_GPRS_STRING_ID));
                        break;
                #endif /* __MMI_GPRS_FEATURES__ */ 
                #ifdef __MMI_WLAN_FEATURES__
                    case ABM_E_SOCKET_BEARER_WIFI:
                        mmi_ucs2cat((S8*)dest, 
                            GetString(SERVICES_DATA_CONNECT_WLAN_STRING_ID));
                        break;
                #endif /* __MMI_WLAN_FEATURES__ */ 
                    default:
                        mmi_ucs2cpy((S8*)dest, (S8*)GetString(STR_GLOBAL_INVALID));
                        ret_val = MMI_FALSE;
                }
            }
            else
            {
                mmi_ucs2cpy((S8*)dest, (S8*)GetString(STR_GLOBAL_INVALID));
                ret_val = MMI_FALSE;
            }
        }        
    }
    else /* acct_info_ptr->acct_num == 1 */
#endif /* __MMI_CBM_BEARER_FALLBACK__ */
    {
        cbm_get_profile_info_by_account_id(account_id, &profile_type, &bearer_type, &profile_id);
        sim_id = cbm_get_sim_info_data_account(account_id);
        if (MMI_FALSE)
        {
        }
    #ifdef __MMI_CBM_ALWAYS_ASK__
        else if(cbm_is_always_ask_data_account(account_id))
        {
            mmi_ucs2ncpy(dest, GetString(STR_ID_DTCNT_ALWAYS_ASK), length);
        }
    #endif /*__MMI_CBM_ALWAYS_ASK__*/
    #ifdef __MMI_SIM_PROVISIONING_SUPPORT__
        else if(profile_type == CBM_SPA_PROFILE)
        {
            if (bearer_type == ABM_E_SOCKET_BEARER_GSM_CSD)
            {
                mmi_ucs2cpy(dest, (S8*)DTCNT_STRING_SIM);
                gui_itoa(sim_id + 1, temp_num, 10);
                mmi_ucs2cat(dest, (S8*)temp_num);
                mmi_ucs2cat(dest, " ");
                mmi_ucs2cat(dest, (S8*)DTCNT_STRING_CSD);
                gui_itoa(profile_id + 1, temp_num, 10);
                mmi_ucs2cat(dest, (S8*)temp_num);
            }
        #ifdef __MMI_GPRS_FEATURES__
            else if (bearer_type == ABM_E_SOCKET_BEARER_GSM_GPRS)
            {
                mmi_ucs2cpy(dest, (S8*)DTCNT_STRING_SIM);
                gui_itoa(sim_id + 1, temp_num, 10);
                mmi_ucs2cat(dest, (S8*)temp_num);
                mmi_ucs2cat(dest, " ");
                mmi_ucs2cat(dest, (S8*)DTCNT_STRING_GPRS);
                gui_itoa(profile_id + 1, temp_num, 10);
                mmi_ucs2cat(dest, (S8*)temp_num);
            }
        #endif /* __MMI_GPRS_FEATURES__ */
        }
    #endif /*__MMI_SIM_PROVISIONING_SUPPORT__*/
        else
        {
            account_id = cbm_get_original_id_data_account(account_id);
            if (abm_nw2bearer_id(account_id, &bearer, &id))
            {
                switch (bearer)
                {
                    case ABM_E_SOCKET_BEARER_GSM_CSD:
                        mmi_ucs2ncpy(dest, (S8*) g_DataAccount[id].DataAccountName, length);
                        break;
                #ifdef __MMI_GPRS_FEATURES__
                    case ABM_E_SOCKET_BEARER_GSM_GPRS:
                        mmi_ucs2ncpy(dest, (S8*) g_GPRS_DataAccount[id - 1].DataAccountName, length);
                        break;
                #endif /* __MMI_GPRS_FEATURES__ */ 
                #ifdef __MMI_WLAN_FEATURES__
                    case ABM_E_SOCKET_BEARER_WIFI:
                        mmi_ucs2ncpy(dest, GetString(SERVICES_DATA_CONNECT_WLAN_STRING_ID), length);
                        break;
                #endif /* __MMI_WLAN_FEATURES__ */ 
                    default:
                        mmi_ucs2cpy((S8*)dest, (S8*)GetString(STR_GLOBAL_INVALID));
                        ret_val = MMI_FALSE;
                }
            }
            else
            {
                mmi_ucs2cpy((S8*)dest, (S8*)GetString(STR_GLOBAL_INVALID));
                ret_val = MMI_FALSE;
            }
        }
    }
    OslMfree(acct_info_ptr);
    acct_info_ptr = NULL;
    return ret_val;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_single_account_name
 * DESCRIPTION
 *  Same as the previous mmi_dtcnt_get_account_name. Just for compatible with
 *  some specified need.
 * PARAMETERS
 *  account_id      [IN]        
 *  dest            [OUT]         
 *  len             [IN]        
 * RETURNS
 *  
 *****************************************************************************/
BOOL mmi_dtcnt_get_single_account_name(U32 account_id, S8 *dest, U8 len)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 ori_id = 0;
    U32 encoded_id = 0;
    U8 is_always_ask = KAL_FALSE;
    U8 sim_id = CBM_SIM_ID_SIM1;
    MMI_BOOL ret_val = MMI_TRUE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ori_id = cbm_get_original_id_data_account(account_id);
    is_always_ask = cbm_is_always_ask_data_account(account_id);
    sim_id = cbm_get_sim_info_data_account(account_id);
    encoded_id = cbm_encode_data_account_id(ori_id, sim_id, 0, is_always_ask);
    ret_val = mmi_dtcnt_get_account_name(encoded_id, dest, len);
    return ret_val;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_account_select_highlight_hdlr
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_account_select_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_account_selection.CurrAppMainSelectItem = (U8) nIndex;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_always_ask_account_select_highlight_hdlr
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_account_select_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_always_ask.CurrAAMainSelectItem = (U8) nIndex;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_account_select_highlight_hdlr
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_account_sim_select_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_account_selection.CurrAppBearerSelectItem = (U8) nIndex;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_account_select_ok
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_account_select_ok(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_account_selection.CurrAppSelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 
    g_mmi_dtcnt_account_selection.CurrAppBearerSelectItem = 0;

    g_mmi_dtcnt_account_selection.bearer_callbacks[g_mmi_dtcnt_account_selection.CurrAppMainSelectItem]();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_account_select_ok
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_account_bearer_select_ok(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_account_selection.CurrAppSelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 
    g_mmi_dtcnt_account_selection.bearer_callbacks[g_mmi_dtcnt_account_selection.CurrAppBearerSelectItem] ();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_always_ask_select_ok
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_select_ok(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    g_mmi_dtcnt_always_ask.CurrAASelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_always_ask.GPRSCurrAASelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 
    g_mmi_dtcnt_always_ask.bearer_callbacks[g_mmi_dtcnt_always_ask.CurrAAMainSelectItem] ();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_account_select
 * DESCRIPTION
 *  Data account main screen ( including GSM/GPPRS)
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_entry_account_select(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i;
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U16 nNumofItem = 0;                 /* Stores no of children in the submenu */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_DTCNT_MAIN, NULL, mmi_dtcnt_entry_account_select, NULL);

    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_MAIN);

    for (i = 0; g_dtcnt_selections[i].bearer > 0; i++)
    {
#ifdef __MMI_CBM_ALWAYS_ASK__
        if(g_dtcnt_selections[i].bearer == DATA_ACCOUNT_ALWAYS_ASK)
        {
            nStrItemList[nNumofItem] = g_dtcnt_selections[i].name;
            g_mmi_dtcnt_account_selection.bearer_callbacks[nNumofItem] = g_dtcnt_selections[i].func;
            nNumofItem++;
        }
        else 
#endif /* __MMI_WLAN_FEATURES__ */
        if (g_mmi_dtcnt_account_selection.bearers & g_dtcnt_selections[i].bearer)
        {
#ifdef __MMI_WLAN_FEATURES__
            if((g_dtcnt_selections[i].bearer == DATA_ACCOUNT_BEARER_WIFI) &&
                (mmi_netset_get_active_preferred_mode() == P_GSM_ONLY))
            {
                continue;
            }
            else if((g_dtcnt_selections[i].bearer != DATA_ACCOUNT_BEARER_WIFI) &&
                (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY))
            {
                continue;
            }
            else 
#endif /* __MMI_WLAN_FEATURES__ */
            {
                nStrItemList[nNumofItem] = g_dtcnt_selections[i].name;
                g_mmi_dtcnt_account_selection.bearer_callbacks[nNumofItem] = g_dtcnt_selections[i].func;
                nNumofItem++;
            }
        }
    }
    
    if(nNumofItem == 0)
    {
        DisplayPopup((PU8) GetString(STR_GLOBAL_NOT_DONE), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, SUCCESS_TONE);
        DeleteScreenIfPresent(SCR_ID_DTCNT_MAIN);
        return;
    }
    
    RegisterHighlightHandler(mmi_dtcnt_account_select_highlight_hdlr);

    ShowCategory52Screen(
        SERVICES_DATA_CONNECT_MAIN_STRING_ID,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        0,
        0,
        0,
        guiBuffer);
    SetLeftSoftkeyFunction(mmi_dtcnt_account_select_ok, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_account_select_ok, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_exit_list_hdlr
 * DESCRIPTION
 *  GoBackHistory wrapper for resetting highlight index.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static U8 mmi_dtcnt_exit_list_hdlr(void *p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_DataAccount_Display.CurrSelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_DataAccount_Display.GPRSCurrSelectItem = 0;
#endif
    return FALSE;
}

/*****************************************************************************
 * FUNCTION
 *  SetDynaDataAccountName
 * DESCRIPTION
 *  
 * PARAMETERS
 *  UCS2Name        [?]         
 *  index           [IN]        
 *  void(?)         [IN]        *
 * RETURNS
 *  void
 *****************************************************************************/
void SetDynaDataAccountName(S8 *UCS2Name, U8 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 LocalBuffer[8];
    S8 StrVal[8];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    sprintf(LocalBuffer, "%d", index + 1);
    mmi_asc_to_ucs2((PS8) StrVal, (PS8) LocalBuffer);

    mmi_ucs2cpy((PS8) UCS2Name, (PS8) GetString(STR_ID_DTCNT_NAME));

    mmi_ucs2cat((PS8) UCS2Name, (PS8) StrVal);
}


#define CSD_GPRS_LIST
/*****************************************************************************
 * FUNCTION
 *  InitDataAccountApp
 * DESCRIPTION
 *  Initialize the Data Account App
 *  
 *  This is used to initialized the Data Account application
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void InitDataAccountApp(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = 0;
    U8 ImageLocation = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    InitAlwaysAsk();
    
    for (i = 0; i < MAX_DATA_ACCOUNT_GSM_LIMIT; i++)
    {
        memset(&g_DataAccount[i], '\0', sizeof(DataAccountNode));
        g_DataAccount[i].Present = (U8) '\0';
        g_DataAccount[i].iFdcs = 0;
    }
    for (i = 0; i < MAX_INLINE_ITEM_DATA_ACCOUNT_LIST; i++)
    {
        if (i % 2)
        {
            g_DataAccount_Display.IconList[i] = IMG_ID_DTCNT_LSK_OK;
        }
        else
        {
            g_DataAccount_Display.IconList[i] = IMG_ID_DTCNT_AC_NAME + ImageLocation;
            ImageLocation++;
        }
    }
    g_DataAccount_Display.CurrGetIndex = 0;
    g_DataAccount_Display.CurrSelectItem = 0;
    /* micha0112 */
    g_mmi_dtcnt_account_selection.CurrAppSelectItem = 0;

    g_DTCNTReadyCallback = NULL;
    
    /* micha0913 */
#ifdef __MMI_GPRS_FEATURES__
#if 0
#ifdef __MMI_OP01_GPRS_DATACFG__
/* under construction !*/
#else /* __MMI_OP01_GPRS_DATACFG__ */
/* under construction !*/
#endif /* __MMI_OP01_GPRS_DATACFG__ */
#endif /* 0 */
    for (i = 0; i < MAX_DATA_ACCOUNT_GPRS_LIMIT; i++)
    {
        memset(&g_GPRS_DataAccount[i], '\0', sizeof(GPRSDataAccountNode));
        g_GPRS_DataAccount[i].Present = (U8) '\0';
        g_GPRS_DataAccount[i].iFdcs = 0;
    }

    ImageLocation = 0;
    for (i = 0; i < MAX_INLINE_ITEM_GPRSDATA_ACCOUNT_LIST; i++)
    {
        if (i % 2)
        {
            g_DataAccount_Display.IconList[i] = IMG_ID_DTCNT_LSK_OK;
        }
        else
        {
            g_DataAccount_Display.IconList[i] = IMG_ID_DTCNT_GPRS_AC_NAME + ImageLocation;
            ImageLocation++;
        }
    }
    g_DataAccount_Display.GPRSCurrGetIndex = 0;
    g_DataAccount_Display.GPRSCurrSelectItem = 0;
    /* micha0112 */
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 

#ifdef __MMI_WLAN_FEATURES__
	mmi_wlan_init();
#endif

#if defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__)
	mmi_dm_set_check_function(DM_SETTING_TYPE_DATA_ACCOUNT_HTTP, mmi_dtcnt_dm_check);
    mmi_dm_set_check_function(DM_SETTING_TYPE_DATA_ACCOUNT_WAP, mmi_dtcnt_dm_check);
    mmi_dm_set_check_function(DM_SETTING_TYPE_DATA_ACCOUNT_CSD, mmi_dtcnt_dm_check);
#endif /* SYNCML_DM_SUPPORT */
    /* code for Q03C originally */
    SetProtocolEventHandler(mmi_ps_dtcnt_list_ind_handler, MSG_ID_MMI_PS_DTCNT_LIST_IND);
}


/*****************************************************************************
 * FUNCTION
 *  InitializeDataAccountRecords
 * DESCRIPTION
 *  Initialize Data Account Records
 *  
 *  Called from SAT to enter Data Account Main Screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void InitializeDataAccountRecords(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DataAccountReadyCheck(EntryDTCNTList);
}


/*****************************************************************************
 * FUNCTION
 *  DataAccountReadyCheck
 * DESCRIPTION
 *  Chec if data account is ready in global array,
 *  execute call back function when ready.
 * PARAMETERS
 *  ready_callback      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_ready_check_on_background(FuncPtr ready_callback)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_DM_READY_CHECK);
#if defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__)
    if(mmi_dtcnt_ready_check())
    {
        DisplayPopup((PU8) GetString(STR_GLOBAL_BUSY_TRY_LATER), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, SUCCESS_TONE);
        return;
    }
#endif /* defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__) */
#ifdef __MMI_CBM_CONNECTION_MANAGER__
    if (g_cbm_dtcnt_init_status)
    {
        DisplayPopup((PU8) GetString(STR_GLOBAL_BUSY_TRY_LATER), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, SUCCESS_TONE);
        return;
    }
#endif /* __MMI_CBM_CONNECTION_MANAGER__ */
    g_DTCNTReadyCallback = ready_callback; 
#if defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__)
    g_DataAccount_Display.check_status = TRUE;
#endif /* defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__) */
    DTCNTGetAccountReq(0);
}


/*****************************************************************************
 * FUNCTION
 *  DataAccountReadyCheck
 * DESCRIPTION
 *  Chec if data account is ready in global array,
 *  execute call back function when ready.
 * PARAMETERS
 *  ready_callback      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void DataAccountReadyCheck(FuncPtr ready_callback)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ClearInputEventHandler(MMI_DEVICE_ALL);
    ClearKeyHandler(KEY_END, KEY_EVENT_DOWN);
    mmi_dtcnt_ready_check_on_background(ready_callback);
}

#if defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__)
/*****************************************************************************
 * FUNCTION
 *  DataAccountReadyCheck
 * DESCRIPTION
 *  Chec if data account is ready in global array,
 *  execute call back function when ready.
 * PARAMETERS
 *  ready_callback      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
U8 DataAccountGetCheckStatus(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    return g_DataAccount_Display.check_status;
}
#endif /* defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__) */


#define ALWAYS_ASK_CSD
/*****************************************************************************
 * FUNCTION
 *  HighlightAppDTCNTList
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_csd_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_always_ask.CurrAASelectItem = (U8) nIndex;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_always_ask_list
 * DESCRIPTION
 *  shows the main menu list
 *  
 *  This is used to shows the main menu list of data account
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_entry_csd_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer = NULL;
    U8 i = 0;
    U8 *DataAccountName[MAX_DATA_ACCOUNT_GSM_LIMIT];
    static U8 *PopUpDescription[MAX_DATA_ACCOUNT_GSM_LIMIT];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_DUAL_SIM_MASTER__
    if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
#else /* __MMI_DUAL_SIM_MASTER__ */
    if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
#endif /*__MMI_DUAL_SIM_MASTER__*/
    {
        /* Not allow to verify phone lock if SIM card is blocked */
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_EMPTY),
            IMG_GLOBAL_UNFINISHED,
            1,
            DATA_ACCOUNT_NOTIFY_TIMEOUT,
            (U8) ERROR_TONE);
        return;
    }
    
    for (i = 0; i < MAX_DATA_ACCOUNT_GSM_LIMIT; i++)
    {
        /* micha0307 */
        DataAccountName[i] = g_DataAccount[i].DataAccountName;
        if (mmi_ucs2strlen((PS8) g_DataAccount[i].DialNumber) > 0)
        {
            PopUpDescription[i] = g_DataAccount[i].DialNumber;
        }
        else
        {
            PopUpDescription[i] = (U8*) GetString(STR_GLOBAL_EMPTY_LIST);
        }
    }

    EntryNewScreen(SCR_ID_DTCNT_AA_LIST, NULL, mmi_dtcnt_always_ask_entry_csd_list, NULL);

    /* code for Q03C originally */
    DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_CONFIRM);

    SetDelScrnIDCallbackHandler(SCR_ID_DTCNT_AA_LIST, (HistoryDelCBPtr) mmi_dtcnt_always_ask_csd_list_del_hdlr);

    /* guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_AA_LIST); */
    guiBuffer = NULL;
    
    RegisterHighlightHandler(mmi_dtcnt_always_ask_csd_highlight_hdlr);

    ShowCategory53Screen(
        STR_GLOBAL_DATA_ACCOUNT,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_DATA_ACCOUNT_GSM_LIMIT,
        (U8 **) DataAccountName,
        (PU16) gIndexIconsImageList,
        PopUpDescription,
        0,
        g_mmi_dtcnt_always_ask.CurrAASelectItem,
        guiBuffer);
    SetLeftSoftkeyFunction(mmi_dtcnt_always_ask_csd_list_select_ok, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_always_ask_csd_list_select_ok, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  AppDTCNTSelectOK
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_csd_list_select_ok(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FuncPtrU32Ext temp_callback_ext_ptr = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_dtcnt_always_ask.app_callback_ext)
    {
        kal_uint32 id;

        abm_bearer2nw_id(ABM_E_SOCKET_BEARER_GSM_CSD, g_mmi_dtcnt_always_ask.CurrAASelectItem, &id);

        MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_APP_SELECT_OK, id);
        id = cbm_encode_data_account_id(id, 0, 0, 0);
    #ifdef __MMI_DUAL_SIM__
        /* id = cbm_encode_data_account_id(id, g_always_ask_sim_info, 0, 0); */
    #else /* __MMI_DUAL_SIM__ */
        g_always_ask_sim_info = 0;
    #endif /* __MMI_DUAL_SIM__ */
        
        /* return U32 acct id */
        temp_callback_ext_ptr = g_mmi_dtcnt_always_ask.app_callback_ext;
        g_mmi_dtcnt_always_ask.app_callback_ext = NULL;
    
        DeleteUptoScrID(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
        GoBackHistory();

        if (temp_callback_ext_ptr)
        {
            temp_callback_ext_ptr(id, TRUE, g_always_ask_sim_info);
        }
    }
    else
    {
        MMI_ASSERT(0);
    }
}


/*****************************************************************************
* FUNCTION
*  mmi_dtcnt_always_ask_csd_list_del_hdlr
* DESCRIPTION
*  
* PARAMETERS
*  in_param        [?]     
* RETURNS
*  void
*****************************************************************************/
U8 mmi_dtcnt_always_ask_csd_list_del_hdlr(void *in_param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_CBM_ALWAYS_ASK__
    FuncPtrU32Ext temp_callback_ext_ptr = NULL;
#endif /* __MMI_CBM_ALWAYS_ASK__ */
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_CBM_ALWAYS_ASK__
    PRINT_INFORMATION("$$$$$ mmi_dtcnt_csd_list_screen_del_handler app_call = %d, del_handler_flag = %d $$$$$", 
        0, g_always_ask_screen_del_handler_flag);

    if(IsScreenPresent(SCR_ID_DTCNT_LIST_ALWAYS_ASK))
    {
        return FALSE;
    }
    if(!g_always_ask_screen_del_handler_flag)
    {
        g_always_ask_screen_del_handler_flag = TRUE;
        if(g_mmi_dtcnt_always_ask.app_callback_ext)
        {
            temp_callback_ext_ptr = g_mmi_dtcnt_always_ask.app_callback_ext;
            g_mmi_dtcnt_always_ask.app_callback_ext = NULL;
        }
    }
    if (temp_callback_ext_ptr)
    {
        temp_callback_ext_ptr(0, FALSE, 0);
    }
#endif /* __MMI_CBM_ALWAYS_ASK__ */
    return FALSE;
}


#define APP_SELECT_CSD
/*****************************************************************************
 * FUNCTION
 *  HighlightAppDTCNTList
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightAppDTCNTList(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_account_selection.CurrAppSelectItem = (U8) nIndex;
}


#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_CBM_ALWAYS_ASK__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_CBM_ALWAYS_ASK__ */
/* under construction !*/
/* under construction !*/
#endif /* 0 */


/*****************************************************************************
 * FUNCTION
 *  EntryAppDTCNTList
 * DESCRIPTION
 *  shows the main menu list
 *  
 *  This is used to shows the main menu list of data account
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryAppDTCNTList(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer = NULL;
    U8 i = 0;
    U8 *DataAccountName[MAX_DATA_ACCOUNT_GSM_LIMIT];
    static U8 *PopUpDescription[MAX_DATA_ACCOUNT_GSM_LIMIT];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_DUAL_SIM_MASTER__
    if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
#else /* __MMI_DUAL_SIM_MASTER__ */
    if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
#endif /*__MMI_DUAL_SIM_MASTER__*/
    {
        /* Not allow to verify phone lock if SIM card is blocked */
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_EMPTY),
            IMG_GLOBAL_UNFINISHED,
            1,
            DATA_ACCOUNT_NOTIFY_TIMEOUT,
            (U8) ERROR_TONE);
        return;
    }
    
    for (i = 0; i < MAX_DATA_ACCOUNT_GSM_LIMIT; i++)
    {
        /* micha0307 */
        DataAccountName[i] = g_DataAccount[i].DataAccountName;
        if (mmi_ucs2strlen((PS8) g_DataAccount[i].DialNumber) > 0)
        {
            PopUpDescription[i] = g_DataAccount[i].DialNumber;
        }
        else
        {
            PopUpDescription[i] = (U8*) GetString(STR_GLOBAL_EMPTY_LIST);
        }
    }

    EntryNewScreen(SCR_ID_DTCNT_LIST, NULL, EntryAppDTCNTList, NULL);

    /* code for Q03C originally */
    DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_CONFIRM);

    /* guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_LIST); */
    guiBuffer = NULL;
    
    RegisterHighlightHandler(HighlightAppDTCNTList);

    ShowCategory53Screen(
        STR_GLOBAL_DATA_ACCOUNT,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_DATA_ACCOUNT_GSM_LIMIT,
        (U8 **) DataAccountName,
        (PU16) gIndexIconsImageList,
        PopUpDescription,
        0,
        g_mmi_dtcnt_account_selection.CurrAppSelectItem,
        guiBuffer);
    SetLeftSoftkeyFunction(AppDTCNTSelectOK, KEY_EVENT_UP);
    SetKeyHandler(AppDTCNTSelectOK, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* code for Q03C originally */
    SetRightSoftkeyFunction(mmi_dtcnt_list_go_back_gprs, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_list_go_back_gprs, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_go_back_gprs
 * DESCRIPTION
 *  go back to GPRS list screen for Q03C bearer fallback selection
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_go_back_gprs(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_dtcnt_list_cnt.switch_bearer_flag) 
    {
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_CONFIRM);
#ifdef __MMI_GPRS_FEATURES__
        mmi_dtcnt_list_by_app_confirm(STR_ID_DTCNT_SELECT_GPRS, mmi_dtcnt_list_back_handler);
#endif /* __MMI_GPRS_FEATURES__ */
    }
    else
    {
        /* DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION); */
        if(g_bearer_num_flag)
        {
            DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_DUAL_SIM);
        }
        g_entry_option_back_flag = TRUE;
        GoBackHistory();
    }
}


/*****************************************************************************
 * FUNCTION
 *  AppDTCNTSelectOK
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void AppDTCNTSelectOK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (g_mmi_dtcnt_account_selection.app_callback)
    {
        kal_uint32 id;

        /* code for Q03C originally */
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_CONFIRM);

        abm_bearer2nw_id(ABM_E_SOCKET_BEARER_GSM_CSD, g_mmi_dtcnt_account_selection.CurrAppSelectItem, &id);

        MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_APP_SELECT_OK, id);

    #ifdef __MMI_DUAL_SIM__  
            id = cbm_encode_data_account_id(id, g_sim_info, 0, 0);
    #else /* __MMI_DUAL_SIM__ */
        id = cbm_encode_data_account_id(id, 0, 0, 0);
    #endif /* __MMI_DUAL_SIM__ */
        /* return U32 acct id */
        g_mmi_dtcnt_account_selection.app_callback(id);
        g_mmi_dtcnt_account_selection.app_callback = NULL;
    }
    else
    {
        MMI_ASSERT(0);
    }
}


#ifdef __MMI_GPRS_FEATURES__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_back_handler
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_back_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DeleteScreenIfPresent(SCR_ID_DTCNT_LIST);
    g_mmi_dtcnt_account_selection.bearers = DATA_ACCOUNT_BEARER_GPRS;
    GoBackHistory();
}
#endif /* __MMI_GPRS_FEATURES__ */


#define EDIT_LIST_CSD
/*****************************************************************************
 * FUNCTION
 *  HighlightDTCNTList
 * DESCRIPTION
 *  gets current hilite item for data account list
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightDTCNTList(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_DataAccount_Display.CurrSelectItem = (U8) nIndex;
    if (g_DataAccount[nIndex].readonly)
    {
        ChangeLeftSoftkey(STR_GLOBAL_DETAILS, IMG_GLOBAL_OK);
    }
    else
    {
        ChangeLeftSoftkey(STR_GLOBAL_EDIT, IMG_ID_DTCNT_LSK_EDIT);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTList
 * DESCRIPTION
 *  shows the main menu list
 *  
 *  This is used to shows the main menu list of data account
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDTCNTList(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer = NULL;
    U8 i = 0;
    U8 *DataAccountName[MAX_DATA_ACCOUNT_GSM_LIMIT];
    static U8 *PopUpDescription[MAX_DATA_ACCOUNT_GSM_LIMIT];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

#ifdef __MMI_DUAL_SIM_MASTER__
    if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
#else /* __MMI_DUAL_SIM_MASTER__ */
    if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
#endif /*__MMI_DUAL_SIM_MASTER__*/    
    {
        /* Not allow to verify phone lock if SIM card is blocked */
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_EMPTY),
            IMG_GLOBAL_UNFINISHED,
            1,
            DATA_ACCOUNT_NOTIFY_TIMEOUT,
            (U8) ERROR_TONE);
        return;
    }

    for (i = 0; i < MAX_DATA_ACCOUNT_GSM_LIMIT; i++)
    {
        /* micha0307 */
        DataAccountName[i] = g_DataAccount[i].DataAccountName;
        if (mmi_ucs2strlen((PS8) g_DataAccount[i].DialNumber) > 0)
        {
            PopUpDescription[i] = g_DataAccount[i].DialNumber;
        }
        else
        {
            PopUpDescription[i] = (U8*) GetString(STR_GLOBAL_EMPTY_LIST);
        }
    }

    EntryNewScreen(SCR_ID_DTCNT_LIST, NULL, InitializeDataAccountRecords, NULL);

    /* guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_LIST); */
    guiBuffer = NULL;
    
    SetParentHandler(SERVICES_DATA_CONNECT_MAIN_MENU_ID);
    
    RegisterHighlightHandler(HighlightDTCNTList);

    ShowCategory53Screen(
        SERVICES_DATA_CONNECT_GSM_STRING_ID,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_EDIT,
        IMG_ID_DTCNT_LSK_EDIT,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_DATA_ACCOUNT_GSM_LIMIT,
        (U8 **) DataAccountName,
        (PU16) gIndexIconsImageList,
        PopUpDescription,
        0,
        g_DataAccount_Display.CurrSelectItem,
        guiBuffer);

    SetLeftSoftkeyFunction(InitInLineDataAccount, KEY_EVENT_UP);
    SetKeyHandler(InitInLineDataAccount, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

    SetDelScrnIDCallbackHandler(SCR_ID_DTCNT_LIST, mmi_dtcnt_exit_list_hdlr);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_csd_editor_highlight_hdlr
 * DESCRIPTION
 *
 * PARAMETERS
 *
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_csd_editor_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_DataAccount_Display.readonly)
    {
        ChangeLeftSoftkey(0, 0);
        ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTEdit
 * DESCRIPTION
 *  Edit Data Account
 *  
 *  This is used to edit Data Account Menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDTCNTEdit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *inputBuffer;
    U8 *guiBuffer;
    U16 inputBufferSize;
    U16 title_id = STR_GLOBAL_EDIT;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_DTCNT_EDIT, ExitDTCNTEdit, NULL, NULL);

    InitializeCategory57Screen();
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_EDIT);
    inputBuffer = GetCurrNInputBuffer(SCR_ID_DTCNT_EDIT, &inputBufferSize);     /* added for inline edit history */
    SetParentHandler(MITEM_DATA_ACCOUNT_PARENT_ZERO);
    DataAccountFillInlineStruct();
    RegisterHighlightHandler(mmi_dtcnt_csd_editor_highlight_hdlr);
    if (inputBuffer != NULL)
    {
        SetCategory57Data(wgui_inline_items, MAX_INLINE_ITEM_DATA_ACCOUNT_LIST, inputBuffer);
    }

    if (VerifyDataAcountChanges() && GetInlineDoneFlag(guiBuffer) == 0)
    {
        SetInlineDoneFlag(guiBuffer);
    }

    if (g_DataAccount_Display.readonly)
    {
        title_id = STR_GLOBAL_DETAILS;
    }
    ShowCategory57Screen(
        title_id,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_EDIT,
        IMG_ID_DTCNT_LSK_EDIT,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_INLINE_ITEM_DATA_ACCOUNT_LIST,
        g_DataAccount_Display.IconList,
        wgui_inline_items,
        DATA_ACCOUNT_HILITED_ITEM,
        guiBuffer);

    SetCategory57RightSoftkeyFunctions(EntryDTCNTSave, GoBackHistory);
}


/*****************************************************************************
 * FUNCTION
 *  ExitDTCNTEdit
 * DESCRIPTION
 *  Exit from Edit
 *  
 *  This is used to exit screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitDTCNTEdit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;
    U16 inputBufferSize;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory57Screen();
    h.scrnID = SCR_ID_DTCNT_EDIT;
    h.entryFuncPtr = EntryDTCNTEdit;
    GetCategoryHistory(h.guiBuffer);
    inputBufferSize = (U16) GetCategory57DataSize();
    GetCategory57Data((U8*) h.inputBuffer);
    AddNHistory(h, inputBufferSize);
}


/*****************************************************************************
 * FUNCTION
 *  InitInLineDataAccount
 * DESCRIPTION
 *  Fill the Inline Structure.
 *  
 *  This is used to edit Data Account Menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void InitInLineDataAccount(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = g_DataAccount_Display.CurrSelectItem;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_ucs2cpy((PS8) g_DataAccount_Display.DataAccountName, (PS8) g_DataAccount[i].DataAccountName);
    mmi_ucs2cpy((PS8) g_DataAccount_Display.DialNumber, (PS8) g_DataAccount[i].DialNumber);
    mmi_asc_to_ucs2((PS8) g_DataAccount_Display.UserName, (PS8) g_DataAccount[i].UserName);
    mmi_asc_to_ucs2((PS8) g_DataAccount_Display.Passwd, (PS8) g_DataAccount[i].Passwd);

    ReturnThreeDigitString(g_DataAccount_Display.IP1, g_DataAccount[i].DnsAddress[0]);
    ReturnThreeDigitString(g_DataAccount_Display.IP2, g_DataAccount[i].DnsAddress[1]);
    ReturnThreeDigitString(g_DataAccount_Display.IP3, g_DataAccount[i].DnsAddress[2]);
    ReturnThreeDigitString(g_DataAccount_Display.IP4, g_DataAccount[i].DnsAddress[3]);

    g_DataAccount_Display.DialType = (S32) g_DataAccount[i].DialType;
    g_DataAccount_Display.DataRate = (S32) g_DataAccount[i].DataRate;

    g_DataAccount_Display.DialTypeOption[0] = (U8*) GetString(STR_ID_DTCNT_ANALOGUE_STR);
    g_DataAccount_Display.DialTypeOption[1] = (U8*) GetString(STR_ID_DTCNT_ISDN_STR);
    g_DataAccount_Display.DialRateOption[0] = (U8*) GetString(STR_ID_DTCNT_RATE_STR_ONE);
    g_DataAccount_Display.DialRateOption[1] = (U8*) GetString(STR_ID_DTCNT_RATE_STR_TWO);
    g_DataAccount_Display.DialRateOption[2] = (U8*) GetString(STR_ID_DTCNT_RATE_STR_THREE);

    /* 4 fields new added for csd account(g_DataAccount[i]-->Display) */
    memcpy(g_DataAccount_Display.provurl_hash_val, g_DataAccount[i].provurl_hash_val, MMI_DTCNT_PROVURL_HASH_LEN);
    memcpy(g_DataAccount_Display.napid_hash_val, g_DataAccount[i].napid_hash_val, MMI_DTCNT_NAPID_HASH_LEN);
    g_DataAccount_Display.acct_type = g_DataAccount[i].acct_type;
    g_DataAccount_Display.readonly = g_DataAccount[i].readonly;
    
    EntryDTCNTEdit();
}


/*****************************************************************************
 * FUNCTION
 *  DataAccountFillInlineStruct
 * DESCRIPTION
 *  Call the Inline Functions.
 *  
 *  This is used to edit Data Account Menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void DataAccountFillInlineStruct(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 BufferSize = 0;
    S16 len_str = 0;
    U16 one_ucs2 = L'*';
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!g_DataAccount_Display.readonly)
    {
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_NAME), KEY_LSK, KEY_EVENT_UP);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_DIAL_NUMBER), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_USER_NAME), KEY_LSK, KEY_EVENT_UP);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_PASSWD), KEY_LSK, KEY_EVENT_UP);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_DNS_ADDRESS), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_DIAL_TYPE), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_DATA_RATE), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    }
    else
    {
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_NAME), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_DIAL_NUMBER), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_USER_NAME), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_PASSWD), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_DNS_ADDRESS), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_DIAL_TYPE), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + DATA_ACCOUNT_DATA_RATE), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    }
    
    SetInlineItemCaption((wgui_inline_items + DATA_ACCOUNT_NAME_STR), (U8*) GetString(STR_ID_DTCNT_RENAME));
    SetInlineItemCaption((wgui_inline_items + DATA_ACCOUNT_DIAL_NUMBER_STR), (U8*) GetString(STR_ID_DTCNT_DIAL_NUMBER));
    SetInlineItemCaption((wgui_inline_items + DATA_ACCOUNT_USER_NAME_STR), (U8*) GetString(STR_ID_DTCNT_USER_NAME));
    SetInlineItemCaption((wgui_inline_items + DATA_ACCOUNT_PASSWD_STR), (U8*) GetString(STR_ID_DTCNT_PASSWD));
    SetInlineItemCaption((wgui_inline_items + DATA_ACCOUNT_DIAL_TYPE_STR), (U8*) GetString(STR_ID_DTCNT_DIAL_TYPE));
    SetInlineItemCaption((wgui_inline_items + DATA_ACCOUNT_DATA_RATE_STR), (U8*) GetString(STR_ID_DTCNT_DATA_RATE));
    SetInlineItemCaption((wgui_inline_items + DATA_ACCOUNT_DNS_ADDRESS_STR), (U8*) GetString(STR_ID_DTCNT_DNS_ADDRESS));

    if (!g_DataAccount_Display.readonly)
    {
        SetInlineItemSelect(
            (wgui_inline_items + DATA_ACCOUNT_DIAL_TYPE),
            (S32) DATA_ACCOUNT_INLINE_DIAL_TYPE_OPTION,
            (U8 **) g_DataAccount_Display.DialTypeOption,
            (S32*) & g_DataAccount_Display.DialType);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + DATA_ACCOUNT_DIAL_TYPE), 
                                g_DataAccount_Display.DialTypeOption[g_DataAccount_Display.DialType]);
    }

    if (!g_DataAccount_Display.readonly)
    {
        SetInlineItemSelect(
            (wgui_inline_items + DATA_ACCOUNT_DATA_RATE),
            (S32) DATA_ACCOUNT_INLINE_DATA_RATE_OPTION,
            (U8 **) g_DataAccount_Display.DialRateOption,
            (S32*) & g_DataAccount_Display.DataRate);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + DATA_ACCOUNT_DATA_RATE), 
                                g_DataAccount_Display.DialRateOption[g_DataAccount_Display.DataRate]);
    }
    
    if (!g_DataAccount_Display.readonly)
    {
        BufferSize = MAX_DATA_ACCOUNT_NAME_LEN + 1;
        SetInlineItemFullScreenEdit(
            (wgui_inline_items + DATA_ACCOUNT_NAME),
            STR_ID_DTCNT_RENAME,
            GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
            (U8*) (g_DataAccount_Display.DataAccountName),
            BufferSize,
            IMM_INPUT_TYPE_SENTENCE | INPUT_TYPE_USE_ENCODING_BASED_LENGTH);
        SetInlineFullScreenEditCustomFunction(wgui_inline_items + DATA_ACCOUNT_NAME, DataAccountFullLineEditScreen);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + DATA_ACCOUNT_NAME), 
                                g_DataAccount_Display.DataAccountName);
    }

    if (!g_DataAccount_Display.readonly)
    {
        BufferSize = MAX_DIAL_NUM_LEN + 1;  /* 1 because + is handled by UI */
        SetInlineItemTextEdit(
            (wgui_inline_items + DATA_ACCOUNT_DIAL_NUMBER),
            (U8*) (g_DataAccount_Display.DialNumber),
            BufferSize,
            IMM_INPUT_TYPE_PHONE_NUMBER | INPUT_TYPE_PLUS_CHARACTER_HANDLING);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + DATA_ACCOUNT_DIAL_NUMBER), 
                                (U8*)(g_DataAccount_Display.DialNumber));
    }

    if (!g_DataAccount_Display.readonly)
    {
        BufferSize = MAX_USER_LEN + 1;
        SetInlineItemFullScreenEdit(
            (wgui_inline_items + DATA_ACCOUNT_USER_NAME),
            STR_ID_DTCNT_USER_NAME,
            GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
            (U8*) (g_DataAccount_Display.UserName),
            BufferSize,
            IMM_INPUT_TYPE_ENGLISH_SENTENCE);
        SetInlineFullScreenEditCustomFunction(wgui_inline_items + DATA_ACCOUNT_USER_NAME, DataAccountFullLineEditScreen);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + DATA_ACCOUNT_USER_NAME), 
                                (U8*)g_DataAccount_Display.UserName);
    }

    if (!g_DataAccount_Display.readonly)
    {
        BufferSize = MAX_PASSWD_LEN + 1;
        SetInlineItemFullScreenEdit(
            (wgui_inline_items + DATA_ACCOUNT_PASSWD),
            STR_ID_DTCNT_PASSWD,
            GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
            (U8*) (g_DataAccount_Display.Passwd),
            BufferSize,
            IMM_INPUT_TYPE_ALPHANUMERIC_PASSWORD);
        SetInlineFullScreenEditCustomFunction(wgui_inline_items + DATA_ACCOUNT_PASSWD, DataAccountFullLineEditScreen);
    }
    else
    {
        len_str = mmi_ucs2strlen((S8*)g_DataAccount_Display.Passwd);
        for(len_str = len_str - 1; len_str >= 0; len_str--)
        {
            g_DataAccount_Display.Passwd[len_str * ENCODING_LENGTH] = ((U8*)&one_ucs2)[0];
            g_DataAccount_Display.Passwd[len_str * ENCODING_LENGTH + 1] = ((U8*)&one_ucs2)[1];
        }
        SetInlineItemDisplayOnly((wgui_inline_items + DATA_ACCOUNT_PASSWD), 
                                (U8*)g_DataAccount_Display.Passwd);
    }

    if (!g_DataAccount_Display.readonly)
    {
        SetInlineItemIP4(
            (wgui_inline_items + DATA_ACCOUNT_DNS_ADDRESS),
            (U8*) g_DataAccount_Display.IP1,
            (U8*) g_DataAccount_Display.IP2,
            (U8*) g_DataAccount_Display.IP3,
            (U8*) g_DataAccount_Display.IP4,
            PreparedIPAddressString);
    }
    else
    {
        PreparedIPAddressString(g_DataAccount_Display.ip_address_display, 
                                g_DataAccount_Display.IP1, 
                                g_DataAccount_Display.IP2, 
                                g_DataAccount_Display.IP3, 
                                g_DataAccount_Display.IP4);
        SetInlineItemDisplayOnly((wgui_inline_items + DATA_ACCOUNT_DNS_ADDRESS), 
                                g_DataAccount_Display.ip_address_display);
    }
}


/*****************************************************************************
 * FUNCTION
 *  DataAccountFullLineEditScreen
 * DESCRIPTION
 *  Data Account Name for Full Line Edit Screen.
 *  
 *  This is used to edit Data Account.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void DataAccountFullLineEditScreen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OPTIONS, IMG_GLOBAL_OPTIONS);

    SetInputMethodAndDoneCaptionIcon(GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID));

    SetLeftSoftkeyFunction(EntryScrForInputMethodAndDone, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  PreparedIPAddressString
 * DESCRIPTION
 *  Prepared the Data Account IP Address to Show on Screen.
 * PARAMETERS
 *  string_buffer       [?]     
 *  IP1                 [?]     
 *  IP2                 [?]     
 *  IP3                 [?]     
 *  IP4                 [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void PreparedIPAddressString(U8 *string_buffer, U8 *IP1, U8 *IP2, U8 *IP3, U8 *IP4)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 Point[MAX_PART_IP_ADDRESS];
    S32 IPAddress[MAX_PART_IP_ADDRESS];
    U8 LocalBuffer[8];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_asc_to_ucs2((S8*) Point, (S8*) ".");

    IPAddress[0] = (S32) gui_atoi((UI_string_type) IP1);
    IPAddress[1] = (S32) gui_atoi((UI_string_type) IP2);
    IPAddress[2] = (S32) gui_atoi((UI_string_type) IP3);
    IPAddress[3] = (S32) gui_atoi((UI_string_type) IP4);

    ReturnThreeDigitString(LocalBuffer, (U8) IPAddress[0]);
    mmi_ucs2cpy((PS8) string_buffer, (PS8) LocalBuffer);
    mmi_ucs2cat((PS8) string_buffer, (PS8) Point);

    ReturnThreeDigitString(LocalBuffer, (U8) IPAddress[1]);
    mmi_ucs2cat((PS8) string_buffer, (PS8) LocalBuffer);
    mmi_ucs2cat((PS8) string_buffer, (PS8) Point);

    ReturnThreeDigitString(LocalBuffer, (U8) IPAddress[2]);
    mmi_ucs2cat((PS8) string_buffer, (PS8) LocalBuffer);
    mmi_ucs2cat((PS8) string_buffer, (PS8) Point);

    ReturnThreeDigitString(LocalBuffer, (U8) IPAddress[3]);
    mmi_ucs2cat((PS8) string_buffer, (PS8) LocalBuffer);
}


/*****************************************************************************
 * FUNCTION
 *  ReturnThreeDigitString
 * DESCRIPTION
 *  This Fun Convert the integer value to String with prefix zero.
 *  
 *  Works only for three digit integer.(0-256)
 * PARAMETERS
 *  StringVal       [IN]        
 *  DigitVal        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void ReturnThreeDigitString(PU8 StringVal, U8 DigitVal)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 LocalBuffer[8];
    S8 StrVal[8];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (DigitVal == 0)
    {
        mmi_asc_to_ucs2((PS8) StrVal, (PS8) "000");
    }
    else if (DigitVal < 10)
    {
        sprintf(LocalBuffer, "00%d", DigitVal);
        mmi_asc_to_ucs2((PS8) StrVal, (PS8) LocalBuffer);
    }
    else if (DigitVal < 100)
    {
        sprintf(LocalBuffer, "0%d", DigitVal);
        mmi_asc_to_ucs2((PS8) StrVal, (PS8) LocalBuffer);
    }
    else
    {
        sprintf(LocalBuffer, "%d", DigitVal);
        mmi_asc_to_ucs2((PS8) StrVal, (PS8) LocalBuffer);
    }
    mmi_ucs2cpy((PS8) StringVal, (PS8) StrVal);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_is_csd_account_name_changed
 * DESCRIPTION
 *  Verify the Data Account fields.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL mmi_dtcnt_is_csd_account_name_changed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = g_DataAccount_Display.CurrSelectItem;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_ucs2cmp((PS8) g_DataAccount[i].DataAccountName, (PS8) g_DataAccount_Display.DataAccountName))
    {
        return MMI_TRUE;
    }
    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  VerifyDataAcountChanges
 * DESCRIPTION
 *  Verify the Data Account fields.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U8 VerifyDataAcountChanges(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = g_DataAccount_Display.CurrSelectItem;
    S8 UserName_UCS2[(MAX_USER_LEN + 1) * ENCODING_LENGTH];
    S8 Passwd_UCS2[(MAX_PASSWD_LEN + 1) * ENCODING_LENGTH];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_asc_to_ucs2((PS8) UserName_UCS2, (PS8) g_DataAccount[i].UserName);
    mmi_asc_to_ucs2((PS8) Passwd_UCS2, (PS8) g_DataAccount[i].Passwd);

    if (mmi_ucs2cmp((PS8) g_DataAccount[i].DataAccountName, (PS8) g_DataAccount_Display.DataAccountName))
    {
        return TRUE;
    }
    if (mmi_ucs2cmp((PS8) g_DataAccount[i].DialNumber, (PS8) g_DataAccount_Display.DialNumber))
    {
        return TRUE;
    }
    if (mmi_ucs2cmp((PS8) UserName_UCS2, (PS8) g_DataAccount_Display.UserName))
    {
        return TRUE;
    }
    if (mmi_ucs2cmp((PS8) Passwd_UCS2, (PS8) g_DataAccount_Display.Passwd))
    {
        return TRUE;
    }
    if (((S32) g_DataAccount[i].DialType) != g_DataAccount_Display.DialType)
    {
        return TRUE;
    }
    if (((S32) g_DataAccount[i].DataRate) != g_DataAccount_Display.DataRate)
    {
        return TRUE;
    }
    return FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  DataAccountSaveChanges
 * DESCRIPTION
 *  Save the Changed fields.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void DataAccountSaveChanges(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = g_DataAccount_Display.CurrSelectItem;
    U8 PrevIfdcs = 0;
    U8 StrDigit[MAX_IPADDRES_LEN * ENCODING_LENGTH];
    S32 WordCount = 0;
    S8 AccountNameStr[30 * ENCODING_LENGTH];    /* Assumption:  string "Data Account " length < 30 */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    stopRequestedTone(WARNING_TONE);

    PrevIfdcs = g_DataAccount[i].iFdcs;


    /*WordCount = GetInlineEditUCS2Count(&wgui_inline_items[1]);*/

    if(mmi_dtcnt_check_UCS2((U16*)g_DataAccount_Display.DataAccountName, (U16)mmi_ucs2strlen((PS8)g_DataAccount_Display.DataAccountName)))
    {
        WordCount = -1;
    }
    else
    {
        WordCount = 0;
    }

    if (mmi_dtcnt_is_csd_account_name_changed())
    {
        memset(g_DataAccount_Display.provurl_hash_val, 0, MMI_DTCNT_PROVURL_HASH_LEN);
        memset(g_DataAccount_Display.napid_hash_val, 0, MMI_DTCNT_NAPID_HASH_LEN);
        g_DataAccount_Display.acct_type = DTCNT_USER_CONFIGURED_ACCT;
        g_DataAccount_Display.readonly = MMI_FALSE;
    }
    
    memset(&g_DataAccount[i], '\0', sizeof(DataAccountNode));

    if (WordCount < 0)
    {
        g_DataAccount[i].iFdcs = mmi_ucs2strlen((PS8) g_DataAccount_Display.DataAccountName);
    }
    else
    {
        g_DataAccount[i].iFdcs = (U8) WordCount;
    }

    SetDynaDataAccountName(AccountNameStr, g_DataAccount_Display.CurrSelectItem);

    if (mmi_ucs2strlen((PS8) g_DataAccount_Display.DataAccountName) == 0)
    {
        mmi_ucs2cpy((PS8) g_DataAccount[i].DataAccountName, (PS8) AccountNameStr);
        g_DataAccount[i].iFdcs = mmi_ucs2strlen((PS8) g_DataAccount[i].DataAccountName);
    }
    else
    {
        mmi_ucs2cpy((PS8) g_DataAccount[i].DataAccountName, (PS8) g_DataAccount_Display.DataAccountName);
    }

    mmi_ucs2cpy((PS8) g_DataAccount[i].DialNumber, (PS8) g_DataAccount_Display.DialNumber);
    mmi_ucs2_to_asc((PS8) g_DataAccount[i].UserName, (PS8) g_DataAccount_Display.UserName);
    mmi_ucs2_to_asc((PS8) g_DataAccount[i].Passwd, (PS8) g_DataAccount_Display.Passwd);

    mmi_ucs2_to_asc((PS8) StrDigit, (PS8) g_DataAccount_Display.IP1);
    g_DataAccount[i].DnsAddress[0] = (U8) atoi((S8*) StrDigit);
    mmi_ucs2_to_asc((PS8) StrDigit, (PS8) g_DataAccount_Display.IP2);
    g_DataAccount[i].DnsAddress[1] = (U8) atoi((S8*) StrDigit);
    mmi_ucs2_to_asc((PS8) StrDigit, (PS8) g_DataAccount_Display.IP3);
    g_DataAccount[i].DnsAddress[2] = (U8) atoi((S8*) StrDigit);
    mmi_ucs2_to_asc((PS8) StrDigit, (PS8) g_DataAccount_Display.IP4);
    g_DataAccount[i].DnsAddress[3] = (U8) atoi((S8*) StrDigit);
    g_DataAccount[i].DialType = (U8) g_DataAccount_Display.DialType;
    g_DataAccount[i].DataRate = (U8) g_DataAccount_Display.DataRate;
    g_DataAccount[i].Present = 'P';

    /* 4 fields new added for csd account(Display-->g_DataAccount[i]) */
    memcpy(g_DataAccount[i].provurl_hash_val, g_DataAccount_Display.provurl_hash_val, MMI_DTCNT_PROVURL_HASH_LEN);
    memcpy(g_DataAccount[i].napid_hash_val, g_DataAccount_Display.napid_hash_val, MMI_DTCNT_NAPID_HASH_LEN);
    g_DataAccount[i].acct_type = g_DataAccount_Display.acct_type;
    g_DataAccount[i].readonly = g_DataAccount_Display.readonly;
    
    DTCNTSetAccountReq(i);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_check_UCS2
 * DESCRIPTION
 *  Notification Screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/

BOOL mmi_dtcnt_check_UCS2(U16 *buf, U16 charNum)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 *buffer = buf;
    U16 charNumber = charNum;
    U16 c;
    U16 count = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    while (count < charNumber)
    {
        c = buffer[count];
        if (UI_TEST_UCS2_CHARACTER(c))
        {
            return KAL_TRUE;
        }
        count++;
    }

    return KAL_FALSE;
}

#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif

/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTSave
 * DESCRIPTION
 *  Notification Screen.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDTCNTSave(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DisplayConfirm(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        get_string(STR_GLOBAL_SAVE_ASK),
        IMG_GLOBAL_QUESTION,
        WARNING_TONE);

    SetLeftSoftkeyFunction(DataAccountSaveChanges, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoToMainDataAccountScreen, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  GoToMainDataAccountScreen
 * DESCRIPTION
 *  Go back 2 history screens to Data Account Main
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void GoToMainDataAccountScreen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    stopRequestedTone(WARNING_TONE);
    GoBacknHistory(1);
}


/*****************************************************************************
 * FUNCTION
 *  ShowDataAccountOKMessage
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ShowDataAccountOKMessage(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DisplayPopup((PU8) GetString(STR_GLOBAL_SAVED), IMG_GLOBAL_ACTIVATED, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, SUCCESS_TONE);
    /* micha0427 */
    DeleteScreenIfPresent(SCR_ID_DTCNT_EDIT);
#ifdef __MMI_GPRS_FEATURES__
    DeleteScreenIfPresent(SCR_ID_DTCNT_GPRS_EDIT);
#endif 
}


/*****************************************************************************
 * FUNCTION
 *  DTCNTSetAccountReq
 * DESCRIPTION
 *  Use the L4 to store the Data Account Record.
 * PARAMETERS
 *  ItemNum     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void DTCNTSetAccountReq(U8 ItemNum)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_cc_set_csd_profile_req_struct *myMsgPtr;

    /* micha0820 */
    U8 ref_count;
    U16 msg_len;

    MYQUEUE Message;
    U8 DataAccountName_ASCII[(MAX_DATA_ACCOUNT_NAME_LEN + 1) * ENCODING_LENGTH];
    U8 pbNumber_ASCII[(MAX_DIAL_NUM_LEN + 1) * ENCODING_LENGTH];
    U8 i = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (ItemNum >= MAX_DATA_ACCOUNT_GSM_LIMIT)
    {
        return;
    }

    memset(DataAccountName_ASCII, '\0', (MAX_DATA_ACCOUNT_NAME_LEN + 1) * ENCODING_LENGTH);
    memset(pbNumber_ASCII, '\0', (MAX_DIAL_NUM_LEN + 1) * ENCODING_LENGTH);

    myMsgPtr = (mmi_cc_set_csd_profile_req_struct*) OslConstructDataPtr(sizeof(mmi_cc_set_csd_profile_req_struct));

    /* micha0820 */
    ref_count = myMsgPtr->ref_count;
    msg_len = myMsgPtr->msg_len;
    memset(myMsgPtr, '\0', sizeof(mmi_cc_set_csd_profile_req_struct));
    myMsgPtr->ref_count = ref_count;
    myMsgPtr->msg_len = msg_len;

    myMsgPtr->csd_module = 0;
    myMsgPtr->auth_type = 0;
    myMsgPtr->prof_id = ItemNum;

    if (g_DataAccount[ItemNum].DialType == DIAL_TYPE_ANALOGUE)
    {
        myMsgPtr->type = (U8) CSMCC_ITC_3_1_K_AUDIO;
    }
    else
    {
        myMsgPtr->type = (U8) CSMCC_ITC_UDI;
    }

    if (g_DataAccount[ItemNum].DataRate == DATA_RATE_FOUR_EIGHT - 1)
    {
        myMsgPtr->rate = (U8) CSD_PROF_RATE_4800;
    }
    else if (g_DataAccount[ItemNum].DataRate == DATA_RATE_NINE_SIX - 1)
    {
        myMsgPtr->rate = (U8) CSD_PROF_RATE_9600;
    }
    else if (g_DataAccount[ItemNum].DataRate == DATA_RATE_FOURTEEN_FOUR - 1)
    {
        myMsgPtr->rate = (U8) CSD_PROF_RATE_14400;
    }

    for (i = 0; i < 4; i++)
    {
        myMsgPtr->dns[i] = (U8) g_DataAccount[ItemNum].DnsAddress[i];
    }

    if (g_DataAccount[ItemNum].iFdcs > 0)
    {
        g_DataAccount[ItemNum].iFdcs = mmi_ucs2strlen((PS8) g_DataAccount[ItemNum].DataAccountName) * ENCODING_LENGTH;
        myMsgPtr->name.name_length = g_DataAccount[ItemNum].iFdcs;
        myMsgPtr->name.name_dcs = DATA_ACCOUNT_UCS; /* 0x8 */
        i = 0;
        while (i != g_DataAccount[ItemNum].iFdcs)
        {
            myMsgPtr->name.name[i] = g_DataAccount[ItemNum].DataAccountName[i + 1];
            myMsgPtr->name.name[i + 1] = g_DataAccount[ItemNum].DataAccountName[i];
            i += 2;
        }
        myMsgPtr->name.name[i] = '\0';
        myMsgPtr->name.name[i + 1] = '\0';
    }
    else
    {
        myMsgPtr->name.name_dcs = DATA_ACCOUNT_ASCII;
        mmi_ucs2_to_asc((PS8) DataAccountName_ASCII, (PS8) g_DataAccount[ItemNum].DataAccountName);
        myMsgPtr->name.name_length = strlen((PS8) DataAccountName_ASCII);
        memcpy(myMsgPtr->name.name, DataAccountName_ASCII, strlen((PS8) DataAccountName_ASCII) /* +1 */ );
        g_DataAccount[ItemNum].iFdcs = 0;
    }

    memcpy(myMsgPtr->user_id, g_DataAccount[ItemNum].UserName, strlen((PS8) g_DataAccount[ItemNum].UserName) + 1);

    memcpy(myMsgPtr->passwd, g_DataAccount[ItemNum].Passwd, strlen((PS8) g_DataAccount[ItemNum].Passwd) + 1);

    if (g_DataAccount[ItemNum].DialNumber[0] == '+')
    {
        mmi_ucs2_to_asc((PS8) pbNumber_ASCII, (PS8) g_DataAccount[ItemNum].DialNumber + ENCODING_LENGTH);
        myMsgPtr->dest.type = MMI_CSMCC_INTERNATIONAL_ADDR; /* INTERNATIONAL */
        myMsgPtr->dest.length = strlen((PS8) pbNumber_ASCII) + 1;
        memcpy(myMsgPtr->dest.number, pbNumber_ASCII, strlen((PS8) pbNumber_ASCII) + 1);
    }
    else
    {
        mmi_ucs2_to_asc((PS8) pbNumber_ASCII, (PS8) g_DataAccount[ItemNum].DialNumber);
        myMsgPtr->dest.type = MMI_CSMCC_DEFAULT_ADDR_TYPE;  /* DEFAULT */
        myMsgPtr->dest.length = strlen((PS8) pbNumber_ASCII) + 1;
        memcpy(myMsgPtr->dest.number, pbNumber_ASCII, strlen((PS8) pbNumber_ASCII) + 1);

    }

#ifdef __MMI_CCA_OMACP_BOOTSTRAP_UPDATE_SUPPORT__
    /* 4 fields new added for csd account(g_DataAccount[ItemNum]-->L4C) */
    memcpy(myMsgPtr->prov_url, g_DataAccount[ItemNum].provurl_hash_val, MMI_DTCNT_PROVURL_HASH_LEN);
    memcpy(myMsgPtr->napid, g_DataAccount[ItemNum].napid_hash_val, MMI_DTCNT_NAPID_HASH_LEN);
    myMsgPtr->account_type = g_DataAccount[ItemNum].acct_type;
#endif /* __MMI_CCA_OMACP_BOOTSTRAP_UPDATE_SUPPORT__ */
    myMsgPtr->read_only = g_DataAccount[ItemNum].readonly;

    myMsgPtr->profile_type = DATA_ACCT_CSD_PROF;
    Message.oslSrcId = MOD_MMI;
    Message.oslDestId = MOD_L4C;
    Message.oslMsgId = PRT_MMI_CC_SET_CSD_PROFILE_REQ;
    Message.oslDataPtr = (oslParaType*) myMsgPtr;
    Message.oslPeerBuffPtr = NULL;
    SetProtocolEventHandler(DTCNTSetAccountRsp, PRT_MMI_CC_SET_CSD_PROFILE_RSP);
    OslMsgSendExtQueue(&Message);
    ClearInputEventHandler(MMI_DEVICE_ALL);
}


/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTProgress
 * DESCRIPTION
 *  Progress screen before got response from L4
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDTCNTProgress(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_DTCNT_POPUP, NULL, EntryDTCNTProgress, NULL);

    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_POPUP);

    ShowCategory66Screen
        (STR_GLOBAL_DATA_ACCOUNT, GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID), 0, 0, 0, 0,
         (PU8) GetString(STR_GLOBAL_SAVING), IMG_GLOBAL_SAVE, NULL);
}


/*****************************************************************************
 * FUNCTION
 *  DTCNTSetAccountRsp
 * DESCRIPTION
 *  Handler when set data account complete
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void DTCNTSetAccountRsp(void *info)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_cc_set_csd_profile_rsp_struct *localPtr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    localPtr = (mmi_cc_set_csd_profile_rsp_struct*) info;

    if (localPtr->result == KAL_TRUE /* OK */ )
    {
        g_DataAccount[g_DataAccount_Display.CurrSelectItem].Present = 'P';
        ShowDataAccountOKMessage();
    }
    else
    {
        DisplayPopup(
            (PU8) GetString(STR_GLOBAL_NOT_DONE),
            IMG_GLOBAL_UNFINISHED,
            1,
            DATA_ACCOUNT_NOTIFY_TIMEOUT,
            ERROR_TONE);
        /* micha0427 */
        DeleteScreenIfPresent(SCR_ID_DTCNT_EDIT);
    }

}


/*****************************************************************************
 * FUNCTION
 *  DTCNTGetAccountReq
 * DESCRIPTION
 *  Use the L4 to retrieve the Data Account Record.
 * PARAMETERS
 *  ItemNum     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void DTCNTGetAccountReq(U8 ItemNum)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_cc_get_csd_profile_req_struct *myMsgPtr;
    MYQUEUE Message;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    myMsgPtr = (mmi_cc_get_csd_profile_req_struct*) OslConstructDataPtr(sizeof(mmi_cc_get_csd_profile_req_struct));
    myMsgPtr->prof_id = ItemNum;
    myMsgPtr->profile_type = DATA_ACCT_CSD_PROF;
    
    SetProtocolEventHandler(DTCNTGetAccountRsp, PRT_MMI_CC_GET_CSD_PROFILE_RSP);
    Message.oslSrcId = MOD_MMI;
    Message.oslDestId = MOD_L4C;
    Message.oslMsgId = PRT_MMI_CC_GET_CSD_PROFILE_REQ;
    Message.oslDataPtr = (oslParaType*) myMsgPtr;
    Message.oslPeerBuffPtr = NULL;
    OslMsgSendExtQueue(&Message);
}


/*****************************************************************************
 * FUNCTION
 *  DTCNTGetAccountRsp
 * DESCRIPTION
 *  Handler when get data account complete
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void DTCNTGetAccountRsp(void *info)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_cc_get_csd_profile_rsp_struct *localPtr;
    U8 ItemNum = 0, i = 0;
    U8 name_length = MAX_DATA_ACCOUNT_NAME_LEN * ENCODING_LENGTH;
    S8 AccountNameStr[30 * ENCODING_LENGTH];    /* Assumption:  string "Data Account " length < 30 */
#if !defined(__MMI_GPRS_FEATURES__)
    FuncPtr temp_callback = NULL;
#endif /* !defined(__MMI_GPRS_FEATURES__) */
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    localPtr = (mmi_cc_get_csd_profile_rsp_struct*) info;
    ItemNum = g_DataAccount_Display.CurrGetIndex;
    memset(&g_DataAccount[ItemNum], '\0', sizeof(DataAccountNode));
    g_DataAccount[ItemNum].Present = 'P';

    if (localPtr->type == (U8) CSMCC_ITC_3_1_K_AUDIO)
    {
        g_DataAccount[ItemNum].DialType = DIAL_TYPE_ANALOGUE;
    }
    else
    {
        g_DataAccount[ItemNum].DialType = DIAL_TYPE_ISDN;
    }

    if (localPtr->rate == (U8) CSD_PROF_RATE_4800)
    {
        g_DataAccount[ItemNum].DataRate = DATA_RATE_FOUR_EIGHT -1;
    }
    else if (localPtr->rate == (U8) CSD_PROF_RATE_9600)
    {
        g_DataAccount[ItemNum].DataRate = DATA_RATE_NINE_SIX - 1;
    }
    else if (localPtr->rate == (U8) CSD_PROF_RATE_14400)
    {
        g_DataAccount[ItemNum].DataRate = DATA_RATE_FOURTEEN_FOUR - 1;
    }

    for (i = 0; i < 4; i++)
    {
        g_DataAccount[ItemNum].DnsAddress[i] = (U8) localPtr->dns[i];
    }

    SetDynaDataAccountName(AccountNameStr, ItemNum);

    /* micha0307 */
    if (localPtr->name.name_dcs == DATA_ACCOUNT_UCS)
    {
        name_length = MAX_DATA_ACCOUNT_NAME_LEN * ENCODING_LENGTH;
        if (name_length >= localPtr->name.name_length)
        {
            name_length = localPtr->name.name_length;
        }
        else
        {
            MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_NAME_GET_FROM_L4C_ERROR, localPtr->name.name_length);
        }
        
        i = 0;
        g_DataAccount[ItemNum].iFdcs = name_length + ENCODING_LENGTH;

        if (name_length == 0)
        {
            mmi_ucs2cpy((PS8) g_DataAccount[ItemNum].DataAccountName, (PS8) AccountNameStr);
        }
        else
        {
            while (i < name_length)
            {
                g_DataAccount[ItemNum].DataAccountName[i] = localPtr->name.name[i + 1];
                g_DataAccount[ItemNum].DataAccountName[i + 1] = localPtr->name.name[i];
                i += 2;
            }
            g_DataAccount[ItemNum].DataAccountName[name_length] = 0x00;
            g_DataAccount[ItemNum].DataAccountName[name_length + 1] = 0x00;
        }
    }
    else if (localPtr->name.name_dcs == DATA_ACCOUNT_ASCII)
    {
        name_length = MAX_DATA_ACCOUNT_NAME_LEN;
        if (name_length >= localPtr->name.name_length)
        {
            name_length = localPtr->name.name_length;
        }
        else
        {
            MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_NAME_GET_FROM_L4C_ERROR, localPtr->name.name_length);
        }
    
        if (name_length == 0)
        {
            mmi_ucs2cpy((PS8) g_DataAccount[ItemNum].DataAccountName, (PS8) AccountNameStr);
        }
        else
        {
            mmi_asc_n_to_ucs2(
                (PS8) g_DataAccount[ItemNum].DataAccountName,
                (PS8) localPtr->name.name,
                name_length);
        }
        g_DataAccount[ItemNum].iFdcs = 0;
    }

    strcpy((PS8) g_DataAccount[ItemNum].UserName, (PS8) localPtr->user_id);
    strcpy((PS8) g_DataAccount[ItemNum].Passwd, (PS8) localPtr->passwd);

    if ((localPtr->dest.type) & 0x10)
    {
        g_DataAccount[ItemNum].DialNumber[0] = '+';
        mmi_asc_to_ucs2((PS8) g_DataAccount[ItemNum].DialNumber + 2, (PS8) localPtr->dest.number);
    }
    else
    {
        mmi_asc_to_ucs2((PS8) g_DataAccount[ItemNum].DialNumber, (PS8) localPtr->dest.number);
    }

#ifdef __MMI_CCA_OMACP_BOOTSTRAP_UPDATE_SUPPORT__
    /* 4 fields new added for csd account(L4C-->g_DataAccount[ItemNum] */
    memcpy(g_DataAccount[ItemNum].provurl_hash_val, localPtr->prov_url, MMI_DTCNT_PROVURL_HASH_LEN);
    memcpy(g_DataAccount[ItemNum].napid_hash_val, localPtr->napid, MMI_DTCNT_NAPID_HASH_LEN);
    g_DataAccount[ItemNum].acct_type = localPtr->account_type;
#endif /* __MMI_CCA_OMACP_BOOTSTRAP_UPDATE_SUPPORT__ */
    g_DataAccount[ItemNum].readonly = localPtr->read_only;

    if ((mmi_ucs2strlen((PS8) g_DataAccount[ItemNum].DataAccountName) == 0) &&
        (mmi_ucs2strlen((PS8) g_DataAccount[ItemNum].DialNumber) == 0))
    {
        g_DataAccount[ItemNum].Present = 'E';
    }

    if (g_DataAccount_Display.CurrGetIndex < MAX_DATA_ACCOUNT_GSM_LIMIT - 1)
    {
        g_DataAccount_Display.CurrGetIndex++;
        DTCNTGetAccountReq(g_DataAccount_Display.CurrGetIndex);
    }
    else
    {
        g_DataAccount_Display.CurrGetIndex = 0;

    #ifdef __MMI_GPRS_FEATURES__
        DTCNTGPRSGetAccountReq(0);
    #else /* __MMI_GPRS_FEATURES__ */ 
        #if defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__)
        g_DataAccount_Display.check_status = FALSE;
        #endif /*  defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__) */
        temp_callback = g_DTCNTReadyCallback;
        g_DTCNTReadyCallback = NULL;
    #ifdef __MMI_CBM_CONNECTION_MANAGER__
        g_cbm_dtcnt_init_status = FALSE;
    #endif /* __MMI_CBM_CONNECTION_MANAGER__ */
        temp_callback();
    #endif /* __MMI_GPRS_FEATURES__ */ 
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTMain
 * DESCRIPTION
 *  Data account main screen ( including GSM/GPPRS)
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDTCNTMain(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U16 nNumofItem;                     /* Stores no of children in the submenu */
    U16 nDispAttribute;                 /* Stores display attribue */
    U8 *u8GPRSCount[MAX_SUB_MENUS];     /* sms counters for display hint popups */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* Retrieve no of child of menu item to be displayed */
    nNumofItem = GetNumOfChild_Ext(SERVICES_DATA_CONNECT_MAIN_MENU_ID);

    if(nNumofItem == 1)
    {
        InitializeDataAccountRecords();
        return;
    }
    
    EntryNewScreen(SCR_ID_DTCNT_MAIN, NULL, EntryDTCNTMain, NULL);

    /* Get current screen to gui buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_MAIN);
    /* Retrieve no of child of menu item to be displayed */
    nNumofItem = GetNumOfChild_Ext(SERVICES_DATA_CONNECT_MAIN_MENU_ID);
    /* Get attribute of menu to be displayed */
    nDispAttribute = GetDispAttributeOfItem(SERVICES_DATA_CONNECT_MAIN_MENU_ID);
    /* Retrieve string ids in sequence of given menu item to be displayed */
    GetSequenceStringIds_Ext(SERVICES_DATA_CONNECT_MAIN_MENU_ID, nStrItemList);
    /* Set current parent id */
    SetParentHandler(SERVICES_DATA_CONNECT_MAIN_MENU_ID);
    /* Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);
    /* construct hint popups for the menu items */
    ConstructHintsList(SERVICES_DATA_CONNECT_MAIN_MENU_ID, u8GPRSCount);

    /* Display Category52 Screen */
    ShowCategory52Screen(
        SERVICES_DATA_CONNECT_MAIN_STRING_ID,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        u8GPRSCount,
        0,
        0,
        guiBuffer);

    /* Register left arrow key */
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    /* Register function with left/right softkey */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    return;
}

#ifdef __MMI_GPRS_FEATURES__

/*****************************************************************************
 * FUNCTION
 *  InitializeGPRSDataAccountRecords
 * DESCRIPTION
 *  Retrieve GPRS data account from L4
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void InitializeGPRSDataAccountRecords(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DataAccountReadyCheck(EntryDTCNTGPRSList);
}


/*****************************************************************************
 * FUNCTION
 *  DTCNTGPRSGetAccountReq
 * DESCRIPTION
 *  Retrieve GPRS data account from L4
 * PARAMETERS
 *  ItemNum     [IN]        //item id
 * RETURNS
 *  void
 *****************************************************************************/
void DTCNTGPRSGetAccountReq(U8 ItemNum)
{
#ifdef __MMI_GPRS_FEATURES__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_ps_get_gprs_data_account_req_struct *myMsgPtr;

    MYQUEUE Message;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    myMsgPtr =
        (mmi_ps_get_gprs_data_account_req_struct*)
        OslConstructDataPtr(sizeof(mmi_ps_get_gprs_data_account_req_struct));

    myMsgPtr->profile_id = ItemNum + 1;
    myMsgPtr->profile_type = DATA_ACCT_GPRS_PROF;

    Message.oslSrcId = MOD_MMI;
    Message.oslDestId = MOD_L4C;
    Message.oslMsgId = PRT_MMI_PS_GET_GPRS_DATA_ACCOUNT_REQ;
    Message.oslDataPtr = (oslParaType*) myMsgPtr;
    Message.oslPeerBuffPtr = NULL;

    SetProtocolEventHandler(DTCNTGPRSGetAccountRsp, PRT_MMI_PS_GET_GPRS_DATA_ACCOUNT_RSP);
    OslMsgSendExtQueue(&Message);

#endif /* __MMI_GPRS_FEATURES__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  DTCNTGPRSGetAccountRsp
 * DESCRIPTION
 *  Handle data account get response
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void DTCNTGPRSGetAccountRsp(void *info)
{
#ifdef __MMI_GPRS_FEATURES__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_ps_get_gprs_data_account_rsp_struct *localPtr;
    U8 ItemNum = 0, i = 0;
    U8 name_length = MAX_GPRS_DATAACCOUNT_NAME * ENCODING_LENGTH;
    S8 AccountNameStr[30 * ENCODING_LENGTH];    /* Assumption:  string "Data Account " length < 30 */
    FuncPtr temp_callback = NULL;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    localPtr = (mmi_ps_get_gprs_data_account_rsp_struct*) info;

    ItemNum = g_DataAccount_Display.GPRSCurrGetIndex;

    memset(&g_GPRS_DataAccount[ItemNum], '\0', sizeof(GPRSDataAccountNode));

    g_GPRS_DataAccount[ItemNum].Present = 'P';

    g_GPRS_DataAccount[ItemNum].AuthType = localPtr->gprs_account.authentication_type;

    for (i = 0; i < 4; i++)
    {
        g_GPRS_DataAccount[ItemNum].DnsAddress[i] = (U8) localPtr->gprs_account.dns[i];
    }

    SetDynaDataAccountName(AccountNameStr, ItemNum);

    /* micha0307 */
    if (localPtr->gprs_account.name_dcs == DATA_ACCOUNT_UCS)
    {
        name_length = MAX_GPRS_DATAACCOUNT_NAME * ENCODING_LENGTH;
        if (name_length >= localPtr->gprs_account.name_length)
        {
            name_length = localPtr->gprs_account.name_length;
        }
        else
        {
            MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_NAME_GET_FROM_L4C_ERROR, localPtr->gprs_account.name_length);
        }

        i = 0;
        g_GPRS_DataAccount[ItemNum].iFdcs = name_length + ENCODING_LENGTH;

        if (name_length == 0)
        {
            mmi_ucs2cpy((PS8) g_GPRS_DataAccount[ItemNum].DataAccountName, (PS8) AccountNameStr);
        }
        else
        {
            while (i < name_length)
            {
                g_GPRS_DataAccount[ItemNum].DataAccountName[i] = localPtr->gprs_account.name[i + 1];
                g_GPRS_DataAccount[ItemNum].DataAccountName[i + 1] = localPtr->gprs_account.name[i];
                i += 2;
            }
            g_GPRS_DataAccount[ItemNum].DataAccountName[name_length] = 0x00;
            g_GPRS_DataAccount[ItemNum].DataAccountName[name_length + 1] = 0x00;
        }
    }
    else if (localPtr->gprs_account.name_dcs == DATA_ACCOUNT_ASCII)
    {
        name_length = MAX_GPRS_DATAACCOUNT_NAME * ENCODING_LENGTH;
        if (name_length >= localPtr->gprs_account.name_length)
        {
            name_length = localPtr->gprs_account.name_length;
        }
        else
        {
            MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_NAME_GET_FROM_L4C_ERROR, localPtr->gprs_account.name_length);
        }

        if (name_length == 0)
        {
            mmi_ucs2cpy((PS8) g_GPRS_DataAccount[ItemNum].DataAccountName, (PS8) AccountNameStr);
        }
        else
        {
            mmi_asc_n_to_ucs2(
                (PS8) g_GPRS_DataAccount[ItemNum].DataAccountName,
                (PS8) localPtr->gprs_account.name,
                name_length);
        }
        g_GPRS_DataAccount[ItemNum].iFdcs = 0;
    }

    strcpy((PS8) g_GPRS_DataAccount[ItemNum].UserName, (PS8) localPtr->gprs_account.user_name);

    strcpy((PS8) g_GPRS_DataAccount[ItemNum].Passwd, (PS8) localPtr->gprs_account.password);

    mmi_asc_n_to_ucs2(
        (PS8) g_GPRS_DataAccount[ItemNum].APN,
        (PS8) localPtr->gprs_account.apn,
        (U32) localPtr->gprs_account.apn_length);

#ifdef __MMI_CCA_OMACP_BOOTSTRAP_UPDATE_SUPPORT__
    /* 4 fields new added for gprs account(L4C-->g_GPRS_DataAccount[]) */
    memcpy(g_GPRS_DataAccount[ItemNum].provurl_hash_val, localPtr->gprs_account.provurl, MMI_DTCNT_PROVURL_HASH_LEN);
    memcpy(g_GPRS_DataAccount[ItemNum].napid_hash_val, localPtr->gprs_account.napid, MMI_DTCNT_NAPID_HASH_LEN);
    g_GPRS_DataAccount[ItemNum].acct_type = localPtr->gprs_account.account_type;
#endif /* __MMI_CCA_OMACP_BOOTSTRAP_UPDATE_SUPPORT__ */
    g_GPRS_DataAccount[ItemNum].readonly = localPtr->gprs_account.read_only;

    if ((mmi_ucs2strlen((PS8) g_GPRS_DataAccount[ItemNum].DataAccountName) == 0) &&
        (mmi_ucs2strlen((PS8) g_GPRS_DataAccount[ItemNum].APN) == 0))
    {
        g_GPRS_DataAccount[ItemNum].Present = 'E';
    }
#if 0
#ifdef __MMI_OP01_GPRS_DATACFG__
/* under construction !*/
#else /* __MMI_OP01_GPRS_DATACFG__ */
/* under construction !*/
#endif /* __MMI_OP01_GPRS_DATACFG__ */
#endif /* 0 */
    if (g_DataAccount_Display.GPRSCurrGetIndex < MAX_DATA_ACCOUNT_GPRS_LIMIT - 1)
    {
        g_DataAccount_Display.GPRSCurrGetIndex++;
        DTCNTGPRSGetAccountReq(g_DataAccount_Display.GPRSCurrGetIndex);
    }
    else
    {
        g_DataAccount_Display.GPRSCurrGetIndex = 0;
        #if defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__)
        g_DataAccount_Display.check_status = FALSE;
        #endif /* defined (SYNCML_DM_SUPPORT) && defined(__MMI_CCA_SUPPORT__) */
        temp_callback = g_DTCNTReadyCallback;
        g_DTCNTReadyCallback = NULL;
    #ifdef __MMI_CBM_CONNECTION_MANAGER__
        g_cbm_dtcnt_init_status = FALSE;
    #endif /* __MMI_CBM_CONNECTION_MANAGER__ */
        temp_callback();
    }

#endif /* __MMI_GPRS_FEATURES__ */ 
}


#define ALWAYS_ASK_GPRS
/*****************************************************************************
 * FUNCTION
 *  HighlightGPRSAppDTCNTList
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_gprs_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_always_ask.GPRSCurrAASelectItem = (U8) nIndex;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_gprs_always_ask_list
 * DESCRIPTION
 *  shows the main menu list
 *  
 *  This is used to shows the main menu list of data account
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_entry_gprs_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer = NULL;
    U8 i = 0;
    U8 *DataAccountName[MAX_DATA_ACCOUNT_GPRS_LIMIT];
    static U8 *PopUpDescription[MAX_DATA_ACCOUNT_GPRS_LIMIT];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_DUAL_SIM_MASTER__
    if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
#else /* __MMI_DUAL_SIM_MASTER__ */
    if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
#endif /*__MMI_DUAL_SIM_MASTER__*/    
    {
        /* Not allow to verify phone lock if SIM card is blocked */
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_EMPTY),
            IMG_GLOBAL_UNFINISHED,
            1,
            DATA_ACCOUNT_NOTIFY_TIMEOUT,
            (U8) ERROR_TONE);
        return;
    }

    for (i = 0; i < MAX_DATA_ACCOUNT_GPRS_LIMIT; i++)
    {
        /* micha0307 */
        DataAccountName[i] = g_GPRS_DataAccount[i].DataAccountName;
        if (mmi_ucs2strlen((PS8) g_GPRS_DataAccount[i].APN) > 0)
        {
            PopUpDescription[i] = g_GPRS_DataAccount[i].APN;
        }
        else
        {
            PopUpDescription[i] = (U8*) GetString(STR_GLOBAL_EMPTY_LIST);
        }
    }

    EntryNewScreen(SCR_ID_DTCNT_AA_GPRS_LIST, NULL, mmi_dtcnt_always_ask_entry_gprs_list, NULL);

    /* code for Q03C orginally */
    DeleteScreenIfPresent(SCR_ID_DTCNT_AA_GPRS_LIST);

    SetDelScrnIDCallbackHandler(SCR_ID_DTCNT_AA_GPRS_LIST, (HistoryDelCBPtr) mmi_dtcnt_always_ask_gprs_list_del_hdlr);

    /* guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_AA_GPRS_LIST); */
    guiBuffer = NULL;

    RegisterHighlightHandler(mmi_dtcnt_always_ask_gprs_highlight_hdlr);

    ShowCategory53Screen(
        STR_GLOBAL_DATA_ACCOUNT,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MMI_DTCNT_DISP_GPRS_NUM,
        (U8 **) DataAccountName,
        (PU16) gIndexIconsImageList,
        PopUpDescription,
        0,
        g_mmi_dtcnt_always_ask.GPRSCurrAASelectItem,
        guiBuffer);

    /* Register function for left soft key */
    SetLeftSoftkeyFunction(mmi_dtcnt_always_ask_gprs_list_select_ok, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_always_ask_gprs_list_select_ok, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  GPRSAppDTCNTSelectOK
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_always_ask_gprs_list_select_ok(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FuncPtrU32Ext temp_callback_ext_ptr = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_mmi_dtcnt_always_ask.app_callback_ext)
    {
        kal_uint32 id;

        abm_bearer2nw_id(ABM_E_SOCKET_BEARER_GSM_GPRS, g_mmi_dtcnt_always_ask.GPRSCurrAASelectItem + 1, &id);
        id = cbm_encode_data_account_id(id, 0, 0, 0);
    #ifdef __MMI_DUAL_SIM__
        /* id = cbm_encode_data_account_id(id, g_always_ask_sim_info, 0, 0); */
    #else /* __MMI_DUAL_SIM__ */
        g_always_ask_sim_info = 0;
    #endif /* __MMI_DUAL_SIM__ */

        /* return U32 acct id */
        temp_callback_ext_ptr = g_mmi_dtcnt_always_ask.app_callback_ext;
        g_mmi_dtcnt_always_ask.app_callback_ext = NULL;
        DeleteUptoScrID(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
        GoBackHistory();

        if (temp_callback_ext_ptr)
        {
            /* MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_ID, id); */
            temp_callback_ext_ptr(id, TRUE, g_always_ask_sim_info);
        }
    }
    else
    {
        MMI_ASSERT(0);
    }
}


/*****************************************************************************
* FUNCTION
*  mmi_dtcnt_always_ask_gprs_list_del_hdlr
* DESCRIPTION
*  
* PARAMETERS
*  in_param        [?]     
* RETURNS
*  void
*****************************************************************************/
U8 mmi_dtcnt_always_ask_gprs_list_del_hdlr(void *in_param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_CBM_ALWAYS_ASK__
    FuncPtrU32Ext temp_callback_ext_ptr = NULL;
#endif /* __MMI_CBM_ALWAYS_ASK__ */
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_CBM_ALWAYS_ASK__
    PRINT_INFORMATION("$$$$$ mmi_dtcnt_gprs_list_screen_del_handler app_call = %d, del_handler_flag = %d $$$$$", 
        0, g_always_ask_screen_del_handler_flag);

    if(IsScreenPresent(SCR_ID_DTCNT_LIST_ALWAYS_ASK))
    {
        return FALSE;
    }
    if(!g_always_ask_screen_del_handler_flag)
    {
        g_always_ask_screen_del_handler_flag = TRUE;
        if(g_mmi_dtcnt_always_ask.app_callback_ext)
        {
            temp_callback_ext_ptr = g_mmi_dtcnt_always_ask.app_callback_ext;
            g_mmi_dtcnt_always_ask.app_callback_ext = NULL;
        }
        if (temp_callback_ext_ptr)
        {
            temp_callback_ext_ptr(0, FALSE, 0);
        }
    }
#endif /* __MMI_CBM_ALWAYS_ASK__ */
    return FALSE;
}


#define APP_SELECT_GPRS
/*****************************************************************************
 * FUNCTION
 *  HighlightGPRSAppDTCNTList
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightGPRSAppDTCNTList(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = (U8) nIndex;
}


#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_CBM_ALWAYS_ASK__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_CBM_ALWAYS_ASK__ */
/* under construction !*/
/* under construction !*/
#endif /* 0 */


/*****************************************************************************
 * FUNCTION
 *  EntryGPRSAppDTCNTList
 * DESCRIPTION
 *  shows the main menu list
 *  
 *  This is used to shows the main menu list of data account
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryGPRSAppDTCNTList(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer = NULL;
    U8 i = 0;
    U8 *DataAccountName[MAX_DATA_ACCOUNT_GPRS_LIMIT];
    static U8 *PopUpDescription[MAX_DATA_ACCOUNT_GPRS_LIMIT];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_DUAL_SIM_MASTER__
    if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
#else /* __MMI_DUAL_SIM_MASTER__ */
    if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
#endif /*__MMI_DUAL_SIM_MASTER__*/    
    {
        /* Not allow to verify phone lock if SIM card is blocked */
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_EMPTY),
            IMG_GLOBAL_UNFINISHED,
            1,
            DATA_ACCOUNT_NOTIFY_TIMEOUT,
            (U8) ERROR_TONE);
        return;
    }

    for (i = 0; i < MAX_DATA_ACCOUNT_GPRS_LIMIT; i++)
    {
        /* micha0307 */
        DataAccountName[i] = g_GPRS_DataAccount[i].DataAccountName;
        if (mmi_ucs2strlen((PS8) g_GPRS_DataAccount[i].APN) > 0)
        {
            PopUpDescription[i] = g_GPRS_DataAccount[i].APN;
        }
        else
        {
            PopUpDescription[i] = (U8*) GetString(STR_GLOBAL_EMPTY_LIST);
        }
    }

    EntryNewScreen(SCR_ID_DTCNT_GPRS_LIST, NULL, EntryGPRSAppDTCNTList, NULL);

    /* code for Q03C originally */
    DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_CONFIRM);

    /* guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_GPRS_LIST); */
    guiBuffer = NULL;

    RegisterHighlightHandler(HighlightGPRSAppDTCNTList);

    ShowCategory53Screen(
        STR_GLOBAL_DATA_ACCOUNT,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MMI_DTCNT_DISP_GPRS_NUM,
        (U8 **) DataAccountName,
        (PU16) gIndexIconsImageList,
        PopUpDescription,
        0,
        g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem,
        guiBuffer);

    /* Register function for left soft key */
    SetLeftSoftkeyFunction(GPRSAppDTCNTSelectOK, KEY_EVENT_UP);
    SetKeyHandler(GPRSAppDTCNTSelectOK, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(mmi_dtcnt_select_account_gprs_back, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_select_account_gprs_back, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  GPRSAppDTCNTSelectOK
 * DESCRIPTION
 *  highlight handler for DTCNTAppList
 *  
 *  Index values start on zero for first Listesd item.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void GPRSAppDTCNTSelectOK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_dtcnt_account_selection.app_callback)
    {
        kal_uint32 id;
        /* code for Q03C orginally */
        if(g_dtcnt_list_cnt.switch_bearer_flag)
        {
            g_mmi_dtcnt_account_selection.app_callback = mmi_dtcnt_list_callback_gprs;
            DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_CONFIRM);
            mmi_dtcnt_list_by_app_confirm(STR_ID_DTCNT_SELECT_GSM_CSD, mmi_dtcnt_list_by_app_confirm_csd);
        }
        abm_bearer2nw_id(ABM_E_SOCKET_BEARER_GSM_GPRS, g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem + 1, &id);
#ifdef __MMI_DUAL_SIM__
        id = cbm_encode_data_account_id(id, g_sim_info, 0, 0);
#else /* __MMI_DUAL_SIM__ */
        id = cbm_encode_data_account_id(id, 0, 0, 0);
#endif /* __MMI_DUAL_SIM__ */
        /* return U32 acct id */
        /* MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_ID, id); */
        g_mmi_dtcnt_account_selection.app_callback(id);
        g_mmi_dtcnt_account_selection.app_callback = NULL;
    }
    else
    {
        MMI_ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_account_gprs_back
 * DESCRIPTION
 *  
 * PARAMETERS
 *         
 * RETURNS
 *  
 *****************************************************************************/
static void mmi_dtcnt_select_account_gprs_back(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_bearer_num_flag)
    {
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_DUAL_SIM);
    }
    g_entry_option_back_flag = TRUE;
    GoBackHistory();
}


#define EDIT_LIST_GPRS
/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTGPRSList
 * DESCRIPTION
 *  Main screen for GPRS data account
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDTCNTGPRSList(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer = NULL;
    U8 i = 0;
    U8 *DataAccountName[MAX_DATA_ACCOUNT_GPRS_LIMIT];
    static U8 *PopUpDescription[MAX_DATA_ACCOUNT_GPRS_LIMIT];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_DUAL_SIM_MASTER__
    if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
#else /* __MMI_DUAL_SIM_MASTER__ */
    if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
#endif /*__MMI_DUAL_SIM_MASTER__*/    
    {
        /* Not allow to verify phone lock if SIM card is blocked */
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_EMPTY),
            IMG_GLOBAL_UNFINISHED,
            1,
            DATA_ACCOUNT_NOTIFY_TIMEOUT,
            (U8) ERROR_TONE);
        return;
    }

    for (i = 0; i < MAX_DATA_ACCOUNT_GPRS_LIMIT; i++)
    {
        /* micha0307 */
        DataAccountName[i] = g_GPRS_DataAccount[i].DataAccountName;
        if (mmi_ucs2strlen((PS8) g_GPRS_DataAccount[i].APN) > 0)
        {
            PopUpDescription[i] = g_GPRS_DataAccount[i].APN;
        }
        else
        {
            PopUpDescription[i] = (U8*) GetString(STR_GLOBAL_EMPTY_LIST);
        }
    }

    EntryNewScreen(SCR_ID_DTCNT_GPRS_LIST, NULL, InitializeGPRSDataAccountRecords, NULL);

    /* guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_GPRS_LIST); */
    guiBuffer = NULL;
    
    SetParentHandler(SERVICES_DATA_CONNECT_GPRS_MENU_ID);

    RegisterHighlightHandler(HighlightDTCNTGPRSList);

    ShowCategory53Screen(
#ifdef __MMI_GPRS_FEATURES__
        SERVICES_DATA_CONNECT_GPRS_STRING_ID,
#else /* __MMI_GPRS_FEATURES__ */
        STR_GLOBAL_DATA_ACCOUNT,
#endif /* __MMI_GPRS_FEATURES__ */
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_EDIT,
        IMG_ID_DTCNT_LSK_EDIT,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MMI_DTCNT_DISP_GPRS_NUM,
        (U8 **) DataAccountName,
        (PU16) gIndexIconsImageList,
        PopUpDescription,
        0,
        g_DataAccount_Display.GPRSCurrSelectItem,
        guiBuffer);


    /* Register function for left soft key */
    SetLeftSoftkeyFunction(InitInLineGPRSDataAccount, KEY_EVENT_UP);
    SetKeyHandler(InitInLineGPRSDataAccount, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

    SetDelScrnIDCallbackHandler(SCR_ID_DTCNT_GPRS_LIST, mmi_dtcnt_exit_list_hdlr);
}


/*****************************************************************************
 * FUNCTION
 *  HighlightDTCNTGPRSList
 * DESCRIPTION
 *  get current GPRS menu item index
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightDTCNTGPRSList(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_DataAccount_Display.GPRSCurrSelectItem = (U8) nIndex;
    if (g_GPRS_DataAccount[nIndex].readonly)
    {
        ChangeLeftSoftkey(STR_GLOBAL_DETAILS, IMG_GLOBAL_OK);
    }
    else
    {
        ChangeLeftSoftkey(STR_GLOBAL_EDIT, IMG_ID_DTCNT_LSK_EDIT);
    }
}


/*****************************************************************************
 * FUNCTION
 *  InitInLineGPRSDataAccount
 * DESCRIPTION
 *  Set account data to display
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void InitInLineGPRSDataAccount(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    U8 i = g_DataAccount_Display.GPRSCurrSelectItem;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_ucs2cpy((PS8) g_DataAccount_Display.DataAccountName, (PS8) g_GPRS_DataAccount[i].DataAccountName);
    mmi_ucs2cpy((PS8) g_DataAccount_Display.APN, (PS8) g_GPRS_DataAccount[i].APN);
    mmi_asc_to_ucs2((PS8) g_DataAccount_Display.UserName, (PS8) g_GPRS_DataAccount[i].UserName);
    mmi_asc_to_ucs2((PS8) g_DataAccount_Display.Passwd, (PS8) g_GPRS_DataAccount[i].Passwd);

    ReturnThreeDigitString(g_DataAccount_Display.IP1, g_GPRS_DataAccount[i].DnsAddress[0]);
    ReturnThreeDigitString(g_DataAccount_Display.IP2, g_GPRS_DataAccount[i].DnsAddress[1]);
    ReturnThreeDigitString(g_DataAccount_Display.IP3, g_GPRS_DataAccount[i].DnsAddress[2]);
    ReturnThreeDigitString(g_DataAccount_Display.IP4, g_GPRS_DataAccount[i].DnsAddress[3]);

    g_DataAccount_Display.AuthType = (S32) g_GPRS_DataAccount[i].AuthType;

    g_DataAccount_Display.AuthTypeOption[0] = (U8*) GetString(STR_ID_DTCNT_GPRS_PAP_AUTH);
    g_DataAccount_Display.AuthTypeOption[1] = (U8*) GetString(STR_ID_DTCNT_GPRS_CHAP_AUTH);

    /* 4 fields new added for gprs account(g_GPRS_DataAccount[]-->Display) */
    memcpy(g_DataAccount_Display.provurl_hash_val, g_GPRS_DataAccount[i].provurl_hash_val, MMI_DTCNT_PROVURL_HASH_LEN);
    memcpy(g_DataAccount_Display.napid_hash_val, g_GPRS_DataAccount[i].napid_hash_val, MMI_DTCNT_NAPID_HASH_LEN);
    g_DataAccount_Display.acct_type = g_GPRS_DataAccount[i].acct_type;
    g_DataAccount_Display.readonly = g_GPRS_DataAccount[i].readonly;

    EntryDTCNTGPRSEdit();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_gprs_editor_highlight_hdlr
 * DESCRIPTION
 *
 * PARAMETERS
 *
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_gprs_editor_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_DataAccount_Display.readonly)
    {
        ChangeLeftSoftkey(0, 0);
        ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTGPRSEdit
 * DESCRIPTION
 *  GPRS account editing screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDTCNTGPRSEdit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *inputBuffer;    /* added for inline edit history */
    U8 *guiBuffer;      /* Buffer holding history data */
    U16 inputBufferSize;
    U16 title_id = STR_GLOBAL_EDIT;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_DTCNT_GPRS_EDIT, ExitDTCNTGPRSEdit, NULL, NULL);

    InitializeCategory57Screen();

    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_GPRS_EDIT);
    inputBuffer = GetCurrNInputBuffer(SCR_ID_DTCNT_GPRS_EDIT, &inputBufferSize);        /* added for inline edit history */

    SetParentHandler(MITEM_DATA_ACCOUNT_PARENT_ZERO);
    GPRSDataAccountFillInlineStruct();
    RegisterHighlightHandler(mmi_dtcnt_gprs_editor_highlight_hdlr);
    if (inputBuffer != NULL)
    {
        SetCategory57Data(wgui_inline_items, MAX_INLINE_ITEM_GPRSDATA_ACCOUNT_LIST, inputBuffer);
    }

    if (VerifyGPRSDataAcountChanges() && GetInlineDoneFlag(guiBuffer) == 0)
    {
        SetInlineDoneFlag(guiBuffer);
    }
    
    if (g_DataAccount_Display.readonly)
    {
        title_id = STR_GLOBAL_DETAILS;
    }
    
    ShowCategory57Screen(
        title_id,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_EDIT,
        IMG_ID_DTCNT_LSK_EDIT,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_INLINE_ITEM_GPRSDATA_ACCOUNT_LIST,
        g_DataAccount_Display.IconList,
        wgui_inline_items,
        DATA_ACCOUNT_HILITED_ITEM,
        guiBuffer);

    SetCategory57RightSoftkeyFunctions(EntryDTCNTGPRSSave, GoBackHistory);

}


/*****************************************************************************
 * FUNCTION
 *  ExitDTCNTGPRSEdit
 * DESCRIPTION
 *  exit handler for GPRS account edit screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitDTCNTGPRSEdit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;
    U16 inputBufferSize;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory57Screen();
    h.scrnID = SCR_ID_DTCNT_GPRS_EDIT;
    h.entryFuncPtr = EntryDTCNTGPRSEdit;
    GetCategoryHistory(h.guiBuffer);
    inputBufferSize = (U16) GetCategory57DataSize();
    GetCategory57Data((U8*) h.inputBuffer);
    AddNHistory(h, inputBufferSize);

}


/*****************************************************************************
 * FUNCTION
 *  GPRSDataAccountFillInlineStruct
 * DESCRIPTION
 *  fill inline structure for GPRS edit screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void GPRSDataAccountFillInlineStruct(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 BufferSize = 0;
    S16 len_str = 0;
    U16 one_ucs2 = L'*';
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!g_DataAccount_Display.readonly)
    {
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_NAME), KEY_LSK, KEY_EVENT_UP);
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_APN), KEY_LSK, KEY_EVENT_UP);
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_USER_NAME), KEY_LSK, KEY_EVENT_UP);
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_PASSWD), KEY_LSK, KEY_EVENT_UP);
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_AUTH_TYPE), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    }
    else
    {
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_NAME), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_APN), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_USER_NAME), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_PASSWD), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        SetInlineItemActivation((wgui_inline_items + GPRS_DATA_ACCOUNT_AUTH_TYPE), INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    }
    //DNS menu is currently disabled
    //      SetInlineItemActivation((wgui_inline_items+GPRS_DATA_ACCOUNT_DNS_ADDRESS),INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT,0);

    SetInlineItemCaption((wgui_inline_items + GPRS_DATA_ACCOUNT_NAME_STR), (U8*) GetString(STR_ID_DTCNT_RENAME));
    SetInlineItemCaption((wgui_inline_items + GPRS_DATA_ACCOUNT_APN_STR), (U8*) GetString(STR_ID_DTCNT_GPRS_APN));
    SetInlineItemCaption(
        (wgui_inline_items + GPRS_DATA_ACCOUNT_USER_NAME_STR),
        (U8*) GetString(STR_ID_DTCNT_USER_NAME));
    SetInlineItemCaption((wgui_inline_items + GPRS_DATA_ACCOUNT_PASSWD_STR), (U8*) GetString(STR_ID_DTCNT_PASSWD));
    SetInlineItemCaption(
        (wgui_inline_items + GPRS_DATA_ACCOUNT_AUTH_TYPE_STR),
        (U8*) GetString(STR_ID_DTCNT_GPRS_AUTH_TYP));
    /* SetInlineItemCaption((wgui_inline_items+GPRS_DATA_ACCOUNT_DNS_ADDRESS_STR),(U8*)GetString(STR_ID_DTCNT_DNS_ADDRESS)); */

    if (!g_DataAccount_Display.readonly)
    {
        SetInlineItemSelect(
            (wgui_inline_items + GPRS_DATA_ACCOUNT_AUTH_TYPE),
            (S32) GPRS_DATA_ACCOUNT_INLINE_AUTH_TYPE_OPTION,
            (U8 **) g_DataAccount_Display.AuthTypeOption,
            (S32*) & g_DataAccount_Display.AuthType);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + GPRS_DATA_ACCOUNT_AUTH_TYPE), 
                                g_DataAccount_Display.AuthTypeOption[g_DataAccount_Display.AuthType]);
    }

    if (!g_DataAccount_Display.readonly)
    {
        BufferSize = MAX_GPRS_DATAACCOUNT_NAME + 1;
        SetInlineItemFullScreenEdit(
            (wgui_inline_items + GPRS_DATA_ACCOUNT_NAME),
            STR_ID_DTCNT_RENAME,
            GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
            (U8*) (g_DataAccount_Display.DataAccountName),
            BufferSize,
            IMM_INPUT_TYPE_SENTENCE | INPUT_TYPE_USE_ENCODING_BASED_LENGTH);
        SetInlineFullScreenEditCustomFunction(wgui_inline_items + GPRS_DATA_ACCOUNT_NAME, DataAccountFullLineEditScreen);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + GPRS_DATA_ACCOUNT_NAME), 
                                g_DataAccount_Display.DataAccountName);
    }

    if (!g_DataAccount_Display.readonly)
    {
        BufferSize = MAX_GPRS_MMI_APN_LEN + 1;
        SetInlineItemFullScreenEdit(
            (wgui_inline_items + GPRS_DATA_ACCOUNT_APN),
            STR_ID_DTCNT_GPRS_APN,
            GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
            (U8*) (g_DataAccount_Display.APN),
            BufferSize,
            IMM_INPUT_TYPE_ENGLISH_SENTENCE);
        SetInlineFullScreenEditCustomFunction(wgui_inline_items + GPRS_DATA_ACCOUNT_APN, DataAccountFullLineEditScreen);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + GPRS_DATA_ACCOUNT_APN), 
                                g_DataAccount_Display.APN); 
    }

    if (!g_DataAccount_Display.readonly)
    {
        BufferSize = MAX_GPRS_USERNAME + 1;
        SetInlineItemFullScreenEdit(
            (wgui_inline_items + GPRS_DATA_ACCOUNT_USER_NAME),
            STR_ID_DTCNT_USER_NAME,
            GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
            (U8*) (g_DataAccount_Display.UserName),
            BufferSize,
            IMM_INPUT_TYPE_ENGLISH_SENTENCE);
        SetInlineFullScreenEditCustomFunction(
            wgui_inline_items + GPRS_DATA_ACCOUNT_USER_NAME,
            DataAccountFullLineEditScreen);
    }
    else
    {
        SetInlineItemDisplayOnly((wgui_inline_items + GPRS_DATA_ACCOUNT_USER_NAME), 
                                g_DataAccount_Display.UserName); 
    }
    
    if (!g_DataAccount_Display.readonly)
    {
        BufferSize = MAX_GPRS_USERPASSWD + 1;
        SetInlineItemFullScreenEdit(
            (wgui_inline_items + GPRS_DATA_ACCOUNT_PASSWD),
            STR_ID_DTCNT_PASSWD,
            GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
            (U8*) (g_DataAccount_Display.Passwd),
            BufferSize,
            IMM_INPUT_TYPE_ALPHANUMERIC_PASSWORD);
        SetInlineFullScreenEditCustomFunction(wgui_inline_items + GPRS_DATA_ACCOUNT_PASSWD, DataAccountFullLineEditScreen);
    }
    else
    {
        len_str = mmi_ucs2strlen((S8*)g_DataAccount_Display.Passwd);
        for(len_str = len_str - 1; len_str >= 0; len_str--)
        {
            g_DataAccount_Display.Passwd[len_str * ENCODING_LENGTH] = ((U8*)&one_ucs2)[0];
            g_DataAccount_Display.Passwd[len_str * ENCODING_LENGTH + 1] = ((U8*)&one_ucs2)[1];
        }
        SetInlineItemDisplayOnly((wgui_inline_items + GPRS_DATA_ACCOUNT_PASSWD), 
                                g_DataAccount_Display.Passwd); 
    }
    
    /* SetInlineItemIP4((wgui_inline_items+GPRS_DATA_ACCOUNT_DNS_ADDRESS),(U8*)g_DataAccount_Display.IP1,(U8*)g_DataAccount_Display.IP2,(U8*)g_DataAccount_Display.IP3,(U8*)g_DataAccount_Display.IP4,PreparedIPAddressString); */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_is_gprs_account_name_changed
 * DESCRIPTION
 *  Verify the Data Account fields.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL mmi_dtcnt_is_gprs_account_name_changed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = g_DataAccount_Display.GPRSCurrSelectItem;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_ucs2cmp((PS8) g_GPRS_DataAccount[i].DataAccountName, (PS8) g_DataAccount_Display.DataAccountName))
    {
        return MMI_TRUE;
    }
    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  VerifyGPRSDataAcountChanges
 * DESCRIPTION
 *  verify changes in GPRS editing screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U8 VerifyGPRSDataAcountChanges(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = g_DataAccount_Display.GPRSCurrSelectItem;
    S8 UserName_UCS2[(MAX_GPRS_USERNAME + 1) * ENCODING_LENGTH];
    S8 Passwd_UCS2[(MAX_GPRS_USERPASSWD + 1) * ENCODING_LENGTH];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_asc_to_ucs2((PS8) UserName_UCS2, (PS8) g_GPRS_DataAccount[i].UserName);
    mmi_asc_to_ucs2((PS8) Passwd_UCS2, (PS8) g_GPRS_DataAccount[i].Passwd);

    if (mmi_ucs2cmp((PS8) g_GPRS_DataAccount[i].DataAccountName, (PS8) g_DataAccount_Display.DataAccountName))
    {
        return TRUE;
    }

    if (mmi_ucs2cmp((PS8) g_GPRS_DataAccount[i].APN, (PS8) g_DataAccount_Display.APN))
    {
        return TRUE;
    }

    if (mmi_ucs2cmp((PS8) UserName_UCS2, (PS8) g_DataAccount_Display.UserName))
    {
        return TRUE;
    }

    if (mmi_ucs2cmp((PS8) Passwd_UCS2, (PS8) g_DataAccount_Display.Passwd))
    {
        return TRUE;
    }

    if (((S32) g_GPRS_DataAccount[i].AuthType) != g_DataAccount_Display.AuthType)
    {
        return TRUE;
    }

    return FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTGPRSSave
 * DESCRIPTION
 *  confirm window for saving GPRS account item
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDTCNTGPRSSave(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DisplayConfirm(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        get_string(STR_GLOBAL_SAVE_ASK),
        IMG_GLOBAL_QUESTION,
        WARNING_TONE);

    SetLeftSoftkeyFunction(GPRSDataAccountSaveChanges, KEY_EVENT_UP);

    SetRightSoftkeyFunction(GoToMainDataAccountScreen, KEY_EVENT_UP);

}


/*****************************************************************************
 * FUNCTION
 *  GPRSDataAccountSaveChanges
 * DESCRIPTION
 *  prepare GPRS data account content to be saved
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void GPRSDataAccountSaveChanges(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = g_DataAccount_Display.GPRSCurrSelectItem;
    S8 AccountNameStr[30 * ENCODING_LENGTH];    /* Assumption:  string "Data Account " length < 30 */

    //micha0901
    //DNS menu is currently disabled
#if (0)
/* under construction !*/
#endif /* (0) */ 

    /* micha1103 begin */
    U8 PrevIfdcs = 0;
    S32 WordCount = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    stopRequestedTone(WARNING_TONE);

    PrevIfdcs = g_GPRS_DataAccount[i].iFdcs;

    /*WordCount = GetInlineEditUCS2Count(&wgui_inline_items[1]);*/

    if(mmi_dtcnt_check_UCS2((U16*)g_DataAccount_Display.DataAccountName, (U16)mmi_ucs2strlen((PS8)g_DataAccount_Display.DataAccountName)))
    {
        WordCount = -1;
    }
    else
    {
        WordCount = 0;
    }

    if (mmi_dtcnt_is_gprs_account_name_changed())
    {
        memset(g_DataAccount_Display.provurl_hash_val, 0, MMI_DTCNT_PROVURL_HASH_LEN);
        memset(g_DataAccount_Display.napid_hash_val, 0, MMI_DTCNT_NAPID_HASH_LEN);
        g_DataAccount_Display.acct_type = DTCNT_USER_CONFIGURED_ACCT;
        /* g_DataAccount_Display.readonly = MMI_FALSE; */
    }
    
    memset(&g_GPRS_DataAccount[i], '\0', sizeof(GPRSDataAccountNode));

    if (WordCount < 0)
    {
        g_GPRS_DataAccount[i].iFdcs = mmi_ucs2strlen((PS8) g_DataAccount_Display.DataAccountName);
    }
    else
    {
        g_GPRS_DataAccount[i].iFdcs = (U8) WordCount;
    }

    /* micha1103 end */

    SetDynaDataAccountName(AccountNameStr, g_DataAccount_Display.GPRSCurrSelectItem);

    /* micha0307 */
    if (mmi_ucs2strlen((PS8) g_DataAccount_Display.DataAccountName) == 0)
    {
        mmi_ucs2cpy((PS8) g_GPRS_DataAccount[i].DataAccountName, (PS8) AccountNameStr);
        g_GPRS_DataAccount[i].iFdcs = mmi_ucs2strlen((PS8) g_GPRS_DataAccount[i].DataAccountName);
    }
    else
    {
        mmi_ucs2cpy((PS8) g_GPRS_DataAccount[i].DataAccountName, (PS8) g_DataAccount_Display.DataAccountName);
    }

    mmi_ucs2cpy((PS8) g_GPRS_DataAccount[i].APN, (PS8) g_DataAccount_Display.APN);
    mmi_ucs2_to_asc((PS8) g_GPRS_DataAccount[i].UserName, (PS8) g_DataAccount_Display.UserName);
    mmi_ucs2_to_asc((PS8) g_GPRS_DataAccount[i].Passwd, (PS8) g_DataAccount_Display.Passwd);

    /* DNS menu is currently disabled */
#if (0)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* (0) */ 

    g_GPRS_DataAccount[i].AuthType = (U8) g_DataAccount_Display.AuthType;
    g_GPRS_DataAccount[i].Present = 'P';

    /* 4 fields new added for gprs account(Display-->g_GPRS_DataAccount[i]) */
    memcpy(g_GPRS_DataAccount[i].provurl_hash_val, g_DataAccount_Display.provurl_hash_val, MMI_DTCNT_PROVURL_HASH_LEN);
    memcpy(g_GPRS_DataAccount[i].napid_hash_val, g_DataAccount_Display.napid_hash_val, MMI_DTCNT_NAPID_HASH_LEN);
    g_GPRS_DataAccount[i].acct_type = g_DataAccount_Display.acct_type;
    g_GPRS_DataAccount[i].readonly = g_DataAccount_Display.readonly;
    
    DTCNTGPRSSetAccountReq(i);

}


/*****************************************************************************
 * FUNCTION
 *  DTCNTGPRSSetAccountReq
 * DESCRIPTION
 *  set GPRS data account through L4
 * PARAMETERS
 *  ItemNum     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void DTCNTGPRSSetAccountReq(U8 ItemNum)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

#ifdef __MMI_GPRS_FEATURES__

    mmi_ps_set_gprs_data_account_req_struct *myMsgPtr;

    /* micha0820 */
    U8 ref_count;
    U16 msg_len;

    MYQUEUE Message;
    U8 DataAccountName_ASCII[(MAX_GPRS_DATAACCOUNT_NAME + 1) * ENCODING_LENGTH];
    U8 DataAccountAPN_ASCII[MAX_APN_LEN];
    U8 i = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (ItemNum >= MAX_DATA_ACCOUNT_GPRS_LIMIT)
    {
        return;
    }

    memset(DataAccountName_ASCII, '\0', (MAX_GPRS_DATAACCOUNT_NAME + 1) * ENCODING_LENGTH);
    memset(DataAccountAPN_ASCII, '\0', MAX_APN_LEN);

    myMsgPtr =
        (mmi_ps_set_gprs_data_account_req_struct*)
        OslConstructDataPtr(sizeof(mmi_ps_set_gprs_data_account_req_struct));

    /* micha0820 */
    ref_count = myMsgPtr->ref_count;
    msg_len = myMsgPtr->msg_len;
    memset(myMsgPtr, '\0', sizeof(mmi_ps_set_gprs_data_account_req_struct));
    myMsgPtr->ref_count = ref_count;
    myMsgPtr->msg_len = msg_len;

    myMsgPtr->gprs_account.context_id = ItemNum + 1;
    myMsgPtr->gprs_account.authentication_type = g_GPRS_DataAccount[ItemNum].AuthType;

    if (g_GPRS_DataAccount[ItemNum].iFdcs > 0)
    {
        g_GPRS_DataAccount[ItemNum].iFdcs = mmi_ucs2strlen((PS8) g_GPRS_DataAccount[ItemNum].DataAccountName) * ENCODING_LENGTH;
        myMsgPtr->gprs_account.name_length = g_GPRS_DataAccount[ItemNum].iFdcs;
        myMsgPtr->gprs_account.name_dcs = DATA_ACCOUNT_UCS; /* 0x8 */
        i = 0;
        while (i != g_GPRS_DataAccount[ItemNum].iFdcs)
        {
            myMsgPtr->gprs_account.name[i] = g_GPRS_DataAccount[ItemNum].DataAccountName[i + 1];
            myMsgPtr->gprs_account.name[i + 1] = g_GPRS_DataAccount[ItemNum].DataAccountName[i];
            i += 2;
        }
        myMsgPtr->gprs_account.name[i] = '\0';
        myMsgPtr->gprs_account.name[i + 1] = '\0';
    }
    else
    {
        myMsgPtr->gprs_account.name_dcs = DATA_ACCOUNT_ASCII;
        mmi_ucs2_to_asc((PS8) DataAccountName_ASCII, (PS8) g_GPRS_DataAccount[ItemNum].DataAccountName);
        myMsgPtr->gprs_account.name_length = strlen((PS8) DataAccountName_ASCII);
        memcpy(myMsgPtr->gprs_account.name, DataAccountName_ASCII, strlen((PS8) DataAccountName_ASCII));
        g_GPRS_DataAccount[ItemNum].iFdcs = 0;
    }

    mmi_ucs2_to_asc((PS8) DataAccountAPN_ASCII, (PS8) g_GPRS_DataAccount[ItemNum].APN);
    /* micha0202 */
    memcpy(myMsgPtr->gprs_account.apn, DataAccountAPN_ASCII, strlen((PS8) DataAccountAPN_ASCII) + 1);
    myMsgPtr->gprs_account.apn_length = strlen((PS8) DataAccountAPN_ASCII);

    memcpy(
        myMsgPtr->gprs_account.user_name,
        g_GPRS_DataAccount[ItemNum].UserName,
        strlen((PS8) g_GPRS_DataAccount[ItemNum].UserName) + 1);

    memcpy(
        myMsgPtr->gprs_account.password,
        g_GPRS_DataAccount[ItemNum].Passwd,
        strlen((PS8) g_GPRS_DataAccount[ItemNum].Passwd) + 1);

    for (i = 0; i < 4; i++)
    {
        myMsgPtr->gprs_account.dns[i] = 0;
    }

#ifdef __MMI_CCA_OMACP_BOOTSTRAP_UPDATE_SUPPORT__
    /* 4 fields new added for gprs account(g_GPRS_DataAccount[]-->L4C) */
    memcpy(myMsgPtr->gprs_account.provurl, g_GPRS_DataAccount[ItemNum].provurl_hash_val, MMI_DTCNT_PROVURL_HASH_LEN);
    memcpy(myMsgPtr->gprs_account.napid, g_GPRS_DataAccount[ItemNum].napid_hash_val, MMI_DTCNT_NAPID_HASH_LEN);
    myMsgPtr->gprs_account.account_type = g_GPRS_DataAccount[ItemNum].acct_type;
#endif /* __MMI_CCA_OMACP_BOOTSTRAP_UPDATE_SUPPORT__ */
    myMsgPtr->gprs_account.read_only = g_GPRS_DataAccount[ItemNum].readonly;

    myMsgPtr->profile_type = DATA_ACCT_GPRS_PROF;
    ClearInputEventHandler(MMI_DEVICE_ALL);
    Message.oslSrcId = MOD_MMI;
    Message.oslDestId = MOD_L4C;
    Message.oslMsgId = PRT_MMI_PS_SET_GPRS_DATA_ACCOUNT_REQ;
    Message.oslDataPtr = (oslParaType*) myMsgPtr;
    Message.oslPeerBuffPtr = NULL;
    SetProtocolEventHandler(DTCNTGPRSSetAccountRsp, PRT_MMI_PS_SET_GPRS_DATA_ACCOUNT_RSP);
    OslMsgSendExtQueue(&Message);
    ClearInputEventHandler(MMI_DEVICE_ALL);

#endif /* __MMI_GPRS_FEATURES__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  DTCNTGPRSSetAccountRsp
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void DTCNTGPRSSetAccountRsp(void *info)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

#ifdef __MMI_GPRS_FEATURES__

    mmi_ps_set_gprs_data_account_rsp_struct *localPtr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    localPtr = (mmi_ps_set_gprs_data_account_rsp_struct*) info;

    if (localPtr->result == KAL_TRUE /* OK */ )
    {
        g_GPRS_DataAccount[g_DataAccount_Display.GPRSCurrSelectItem].Present = 'P';
        ShowDataAccountOKMessage();
    }
    else
    {
        DisplayPopup(
            (PU8) GetString(STR_GLOBAL_NOT_DONE),
            IMG_GLOBAL_UNFINISHED,
            1,
            DATA_ACCOUNT_NOTIFY_TIMEOUT,
            ERROR_TONE);
        /* micha0427 */
        DeleteScreenIfPresent(SCR_ID_DTCNT_GPRS_EDIT);
    }

#endif /* __MMI_GPRS_FEATURES__ */ 
}

#endif /* __MMI_GPRS_FEATURES__ */ 


#define QO3C_INTERFACE
/*****************************************************************************
 * FUNCTION
 *  mmi_ps_dtcnt_list_ind_handler
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_ps_dtcnt_list_ind_handler(void *info)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_ps_dtcnt_list_ind_struct *localPtr;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    localPtr = (mmi_ps_dtcnt_list_ind_struct*) info;

    MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_PS_LIST_IND, localPtr->app_id, localPtr->bearer_scope,localPtr->num_id);

    if (localPtr->app_id == DTCNT_LIST_BY_APP_OK)
    {
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_CONFIRM);
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_BY_APP);
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST);
#ifdef __MMI_GPRS_FEATURES__
        DeleteScreenIfPresent(SCR_ID_DTCNT_GPRS_LIST);
#endif /* __MMI_GPRS_FEATURES__ */
        GoBackHistory();
        return;
    }

    memset(&g_dtcnt_list_cnt, 0, sizeof(dtcnt_list_by_app_struct));

    /* MOD_MMI & MOD_WAP allowed */
    MMI_EXT_ASSERT(localPtr->src_mod == MOD_MMI || localPtr->src_mod == MOD_WAP, localPtr->src_mod, 0, 0);
    g_dtcnt_list_cnt.src_mod = MOD_WAP;
    if (localPtr->src_mod == MOD_MMI)
    {
        g_dtcnt_list_cnt.src_mod = MOD_MMI;
    }
    else if (localPtr->src_mod == MOD_WAP)
    {
        g_dtcnt_list_cnt.src_mod = MOD_WAP;
    }
    
    g_dtcnt_list_cnt.appid = localPtr->app_id;
    g_dtcnt_list_cnt.bearer_scrope = localPtr->bearer_scope;
    g_dtcnt_list_cnt.menu_id = localPtr->menu_id;
    g_dtcnt_list_cnt.num_id = localPtr->num_id;
    g_dtcnt_list_cnt.bearer_type[0] = localPtr->bearer_type[0];
    g_dtcnt_list_cnt.bearer_type[1] = localPtr->bearer_type[1];

    if(g_dtcnt_list_cnt.bearer_type[0] == DATA_ACCOUNT_BEARER_CSD)
    {
        g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_CSD] = localPtr->net_id[0];
        g_dtcnt_list_cnt.sim_info = cbm_get_sim_info_data_account(localPtr->net_id[0]);
        g_dtcnt_list_cnt.app_id = cbm_get_app_id_data_account(localPtr->net_id[0]);
    }
    else if(g_dtcnt_list_cnt.bearer_type[1] == DATA_ACCOUNT_BEARER_CSD)
    {
        g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_CSD] = localPtr->net_id[1];
        g_dtcnt_list_cnt.sim_info = cbm_get_sim_info_data_account(localPtr->net_id[1]);
        g_dtcnt_list_cnt.app_id = cbm_get_app_id_data_account(localPtr->net_id[1]);
    }

    if(g_dtcnt_list_cnt.bearer_type[0] == DATA_ACCOUNT_BEARER_GPRS)
    {
        g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_GPRS] = localPtr->net_id[0];
        g_dtcnt_list_cnt.sim_info = cbm_get_sim_info_data_account(localPtr->net_id[0]);
        g_dtcnt_list_cnt.app_id = cbm_get_app_id_data_account(localPtr->net_id[0]);
    }
    else if(g_dtcnt_list_cnt.bearer_type[1] == DATA_ACCOUNT_BEARER_GPRS)
    {
        g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_GPRS] = localPtr->net_id[1];
        g_dtcnt_list_cnt.sim_info = cbm_get_sim_info_data_account(localPtr->net_id[1]);
        g_dtcnt_list_cnt.app_id = cbm_get_app_id_data_account(localPtr->net_id[1]);
    }

    /*check para first*/
    mmi_dtcnt_list_check_app_para();
    mmi_ps_dtcnt_main_list();
}

/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_check_app_para
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static U8 mmi_dtcnt_list_check_app_para(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if(g_dtcnt_list_cnt.num_id == 2)
    {
        g_dtcnt_list_cnt.highlight_gprs_csd = TRUE;
    }
    else
    {
        if(g_dtcnt_list_cnt.bearer_type[0] == DATA_ACCOUNT_BEARER_CSD)
        {
            g_dtcnt_list_cnt.highlight_csd = TRUE;
        }
        else if(g_dtcnt_list_cnt.bearer_type[0] == DATA_ACCOUNT_BEARER_GPRS)
        {
            g_dtcnt_list_cnt.highlight_gprs = TRUE;
        }
    }

    return TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_ps_dtcnt_list_ind_handler
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/

static void mmi_ps_dtcnt_main_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 highlight_index = 0;
    U8 list_num = 0;
    U8 *guiBuffer = NULL;
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    g_dtcnt_list_cnt.entry_gprs_list_num = 0;
    g_dtcnt_list_cnt.switch_bearer_flag = FALSE;

    EntryNewScreen(SCR_ID_DTCNT_LIST_BY_APP, NULL, mmi_ps_dtcnt_main_list, NULL);
    
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_LIST_BY_APP);
#ifdef __MMI_CBM_ALWAYS_ASK__
    if(g_dtcnt_list_cnt.bearer_scrope & DATA_ACCOUNT_BEARER_ALWAYS_ASK)
    {
        nStrItemList[list_num] = STR_ID_DTCNT_ALWAYS_ASK;
        g_dtcnt_list_cnt.bearer_list[list_num] = DTCNT_LIST_BEARER_ALWAYS_ASK;
        if(g_dtcnt_list_cnt.num_id == 1 && g_dtcnt_list_cnt.bearer_type[0] & DATA_ACCOUNT_BEARER_ALWAYS_ASK)
        {
            highlight_index = list_num;
        }
        list_num++;
    }
#endif /* __MMI_CBM_ALWAYS_ASK__ */

#ifdef __MMI_WLAN_FEATURES__
    if (( g_dtcnt_list_cnt.bearer_scrope & DATA_ACCOUNT_BEARER_CSD )
        && (mmi_netset_get_active_preferred_mode() != P_WLAN_ONLY))
#else /* __MMI_WLAN_FEATURES__ */
    if ( g_dtcnt_list_cnt.bearer_scrope & DATA_ACCOUNT_BEARER_CSD )
#endif /* __MMI_WLAN_FEATURES__ */
    {
        nStrItemList[list_num] = SERVICES_DATA_CONNECT_GSM_STRING_ID;
        g_dtcnt_list_cnt.bearer_list[list_num] = DTCNT_LIST_BEARER_CSD;
        if(g_dtcnt_list_cnt.num_id == 1 && g_dtcnt_list_cnt.bearer_type[0] & DATA_ACCOUNT_BEARER_CSD)
        {
            highlight_index = list_num;
        }
        list_num++;
    }
#ifdef __MMI_GPRS_FEATURES__
#ifdef __MMI_WLAN_FEATURES__
    if(( g_dtcnt_list_cnt.bearer_scrope & DATA_ACCOUNT_BEARER_GPRS )
        && (mmi_netset_get_active_preferred_mode() != P_WLAN_ONLY))
#else /* __MMI_WLAN_FEATURES__ */
    if( g_dtcnt_list_cnt.bearer_scrope & DATA_ACCOUNT_BEARER_GPRS )
#endif /* __MMI_WLAN_FEATURES__ */
    {
        nStrItemList[list_num] = SERVICES_DATA_CONNECT_GPRS_STRING_ID;
        g_dtcnt_list_cnt.bearer_list[list_num] = DTCNT_LIST_BEARER_GPRS;
        if(g_dtcnt_list_cnt.num_id == 1 && g_dtcnt_list_cnt.bearer_type[0] & DATA_ACCOUNT_BEARER_GPRS)
        {
            highlight_index = list_num;
        }
        list_num++;
    }
#ifdef __MMI_WLAN_FEATURES__
    if(( g_dtcnt_list_cnt.bearer_scrope & DATA_ACCOUNT_BEARER_GPRS_CSD )
        && (mmi_netset_get_active_preferred_mode() != P_WLAN_ONLY))
#else /* __MMI_WLAN_FEATURES__ */
    if( g_dtcnt_list_cnt.bearer_scrope & DATA_ACCOUNT_BEARER_GPRS_CSD ) 
#endif /* __MMI_WLAN_FEATURES__ */
    {
        nStrItemList[list_num] = STR_ID_DTCNT_BEARER_GPRS_CSD;
        g_dtcnt_list_cnt.bearer_list[list_num] = DTCNT_LIST_BEARER_GPRS_CSD;
        if(g_dtcnt_list_cnt.num_id == 2)
        {
            highlight_index = list_num;
        }
        list_num++;
    }
#endif /* __MMI_GPRS_FEATURES__ */

#ifdef __MMI_WLAN_FEATURES__
    if(( g_dtcnt_list_cnt.bearer_scrope & DATA_ACCOUNT_BEARER_WIFI ) &&
        (mmi_netset_get_active_preferred_mode() != P_GSM_ONLY))
    {
        nStrItemList[list_num] = SERVICES_DATA_CONNECT_WLAN_STRING_ID;
        g_dtcnt_list_cnt.bearer_list[list_num] = DTCNT_LIST_BEARER_WIFI;
        if(g_dtcnt_list_cnt.num_id == 1 && g_dtcnt_list_cnt.bearer_type[0] & DATA_ACCOUNT_BEARER_WIFI)
        {
            highlight_index = list_num;
        }
        list_num++;
    }
#endif /*__MMI_WLAN_FEATURES__*/

    RegisterHighlightHandler(mmi_dtcnt_list_highlight_hdlr);
    
    ShowCategory52Screen(
        STR_GLOBAL_DATA_ACCOUNT,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        list_num,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        NULL,
        0,
        highlight_index,
        guiBuffer);
    
    SetLeftSoftkeyFunction(mmi_dtcnt_list_show, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_list_show, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_highlight_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_dtcnt_list_cnt.index = (U8)nIndex;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_highlight_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_show(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 bearer;
#ifdef __MMI_CBM_ALWAYS_ASK__
    U32 acct_id = 0;
#endif /* __MMI_CBM_ALWAYS_ASK__ */
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    
    bearer = g_dtcnt_list_cnt.bearer_list[g_dtcnt_list_cnt.index];

    MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_PS_LIST_SHOW_BEARER, bearer);

    switch(bearer)
    {
#ifdef __MMI_CBM_ALWAYS_ASK__
    case DTCNT_LIST_BEARER_ALWAYS_ASK:
        g_dtcnt_list_cnt.num_id = 1;
        g_dtcnt_list_cnt.always_ask_flag = TRUE;
        /**/
        acct_id = 0;
        acct_id = cbm_encode_data_account_id(acct_id, g_dtcnt_list_cnt.sim_info, g_dtcnt_list_cnt.app_id, TRUE);
        mmi_dtcnt_list_callback_always_ask(acct_id);
        break;
#endif /* __MMI_CBM_ALWAYS_ASK__ */
    case DTCNT_LIST_BEARER_CSD:
    #ifdef __MMI_DUAL_SIM_MASTER__
        if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
    #else /*__MMI_DUAL_SIM_MASTER__*/
        if (!mmi_dtcnt_is_sim_valid())
    #endif /*__MMI_DUAL_SIM_MASTER__*/
        {
            /* Not allow to verify phone lock if SIM card is blocked */
            DisplayPopup(
                (U8*) GetString(STR_GLOBAL_EMPTY),
                IMG_GLOBAL_UNFINISHED,
                1,
                DATA_ACCOUNT_NOTIFY_TIMEOUT,
                (U8) ERROR_TONE);
            return;
        }
        g_dtcnt_list_cnt.num_id = 1;
        g_dtcnt_list_cnt.csd_bearer_flag = TRUE;
        if(g_dtcnt_list_cnt.highlight_csd)
        {
            mmi_dtcnt_select_highlight_handler(g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_CSD], DATA_ACCOUNT_BEARER_CSD);
            mmi_dtcnt_select_single_account_option(mmi_dtcnt_list_callback_csd, 
                                            g_dtcnt_list_cnt.menu_id, 
                                            DATA_ACCOUNT_BEARER_CSD, 
                                            DTCNT_SELECT_NO_SIM, 
                                            DTCNT_SELECT_NO_ALWAYS_ASK);
        }
        else
        {
            mmi_dtcnt_select_highlight_handler(0, DATA_ACCOUNT_BEARER_CSD);
            mmi_dtcnt_select_single_account_option(mmi_dtcnt_list_callback_csd, 
                                            g_dtcnt_list_cnt.menu_id, 
                                            DATA_ACCOUNT_BEARER_CSD, 
                                            DTCNT_SELECT_NO_SIM, 
                                            DTCNT_SELECT_NO_ALWAYS_ASK);
        }
    	break;
#ifdef __MMI_GPRS_FEATURES__
    case DTCNT_LIST_BEARER_GPRS:
    #ifdef __MMI_DUAL_SIM_MASTER__
        if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
    #else /*__MMI_DUAL_SIM_MASTER__*/
        if (!mmi_dtcnt_is_sim_valid())
    #endif /*__MMI_DUAL_SIM_MASTER__*/
        {
            /* Not allow to verify phone lock if SIM card is blocked */
            DisplayPopup(
                (U8*) GetString(STR_GLOBAL_EMPTY),
                IMG_GLOBAL_UNFINISHED,
                1,
                DATA_ACCOUNT_NOTIFY_TIMEOUT,
                (U8) ERROR_TONE);
            return;
        }
        g_dtcnt_list_cnt.num_id = 1;
        g_dtcnt_list_cnt.gprs_bearer_flag = TRUE;
        if(g_dtcnt_list_cnt.highlight_gprs)
        {
            mmi_dtcnt_select_highlight_handler(g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_GPRS], DATA_ACCOUNT_BEARER_GPRS);
            mmi_dtcnt_select_single_account_option(mmi_dtcnt_list_callback_gprs, 
                                            g_dtcnt_list_cnt.menu_id, 
                                            DATA_ACCOUNT_BEARER_GPRS,
                                            DTCNT_SELECT_NO_SIM, 
                                            DTCNT_SELECT_NO_ALWAYS_ASK);
        }
        else
        {
            mmi_dtcnt_select_highlight_handler(10, DATA_ACCOUNT_BEARER_GPRS);
            mmi_dtcnt_select_single_account_option(mmi_dtcnt_list_callback_gprs, 
                                            g_dtcnt_list_cnt.menu_id, 
                                            DATA_ACCOUNT_BEARER_GPRS,
                                            DTCNT_SELECT_NO_SIM, 
                                            DTCNT_SELECT_NO_ALWAYS_ASK);
        }
    	break;

    case DTCNT_LIST_BEARER_GPRS_CSD:
    #ifdef __MMI_DUAL_SIM_MASTER__
        if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
    #else /* __MMI_DUAL_SIM_MASTER__ */
        if (!mmi_dtcnt_is_sim_valid())
    #endif /*__MMI_DUAL_SIM_MASTER__*/
        {
            /* Not allow to verify phone lock if SIM card is blocked */
            DisplayPopup(
                (U8*) GetString(STR_GLOBAL_EMPTY),
                IMG_GLOBAL_UNFINISHED,
                1,
                DATA_ACCOUNT_NOTIFY_TIMEOUT,
                (U8) ERROR_TONE);
            return;
        }
        g_dtcnt_list_cnt.num_id = 2;
        g_dtcnt_list_cnt.switch_bearer_flag = TRUE;
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_CONFIRM);
        mmi_dtcnt_list_by_app_confirm(STR_ID_DTCNT_SELECT_GPRS, mmi_dtcnt_list_by_app_confirm_gprs);
        break;
#endif /* __MMI_GPRS_FEATURES__ */

#ifdef __MMI_WLAN_FEATURES__
    case DTCNT_LIST_BEARER_WIFI:
        g_dtcnt_list_cnt.num_id = 1;
        g_dtcnt_list_cnt.wifi_bearer_flag = TRUE;
        mmi_dtcnt_list_callback_wifi(DTCNT_WIFI_ID);
        break;
#endif /* __MMI_WLAN_FEATURES__ */
    default:
        ASSERT(0);
        break;
    }

}

#ifdef __MMI_CBM_ALWAYS_ASK__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_callback_wifi
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_callback_always_ask(U32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    PRINT_INFORMATION("list_callback_always_ask, net_id=%d", index);

    //MMI_TRACE(TRACE_GROUP_6, MMI_DTCNT_GPRS_SET_REQ);
    g_dtcnt_list_cnt.net_id[0] = index;
    mmi_dtcnt_send_msg2ps();
}
#endif /*__MMI_CBM_ALWAYS_ASK__*/



#ifdef __MMI_GPRS_FEATURES__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_by_app_confirm
 * DESCRIPTION
 *  Common function to display confirmation screem
 * PARAMETERS
 *  msg             [IN]        String index of message to be displayed in confirmation screen
 *  lskFuncPtr      [IN]        LSK handler of the confirmation screen
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_by_app_confirm(U16 msg, FuncPtr lskFuncPtr)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_dtcnt_list_cnt.curr_msg = msg;
    g_dtcnt_list_cnt.curr_lskFuncPtr = lskFuncPtr;

    mmi_dtcnt_list_confirm();
    //DisplayPopup((PU8) GetString(STR_GLOBAL_BUSY_TRY_LATER), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, SUCCESS_TONE);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_by_app_confirm
 * DESCRIPTION
 *  Common function to display confirmation screem
 * PARAMETERS
 *  msg             [IN]        String index of message to be displayed in confirmation screen
 *  lskFuncPtr      [IN]        LSK handler of the confirmation screen
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_confirm(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 is_forward = MMI_TRUE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    if (CheckIsBackHistory())
    {
        is_forward = MMI_FALSE;
    }
    EntryNewScreen(SCR_ID_DTCNT_LIST_CONFIRM, NULL, mmi_dtcnt_list_confirm, NULL);
    
    ShowCategory164Screen(
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        0,
        0,
        g_dtcnt_list_cnt.curr_msg,
        IMG_GLOBAL_WARNING,
        NULL);
    
    SetLeftSoftkeyFunction(g_dtcnt_list_cnt.curr_lskFuncPtr, KEY_EVENT_UP);
    if (is_forward)
    {
        playRequestedTone(WARNING_TONE);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_by_app_confirm_csd
 * DESCRIPTION
 *  
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_by_app_confirm_csd(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(g_dtcnt_list_cnt.highlight_gprs_csd)
    {
        mmi_dtcnt_select_highlight_handler(g_dtcnt_list_cnt.net_id[0], DATA_ACCOUNT_BEARER_CSD);
        mmi_dtcnt_select_single_account_option(mmi_dtcnt_list_callback_csd, 
                                        g_dtcnt_list_cnt.menu_id, 
                                        DATA_ACCOUNT_BEARER_CSD, 
                                        DTCNT_SELECT_NO_SIM, 
                                        DTCNT_SELECT_NO_ALWAYS_ASK);
    }
    else
    {
        mmi_dtcnt_select_highlight_handler(0, DATA_ACCOUNT_BEARER_CSD);
        mmi_dtcnt_select_single_account_option(mmi_dtcnt_list_callback_csd, g_dtcnt_list_cnt.menu_id, DATA_ACCOUNT_BEARER_CSD, DTCNT_SELECT_NO_SIM, DTCNT_SELECT_NO_ALWAYS_ASK);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_by_app_confirm_gprs
 * DESCRIPTION
 *  
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_by_app_confirm_gprs(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_dtcnt_list_cnt.switch_bearer_flag = TRUE;
    if(g_dtcnt_list_cnt.highlight_gprs_csd)
    {
        mmi_dtcnt_select_highlight_handler(g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_GPRS], DATA_ACCOUNT_BEARER_GPRS);
        mmi_dtcnt_select_single_account_option(mmi_dtcnt_list_callback_gprs, 
                                        g_dtcnt_list_cnt.menu_id, 
                                        DATA_ACCOUNT_BEARER_GPRS,
                                        DTCNT_SELECT_NO_SIM, 
                                        DTCNT_SELECT_NO_ALWAYS_ASK);
    }
    else
    {
        mmi_dtcnt_select_highlight_handler(10, DATA_ACCOUNT_BEARER_GPRS);
        mmi_dtcnt_select_single_account_option(mmi_dtcnt_list_callback_gprs, 
                                        g_dtcnt_list_cnt.menu_id, 
                                        DATA_ACCOUNT_BEARER_GPRS,
                                        DTCNT_SELECT_NO_SIM, 
                                        DTCNT_SELECT_NO_ALWAYS_ASK);
    }
}
#endif /* __MMI_GPRS_FEATURES__ */


#ifdef __MMI_WLAN_FEATURES__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_callback_wifi
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_callback_wifi(U32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_dtcnt_list_cnt.net_id[0] = index;
    mmi_dtcnt_send_msg2ps();
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_callback_csd
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_callback_csd(U32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION);

    g_dtcnt_list_cnt.switch_bearer_flag = FALSE;
    g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_CSD] = index;
    mmi_dtcnt_send_msg2ps();
}


#ifdef __MMI_GPRS_FEATURES__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_list_callback
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_list_callback_gprs(U32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_GPRS] = index;

    DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION);

    if(!g_dtcnt_list_cnt.switch_bearer_flag)
    {
        mmi_dtcnt_send_msg2ps();
    }
}
#endif /* __MMI_GPRS_FEATURES__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_send_msg2ps
 * DESCRIPTION
 *  message handler for mmi_ps_set_gprs_data_account_rsp_struct
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_send_msg2ps(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_ps_dtcnt_list_rsp_struct *myMsgPtr;
    MYQUEUE Message;
    U8 ref_count;
    U16 msg_len;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    myMsgPtr =
        (mmi_ps_dtcnt_list_rsp_struct*)
        OslConstructDataPtr(sizeof(mmi_ps_dtcnt_list_rsp_struct));
    
    ref_count = myMsgPtr->ref_count;
    msg_len = myMsgPtr->msg_len;
    memset(myMsgPtr, '\0', sizeof(mmi_ps_dtcnt_list_rsp_struct));
    myMsgPtr->ref_count = ref_count;
    myMsgPtr->msg_len = msg_len;

    myMsgPtr->app_id = g_dtcnt_list_cnt.appid;
    if(g_dtcnt_list_cnt.num_id == 1)
    {
        if(g_dtcnt_list_cnt.csd_bearer_flag)
        {
            g_dtcnt_list_cnt.bearer_type[0] = DATA_ACCOUNT_BEARER_CSD;
            myMsgPtr->net_id[0] = cbm_encode_data_account_id(g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_CSD], g_dtcnt_list_cnt.sim_info, g_dtcnt_list_cnt.app_id, FALSE);
        }
        else if(g_dtcnt_list_cnt.gprs_bearer_flag)
        {
            g_dtcnt_list_cnt.bearer_type[0] = DATA_ACCOUNT_BEARER_GPRS;
            myMsgPtr->net_id[0] = cbm_encode_data_account_id(g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_GPRS], g_dtcnt_list_cnt.sim_info, g_dtcnt_list_cnt.app_id, FALSE);
        }
        else if(g_dtcnt_list_cnt.wifi_bearer_flag)
        {
            g_dtcnt_list_cnt.bearer_type[0] = DATA_ACCOUNT_BEARER_WIFI;
            myMsgPtr->net_id[0] = g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_CSD];
        }
        else if(g_dtcnt_list_cnt.always_ask_flag)
        {
            g_dtcnt_list_cnt.bearer_type[0] = DATA_ACCOUNT_BEARER_ALWAYS_ASK;
            myMsgPtr->net_id[0] = cbm_encode_data_account_id(g_dtcnt_list_cnt.net_id[0], g_dtcnt_list_cnt.sim_info, g_dtcnt_list_cnt.app_id, TRUE);
        }
        myMsgPtr->bearer_type[DTCNT_LIST_BEARER_CSD] = g_dtcnt_list_cnt.bearer_type[0];
        myMsgPtr->bearer_scope = g_dtcnt_list_cnt.bearer_type[0]; 
    }
    else if(g_dtcnt_list_cnt.num_id == 2)
    {
        myMsgPtr->bearer_type[DTCNT_LIST_BEARER_CSD] = DATA_ACCOUNT_BEARER_CSD;
        myMsgPtr->bearer_type[DTCNT_LIST_BEARER_GPRS] = DATA_ACCOUNT_BEARER_GPRS;
    
        myMsgPtr->net_id[DTCNT_LIST_BEARER_CSD] = cbm_encode_data_account_id(g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_CSD], g_dtcnt_list_cnt.sim_info, g_dtcnt_list_cnt.app_id, FALSE);
        myMsgPtr->net_id[DTCNT_LIST_BEARER_GPRS] = cbm_encode_data_account_id(g_dtcnt_list_cnt.net_id[DTCNT_LIST_BEARER_GPRS], g_dtcnt_list_cnt.sim_info, g_dtcnt_list_cnt.app_id, FALSE);
        myMsgPtr->bearer_scope = DATA_ACCOUNT_BEARER_GPRS_CSD;
    }
    
    myMsgPtr->num_id = g_dtcnt_list_cnt.num_id;
    myMsgPtr->result = TRUE;
    
    Message.oslSrcId = MOD_MMI;
    Message.oslDestId = g_dtcnt_list_cnt.src_mod;
    Message.oslMsgId = MSG_ID_MMI_PS_DTCNT_LIST_RSP;
    Message.oslDataPtr = (oslParaType*) myMsgPtr;
    Message.oslPeerBuffPtr = NULL;
    OslMsgSendExtQueue(&Message);
    ClearInputEventHandler(MMI_DEVICE_ALL);
}


#define DUAL_SIM_ALWAYS_ASK
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_always_ask_select_sim1
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_always_ask_select_sim1(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_always_ask_sim_info = CBM_SIM_ID_SIM1;
    mmi_dtcnt_always_ask_entry_account_select_ext();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_always_ask_select_sim2
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_always_ask_select_sim2(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_always_ask_sim_info = CBM_SIM_ID_SIM2;
    mmi_dtcnt_always_ask_entry_account_select_ext();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_account_select_ext
 * DESCRIPTION
 *  Data account main screen ( including GSM/GPPRS)
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_always_ask_entry_account_select_ext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i;
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U16 nNumofItem = 0;                 /* Stores no of children in the submenu */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   
    for (i = 0; g_dtcnt_always_ask_selections_dual[i].bearer > 0; i++)
    {
        if (g_mmi_dtcnt_always_ask.bearers & g_dtcnt_always_ask_selections_dual[i].bearer)
        {
            nStrItemList[nNumofItem] = g_dtcnt_always_ask_selections_dual[i].name;
            g_mmi_dtcnt_always_ask.bearer_callbacks[nNumofItem] = g_dtcnt_always_ask_selections_dual[i].func;
            nNumofItem++;
            
        }
    }

    if(nNumofItem == 1)
    {
        g_mmi_dtcnt_always_ask.bearer_callbacks[0]();
        return;
    }
    
    EntryNewScreen(SCR_ID_DTCNT_LIST_AA_DUAL_SIM, NULL, mmi_dtcnt_always_ask_entry_account_select_ext, NULL);
    
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_LIST_AA_DUAL_SIM);

    RegisterHighlightHandler(mmi_dtcnt_always_ask_account_select_highlight_hdlr);

    ShowCategory52Screen(
        SERVICES_DATA_CONNECT_MAIN_STRING_ID,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        0,
        0,
        0,
        guiBuffer);
    SetLeftSoftkeyFunction(mmi_dtcnt_always_ask_select_ok, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_always_ask_select_ok, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}


#define DUAL_SIM_SELECT_ACCOUNT
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_sim1
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_select_sim1(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_sim_info = CBM_SIM_ID_SIM1;
    mmi_dtcnt_entry_account_select_ext();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_sim2
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_select_sim2(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_sim_info = CBM_SIM_ID_SIM2;
    mmi_dtcnt_entry_account_select_ext();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_account_select_ext
 * DESCRIPTION
 *  Data account bearer selection for dual sim ( only GSM/GPPRS included)
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_entry_account_select_ext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i;
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U16 nNumofItem = 0;                 /* Stores no of children in the submenu */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (i = 0; g_dtcnt_selections_dual[i].bearer > 0; i++)
    {
        if (g_mmi_dtcnt_account_selection.bearers & g_dtcnt_selections_dual[i].bearer)
        {
            nStrItemList[nNumofItem] = g_dtcnt_selections_dual[i].name;
            g_mmi_dtcnt_account_selection.bearer_callbacks[nNumofItem] = g_dtcnt_selections_dual[i].func;
            nNumofItem++;
            
        }
    }

    if(nNumofItem == 1)
    {
        g_mmi_dtcnt_account_selection.bearer_callbacks[0]();
        return;
    }
    
    EntryNewScreen(SCR_ID_DTCNT_LIST_DUAL_SIM, NULL, mmi_dtcnt_entry_account_select_ext, NULL);
    
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_LIST_DUAL_SIM);

    RegisterHighlightHandler(mmi_dtcnt_account_sim_select_highlight_hdlr);

    ShowCategory52Screen(
        SERVICES_DATA_CONNECT_MAIN_STRING_ID,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        0,
        0,
        0, /* g_mmi_dtcnt_account_selection.CurrAppBearerSelectItem, */
        guiBuffer);
    SetLeftSoftkeyFunction(mmi_dtcnt_account_bearer_select_ok, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_account_bearer_select_ok, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}


#define ALWAYS_ASK_OPTION
/*****************************************************************************
 * FUNCTION
 *  mmi_always_ask_delete_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_always_ask_delete_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    DeleteScreenIfPresent(SCR_ID_DTCNT_AA_LIST);
#ifdef __MMI_GPRS_FEATURES__
    DeleteScreenIfPresent(SCR_ID_DTCNT_AA_GPRS_LIST);
#endif /* __MMI_GPRS_FEATURES__ */
    DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_AA_DUAL_SIM);
    DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
    if(GetActiveScreenId() == SCR_ID_DTCNT_LIST_ALWAYS_ASK ||
       GetActiveScreenId() == SCR_ID_DTCNT_AA_LIST ||
#ifdef __MMI_GPRS_FEATURES__
       GetActiveScreenId() == SCR_ID_DTCNT_AA_GPRS_LIST ||
#endif /* __MMI_GPRS_FEATURES__ */
       GetActiveScreenId() == SCR_ID_DTCNT_LIST_AA_DUAL_SIM)
    {
        GoBackHistory();
    }
}


#ifdef __MMI_CBM_ALWAYS_ASK__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_always_ask
 * DESCRIPTION
 *  Always-Ask option on data account selection menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_always_ask(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 acct_id = 0;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    acct_id = cbm_encode_data_account_id(MMI_DTCNT_DEFAULT_ID, CBM_SIM_ID_SIM1, 0, TRUE);

    /* return the encode acct id */
    if(g_mmi_dtcnt_account_selection.app_callback)
    {
        g_mmi_dtcnt_account_selection.app_callback((U32) acct_id);
        g_mmi_dtcnt_account_selection.app_callback = NULL;
    }
    
}
#endif /* __MMI_CBM_ALWAYS_ASK__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_wlan_connect_result
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_wlan_connect_result(U8 wifi_connect_result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    kal_uint32 id;
    FuncPtrU32Ext temp_callback_ext_ptr = NULL;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION("$$$$$ CBM always ask wifi cnf result = %d $$$$$", wifi_connect_result);

    abm_bearer2nw_id(ABM_E_SOCKET_BEARER_WIFI, 0, &id);
    if(g_mmi_dtcnt_always_ask.app_callback_ext)
    {
        g_always_ask_screen_del_handler_flag = TRUE;
        temp_callback_ext_ptr = g_mmi_dtcnt_always_ask.app_callback_ext;
        g_mmi_dtcnt_always_ask.app_callback_ext = NULL;
    }
    if (temp_callback_ext_ptr)
    {
        temp_callback_ext_ptr(id, wifi_connect_result, 0);
    }
}


#define SELECT_ACCOUNT_OPTION_INTERFACE
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_account_option
 * DESCRIPTION
 *  Get a compounded data-account id with a fallback-bearer
 * PARAMETERS
 *  callback    [IN]    callback function with an U32 
 *                               data-account id returned. 
 *                               prototype: void (*FuncPtrU32)(U32);
 *  AppMenuID   [IN]    Menu ID of APP entrance menu
 *  bearers     [IN]    Which bearers APP want to show
 *  option      [IN]    Four options among dtcnt_select_type_enum,
 *                      these options could be connected by "||".
 *                                     DTCNT_SELECT_SIM
 *                                     DTCNT_SELECT_ALWAYS_ASK
 *                                     DTCNT_SELECT_BEARER_SWITCH
 *                                     DTCNT_SELECT_ALLOW_SAME_BEARER_SWITCH
 *  app_id      [IN]    Here for no use on current design, can be set to 0.
 * RETURNS
 *  
 *****************************************************************************/
void mmi_dtcnt_select_account_option(FuncPtrU32 callback, 
                                     U16 AppMenuID, 
                                     U8 bearers, 
                                     dtcnt_select_type_enum option, 
                                     U8 app_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&g_mmi_dtcnt_select_account, 0, sizeof(g_mmi_dtcnt_select_account));
    
    g_mmi_dtcnt_select_account.app_callback = callback;
    g_mmi_dtcnt_select_account.AppMenuID = AppMenuID;
    g_mmi_dtcnt_select_account.bearers = bearers;
    g_mmi_dtcnt_select_account.option = option;
    g_mmi_dtcnt_select_account.app_id = app_id;

    /* initialize 2 account id */
    g_mmi_dtcnt_select_account.primary_account_id = MMI_DTCNT_DEFAULT_ID;
    
    g_mmi_dtcnt_select_account.secondary_account_exist = MMI_FALSE;
    g_mmi_dtcnt_select_account.secondary_account_id = MMI_DTCNT_INVALID_ID;
    g_mmi_dtcnt_select_account.acct_changed = MMI_FALSE;
#ifdef __MMI_CBM_BEARER_FALLBACK__
    if (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_BEARER_SWITCH)
    {
        mmi_dtcnt_entry_select_bearers_switch_account();
    }
    else
#endif /* __MMI_CBM_BEARER_FALLBACK__ */
    {
        mmi_dtcnt_entry_select_account_without_bearer_switch();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_account_option
 * DESCRIPTION
 *  
 * PARAMETERS
 *         
 * RETURNS
 *  
 *****************************************************************************/
void mmi_dtcnt_select_account_option_with_id(FuncPtrU32 callback, 
                                     U16 AppMenuID, 
                                     U8 bearers, 
                                     dtcnt_select_type_enum option, 
                                     U8 app_id,
                                     U32 dataaccount_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cbm_account_info_struct *acct_info = NULL;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(&g_mmi_dtcnt_select_account, 0, sizeof(g_mmi_dtcnt_select_account));
    
    g_mmi_dtcnt_select_account.app_callback = callback;
    g_mmi_dtcnt_select_account.AppMenuID = AppMenuID;
    g_mmi_dtcnt_select_account.bearers = bearers;
    g_mmi_dtcnt_select_account.option = option;
    g_mmi_dtcnt_select_account.app_id = app_id;

    acct_info = OslMalloc(sizeof(cbm_account_info_struct));
    cbm_decode_data_account_id_ext(dataaccount_id, acct_info);
    
    /* 
     * initialize 2 account id 
     */

    /* Primary */
    g_mmi_dtcnt_select_account.primary_account_id = 
            cbm_encode_data_account_id(
                acct_info->account[MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT].account_id,
                acct_info->account[MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT].sim_id,
                0,
                acct_info->account[MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT].is_always_ask);
    /* Secondary */
    g_mmi_dtcnt_select_account.secondary_account_exist = MMI_FALSE;
    g_mmi_dtcnt_select_account.secondary_account_id = MMI_DTCNT_INVALID_ID;
    if (acct_info->acct_num > MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT)
    {
        g_mmi_dtcnt_select_account.secondary_account_id = 
            cbm_encode_data_account_id(
                acct_info->account[MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT].account_id,
                acct_info->account[MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT].sim_id,
                0,
                acct_info->account[MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT].is_always_ask);
        g_mmi_dtcnt_select_account.secondary_account_exist = MMI_TRUE;
    }
    OslMfree(acct_info);
    acct_info = NULL;
    g_mmi_dtcnt_select_account.acct_changed = MMI_FALSE;
#ifdef __MMI_CBM_BEARER_FALLBACK__
    if (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_BEARER_SWITCH)
    {
        mmi_dtcnt_entry_select_bearers_switch_account();
    }
    else
#endif /* __MMI_CBM_BEARER_FALLBACK__ */
    {
        mmi_dtcnt_entry_select_account_without_bearer_switch();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_select_account_without_bearer_switch
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_entry_select_account_without_bearer_switch(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_dtcnt_select_single_account_option(g_mmi_dtcnt_select_account.app_callback, 
                                           g_mmi_dtcnt_select_account.AppMenuID,
                                           g_mmi_dtcnt_select_account.bearers,
                                           (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_SIM) ? DTCNT_SELECT_SIM : DTCNT_SELECT_NO_SIM,
                                           (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_ALWAYS_ASK) ? DTCNT_SELECT_ALWAYS_ASK : DTCNT_SELECT_NO_ALWAYS_ASK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_select_bearers_switch_account
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_entry_select_bearers_switch_account(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer = NULL;
    static S8 *accts_name[MMI_DTCNT_BEARER_FALLBACK_ACCOUNT_NUMBER_TOTAL];
    static S8 *accts_description[MMI_DTCNT_BEARER_FALLBACK_ACCOUNT_NUMBER_TOTAL];
    MMI_BOOL can_be_done = g_mmi_dtcnt_select_account.acct_changed;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    accts_name[MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT] = GetString(STR_ID_DTCNT_PRIMARY_ACCT);
    accts_name[MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT] = GetString(STR_ID_DTCNT_SECONDARY_ACCT);

    mmi_dtcnt_get_account_name(g_mmi_dtcnt_select_account.primary_account_id, 
        (S8*)g_mmi_dtcnt_select_account.primary_account_name, MAX_DATA_ACCOUNT_NAME_LEN);
    accts_description[MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT] = (S8*)g_mmi_dtcnt_select_account.primary_account_name;
    if (g_mmi_dtcnt_select_account.secondary_account_exist)
    {
        mmi_dtcnt_get_account_name(g_mmi_dtcnt_select_account.secondary_account_id, 
            (S8*)g_mmi_dtcnt_select_account.secondary_account_name, MAX_DATA_ACCOUNT_NAME_LEN);
    }
    else 
    {
        mmi_ucs2cpy((S8*)g_mmi_dtcnt_select_account.secondary_account_name, GetString(STR_GLOBAL_NONE));
    }
    accts_description[MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT] = (S8*)g_mmi_dtcnt_select_account.secondary_account_name; 
    
    EntryNewScreen(SCR_ID_DTCNT_SELECT_BEARER_SWITCH_ACCOUNT, NULL, mmi_dtcnt_entry_select_bearers_switch_account, NULL);

    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_SELECT_BEARER_SWITCH_ACCOUNT);
    
    RegisterHighlightHandler(mmi_dtcnt_entry_select_bearers_switch_account_highlight_hdlr);

    ShowCategory53Screen(
        STR_GLOBAL_DATA_ACCOUNT,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_EDIT,
        IMG_GLOBAL_OK,
        (U16)(can_be_done ? STR_GLOBAL_DONE : STR_GLOBAL_BACK),
        IMG_GLOBAL_BACK,
        MMI_DTCNT_BEARER_FALLBACK_ACCOUNT_NUMBER_TOTAL,
        (U8**)accts_name,
        (U16*)gIndexIconsImageList,
        (U8**)accts_description,
        0,
        0,
        guiBuffer);
    /*
    SetLeftSoftkeyFunction(mmi_dtcnt_entry_select_bearers_switch_account_opt, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_entry_select_bearers_switch_account_opt, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    */
    
    if (can_be_done)
    {
        SetRightSoftkeyFunction(mmi_dtcnt_select_bearers_account_option_done, KEY_EVENT_UP);
        SetKeyHandler(mmi_dtcnt_select_bearers_account_option_done, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    }
    else
    {
        SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
        SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_select_bearers_switch_account_opt
 * DESCRIPTION
 * 
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_entry_select_bearers_switch_account_opt(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 numItems;
    U16 nStrItemList[2];    /* Edit & Done */
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_DTCNT_SELECT_BEARER_SWITCH_ACCOUNT_OPT, NULL, mmi_dtcnt_entry_select_bearers_switch_account_opt, NULL);
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_SELECT_BEARER_SWITCH_ACCOUNT_OPT);
    SetParentHandler(MENU_ID_DTCNT_SELECT_BEARERS_ACCOUNT_OPTION);
   
    numItems = GetNumOfChild(MENU_ID_DTCNT_SELECT_BEARERS_ACCOUNT_OPTION);
    GetSequenceStringIds(MENU_ID_DTCNT_SELECT_BEARERS_ACCOUNT_OPTION, nStrItemList);
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);
    ShowCategory52Screen(
        STR_GLOBAL_OPTIONS,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        numItems,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        NULL,
        0,
        0,
        guiBuffer);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_bearers_account_option_edit_highlight_hdlr
 * DESCRIPTION
 *  highlight handler for menu item
 * PARAMETERS
 *         
 * RETURNS
 *  
 *****************************************************************************/
void mmi_dtcnt_select_bearers_account_option_edit_highlight_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_dtcnt_select_account.current_item_selected == MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT)
    {
        SetLeftSoftkeyFunction(mmi_dtcnt_select_primary_account, KEY_EVENT_UP);
        SetKeyHandler(mmi_dtcnt_select_primary_account, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    }
    else if (g_mmi_dtcnt_select_account.current_item_selected == MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT)
    {
        SetLeftSoftkeyFunction(mmi_dtcnt_select_secondary_account, KEY_EVENT_UP);
        SetKeyHandler(mmi_dtcnt_select_secondary_account, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    }
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_bearers_account_option_done_highlight_hdlr
 * DESCRIPTION
 *  highlight handler for menu item
 * PARAMETERS
 *         
 * RETURNS
 *  
 *****************************************************************************/
void mmi_dtcnt_select_bearers_account_option_done_highlight_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_dtcnt_select_bearers_account_option_done, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_select_bearers_account_option_done, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_bearers_account_option_done
 * DESCRIPTION
 *  
 * PARAMETERS
 *         
 * RETURNS
 *  
 *****************************************************************************/
static void mmi_dtcnt_select_bearers_account_option_done(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cbm_account_info_struct *acct_info_ptr = OslMalloc(sizeof(cbm_account_info_struct));
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(acct_info_ptr, 0, sizeof(cbm_account_info_struct));
    /* account info */
    acct_info_ptr->acct_num = 0;
    acct_info_ptr->app_id = 0;
    /* primary */
    acct_info_ptr->account[MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT].account_id = 
        cbm_get_original_id_data_account(g_mmi_dtcnt_select_account.primary_account_id);
    acct_info_ptr->account[MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT].is_always_ask = 
        cbm_is_always_ask_data_account(g_mmi_dtcnt_select_account.primary_account_id);
    acct_info_ptr->account[MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT].sim_id = 
        cbm_get_sim_info_data_account(g_mmi_dtcnt_select_account.primary_account_id);
    acct_info_ptr->acct_num++;
    /* secondary */
    if (g_mmi_dtcnt_select_account.secondary_account_exist)
    {
        acct_info_ptr->account[MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT].account_id = 
            cbm_get_original_id_data_account(g_mmi_dtcnt_select_account.secondary_account_id);
        acct_info_ptr->account[MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT].is_always_ask = 
            cbm_is_always_ask_data_account(g_mmi_dtcnt_select_account.secondary_account_id);
        acct_info_ptr->account[MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT].sim_id = 
        cbm_get_sim_info_data_account(g_mmi_dtcnt_select_account.secondary_account_id);
        acct_info_ptr->acct_num++;
    }
    cbm_encode_data_account_id_ext(0, 
                                &g_mmi_dtcnt_select_account.bearer_fallback_account_id, 
                                acct_info_ptr);
    OslMfree(acct_info_ptr);
    acct_info_ptr = NULL;
    /* MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_ID, g_mmi_dtcnt_select_account.bearer_fallback_account_id); */
    g_mmi_dtcnt_select_account.app_callback(g_mmi_dtcnt_select_account.bearer_fallback_account_id);

    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_entry_select_bearers_switch_account_highlight_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_entry_select_bearers_switch_account_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_select_account.current_item_selected = nIndex;
    if (g_mmi_dtcnt_select_account.current_item_selected == MMI_DTCNT_BEARER_FALLBACK_PRIMARY_ACCTOUNT)
    {
        SetLeftSoftkeyFunction(mmi_dtcnt_select_primary_account, KEY_EVENT_UP);
        SetKeyHandler(mmi_dtcnt_select_primary_account, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    }
    else if (g_mmi_dtcnt_select_account.current_item_selected == MMI_DTCNT_BEARER_FALLBACK_SECONDARY_ACCOUNT)
    {
        SetLeftSoftkeyFunction(mmi_dtcnt_select_secondary_account, KEY_EVENT_UP);
        SetKeyHandler(mmi_dtcnt_select_secondary_account, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_primary_account
 * DESCRIPTION
 *  
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_select_primary_account(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_dtcnt_select_single_account_option_with_id(mmi_dtcnt_primary_account_callback_hdlr, 
        MENU_ID_PROF_DATA_ACCOUNT,
        g_mmi_dtcnt_select_account.bearers,
        (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_SIM) ? DTCNT_SELECT_SIM : DTCNT_SELECT_NO_SIM,
        (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_ALWAYS_ASK) ? DTCNT_SELECT_ALWAYS_ASK : DTCNT_SELECT_NO_ALWAYS_ASK,
        g_mmi_dtcnt_select_account.primary_account_id);  
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_primary_account_callback_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_primary_account_callback_hdlr(U32 primary_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 primary_bearer_out = 0;
    U8 secondary_bearer_out = 0;
    U8 id_primary = 0;   /* dummy */
    U8 id_secondary = 0;   /* dummy */
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_select_account.primary_account_id = primary_id;
    
    if (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_ALLOW_SAME_BEARER_SWITCH)
    {
        abm_nw2bearer_id(g_mmi_dtcnt_select_account.primary_account_id, &primary_bearer_out, &id_primary);
        if (g_mmi_dtcnt_select_account.secondary_account_exist)
        {/* DTCNT_SELECT_ALLOW_SAME_BEARER_SWITCH is allowed, only wifi account should not duplicate */
            abm_nw2bearer_id(g_mmi_dtcnt_select_account.secondary_account_id, &secondary_bearer_out, &id_secondary);
            if ((primary_bearer_out == ABM_E_SOCKET_BEARER_WIFI) && 
                (secondary_bearer_out == ABM_E_SOCKET_BEARER_WIFI))
            {
                if (cbm_is_always_ask_data_account(g_mmi_dtcnt_select_account.primary_account_id) || 
                    cbm_is_always_ask_data_account(g_mmi_dtcnt_select_account.secondary_account_id))
                {/* always ask */
                    /* do nothing */
                }
                /*
                else if (cbm_get_sim_info_data_account(g_mmi_dtcnt_select_account.primary_account_id) != 
                        cbm_get_sim_info_data_account(g_mmi_dtcnt_select_account.secondary_account_id))
                {
                    ;
                }
                */
                else
                {
                    g_mmi_dtcnt_select_account.secondary_account_exist = MMI_FALSE;
                }
            }
        }
    }
    else /* if DTCNT_SELECT_ALLOW_SAME_BEARER_SWITCH is not allowed, restore the secondary */
    {
        abm_nw2bearer_id(g_mmi_dtcnt_select_account.primary_account_id, &primary_bearer_out, &id_primary);
        if (g_mmi_dtcnt_select_account.secondary_account_exist)
        {
            abm_nw2bearer_id(g_mmi_dtcnt_select_account.secondary_account_id, &secondary_bearer_out, &id_secondary);
            if (primary_bearer_out == secondary_bearer_out)
            {
                if (cbm_is_always_ask_data_account(g_mmi_dtcnt_select_account.primary_account_id) || 
                    cbm_is_always_ask_data_account(g_mmi_dtcnt_select_account.secondary_account_id))
                {/* always ask */
                    /* do nothing */
                }
                else
                {
                    g_mmi_dtcnt_select_account.secondary_account_exist = MMI_FALSE;
                }
            }
        }
    }
    g_mmi_dtcnt_select_account.acct_changed = MMI_TRUE;
    DeleteUptoScrID(SCR_ID_DTCNT_SELECT_BEARER_SWITCH_ACCOUNT);
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_secondary_account
 * DESCRIPTION
 *  
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_select_secondary_account(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 bearer_out = 0;
    U8 bearer_not_allowed = 0;
    U8 id = 0;   /* dummy */
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_ALLOW_SAME_BEARER_SWITCH)
    {/* DTCNT_SELECT_ALLOW_SAME_BEARER_SWITCH is allowed */
        if (abm_nw2bearer_id(g_mmi_dtcnt_select_account.primary_account_id, &bearer_out, &id) == KAL_TRUE)
        {
            switch (bearer_out)
            {
            #ifdef __MMI_WLAN_FEATURES__
                case ABM_E_SOCKET_BEARER_WIFI:
                    bearer_not_allowed |= DATA_ACCOUNT_BEARER_WIFI;
                    break;
            #endif /* __MMI_WLAN_FEATURES__ */ 
                default:
                    break;
            }
        }
    }
    else /* DTCNT_SELECT_ALLOW_SAME_BEARER_SWITCH is not allowed(as default) */
    {
        if (abm_nw2bearer_id(g_mmi_dtcnt_select_account.primary_account_id, &bearer_out, &id) == KAL_TRUE)
        {
            switch (bearer_out)
            {
                case ABM_E_SOCKET_BEARER_GSM_CSD:
                    bearer_not_allowed |= DATA_ACCOUNT_BEARER_CSD;
                    break;
            #ifdef __MMI_GPRS_FEATURES__
                case ABM_E_SOCKET_BEARER_GSM_GPRS:
                    bearer_not_allowed |= DATA_ACCOUNT_BEARER_GPRS;
                    break;
            #endif /* __MMI_GPRS_FEATURES__ */ 
            
            #ifdef __MMI_WLAN_FEATURES__
                case ABM_E_SOCKET_BEARER_WIFI:
                    bearer_not_allowed |= DATA_ACCOUNT_BEARER_WIFI;
                    break;
            #endif /* __MMI_WLAN_FEATURES__ */ 
                default:
                    break;
            }
        }
    }
    if (cbm_is_always_ask_data_account(g_mmi_dtcnt_select_account.primary_account_id))
    {
        bearer_not_allowed = 0;
    }
    g_mmi_dtcnt_select_account.none_option_is_selected = MMI_FALSE;
    mmi_dtcnt_select_secondary_account_option_edit(mmi_dtcnt_secondary_account_callback_hdlr, 
        MENU_ID_PROF_DATA_ACCOUNT,
        (U8)(g_mmi_dtcnt_select_account.bearers ^ bearer_not_allowed),
        (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_SIM) ? DTCNT_SELECT_SIM : DTCNT_SELECT_NO_SIM,
        (g_mmi_dtcnt_select_account.option & DTCNT_SELECT_ALWAYS_ASK) ? DTCNT_SELECT_ALWAYS_ASK : DTCNT_SELECT_NO_ALWAYS_ASK,
        g_mmi_dtcnt_select_account.secondary_account_id);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_secondary_account_callback_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  nIndex      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_secondary_account_callback_hdlr(U32 secondary_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_select_account.secondary_account_exist = MMI_TRUE;
    g_mmi_dtcnt_select_account.secondary_account_id = secondary_id;
    
    if (g_mmi_dtcnt_select_account.none_option_is_selected)
    {
        g_mmi_dtcnt_select_account.secondary_account_exist = MMI_FALSE;
        g_mmi_dtcnt_select_account.secondary_account_id = MMI_DTCNT_INVALID_ID;
    }
    g_mmi_dtcnt_select_account.acct_changed = MMI_TRUE;
    DeleteUptoScrID(SCR_ID_DTCNT_SELECT_BEARER_SWITCH_ACCOUNT);
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_secondary_account_none
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void mmi_dtcnt_select_secondary_account_none(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U32 acct_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_select_account.none_option_is_selected = MMI_TRUE;
    acct_id = MMI_DTCNT_INVALID_ID;
    /* return the encode acct id */
    if(g_mmi_dtcnt_account_selection.app_callback)
    {
        g_mmi_dtcnt_account_selection.app_callback(acct_id);
        g_mmi_dtcnt_account_selection.app_callback = NULL;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_secondary_account_option_edit
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void mmi_dtcnt_select_secondary_account_option_edit(FuncPtrU32 callback, U16 AppMenuID, U8 bearers, dtcnt_select_type_enum sim_info, dtcnt_select_type_enum always_ask, U32 account_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* g_mmi_dtcnt_account_selection.sel_acct_procedure = MMI_DTCNT_SELECT_SINGLE_ACCOUNT_OPTION; */
    g_mmi_dtcnt_account_selection.app_callback = callback;
    g_mmi_dtcnt_account_selection.AppMenuID = AppMenuID;
    g_mmi_dtcnt_account_selection.CurrAppMainSelectItem = 0;

    g_mmi_dtcnt_account_selection.CurrAppSelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 
    g_mmi_dtcnt_account_selection.bearers = bearers;
    g_mmi_dtcnt_account_selection.select_none_option = MMI_TRUE;
    g_mmi_dtcnt_account_selection.sim_info = sim_info;
    g_mmi_dtcnt_account_selection.always_ask = always_ask;

    g_mmi_dtcnt_account_selection.account_id = account_id;
    mmi_dtcnt_select_account_entry_option();
}


#define SELECT_ACCOUNT_OPTION
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_single_account_option
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
void mmi_dtcnt_select_single_account_option(FuncPtrU32 callback, U16 AppMenuID, U8 bearers, dtcnt_select_type_enum sim_info, dtcnt_select_type_enum always_ask)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* g_mmi_dtcnt_account_selection.sel_acct_procedure = MMI_DTCNT_SELECT_SINGLE_ACCOUNT_OPTION; */
    g_mmi_dtcnt_account_selection.app_callback = callback;
    g_mmi_dtcnt_account_selection.AppMenuID = AppMenuID;
    g_mmi_dtcnt_account_selection.CurrAppMainSelectItem = 0;

    g_mmi_dtcnt_account_selection.CurrAppSelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 
    g_mmi_dtcnt_account_selection.bearers = bearers;
    
    g_mmi_dtcnt_account_selection.select_none_option = MMI_FALSE;
    g_mmi_dtcnt_account_selection.sim_info = sim_info;
    g_mmi_dtcnt_account_selection.always_ask = always_ask;
    g_mmi_dtcnt_account_selection.account_id = MMI_DTCNT_INVALID_ID;
    /* mmi_dtcnt_select_account_entry_option(); */
    mmi_dtcnt_select_account_entry_option();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_single_account_option_with_id
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
void mmi_dtcnt_select_single_account_option_with_id(FuncPtrU32 callback, U16 AppMenuID, U8 bearers, dtcnt_select_type_enum sim_info, dtcnt_select_type_enum always_ask, U32 account_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* g_mmi_dtcnt_account_selection.sel_acct_procedure = MMI_DTCNT_SELECT_SINGLE_ACCOUNT_OPTION; */
    g_mmi_dtcnt_account_selection.app_callback = callback;
    g_mmi_dtcnt_account_selection.AppMenuID = AppMenuID;
    g_mmi_dtcnt_account_selection.CurrAppMainSelectItem = 0;

    g_mmi_dtcnt_account_selection.CurrAppSelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 
    g_mmi_dtcnt_account_selection.bearers = bearers;
    
    g_mmi_dtcnt_account_selection.select_none_option = MMI_FALSE;
    g_mmi_dtcnt_account_selection.sim_info = sim_info;
    g_mmi_dtcnt_account_selection.always_ask = always_ask;

    g_mmi_dtcnt_account_selection.account_id = account_id;
    
    /* mmi_dtcnt_select_account_entry_option(); */
    mmi_dtcnt_select_account_entry_option();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_account_entry_option
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_select_account_entry_option(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i;
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U16 nNumofItem = 0;                 /* Stores no of children in the submenu */
    U16 str_id;
    U16 title_id, icon_id;
    U8 bearer_out = 0;
    U8 id_out = 0;   /* dummy */
    cbm_sim_id_enum sim_info = CBM_SIM_ID_SIM1;
    U8 is_always_ask = 0;
    U8 hilighted_item = 0;
    BOOL first_entrance = MMI_TRUE;
    U16 exit_screen_id = 0;
    MMI_BOOL is_valid_bearer = MMI_TRUE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_account_selection.CurrAppSelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_account_selection.GPRSCurrAppSelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 

    is_valid_bearer = abm_nw2bearer_id(g_mmi_dtcnt_account_selection.account_id, &bearer_out, &id_out);
    sim_info = cbm_get_sim_info_data_account(g_mmi_dtcnt_account_selection.account_id);
    is_always_ask = cbm_is_always_ask_data_account(g_mmi_dtcnt_account_selection.account_id);
    g_entry_option_back_flag = FALSE;

#ifndef __MMI_CBM_ALWAYS_ASK__
        g_mmi_dtcnt_account_selection.always_ask = DTCNT_SELECT_NO_ALWAYS_ASK;
#endif /* __MMI_CBM_ALWAYS_ASK__ */

#ifndef __MMI_DUAL_SIM__
        g_mmi_dtcnt_account_selection.sim_info = DTCNT_SELECT_NO_SIM;
#endif /* __MMI_DUAL_SIM__ */

    if(g_mmi_dtcnt_account_selection.sim_info == DTCNT_SELECT_SIM)
    {
        for (i = 0; g_dtcnt_selections_ext_sim[i].bearer > 0; i++)
        {
            if (g_dtcnt_selections_ext_sim[i].bearer == DATA_ACCOUNT_INVALID_ID)
            {
                if (!g_mmi_dtcnt_account_selection.select_none_option)
                {
                    continue;
                }
            }
            if (g_dtcnt_selections_ext_sim[i].bearer == DATA_ACCOUNT_ALWAYS_ASK)
            {
                if (g_mmi_dtcnt_account_selection.always_ask == DTCNT_SELECT_NO_ALWAYS_ASK)
                {
                    continue;
                }
                if (is_always_ask)
                {
                    hilighted_item = nNumofItem;
                }
            }
        #ifdef __MMI_DUAL_SIM__
            if (g_dtcnt_selections_ext_sim[i].bearer == DATA_ACCOUNT_SIM1)
            {
            #ifdef __MMI_WLAN_FEATURES__    
                if (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY)
                {
                    continue;
                }
            #endif /* __MMI_WLAN_FEATURES__ */
                if (!is_always_ask && is_valid_bearer && sim_info == CBM_SIM_ID_SIM1)
                {
                    hilighted_item = nNumofItem;
                }
            }
        #endif /* __MMI_DUAL_SIM__ */

        #ifdef __MMI_DUAL_SIM__
            if ((g_dtcnt_selections_ext_sim[i].bearer == DATA_ACCOUNT_SIM2))            
            {
            #ifdef __MMI_WLAN_FEATURES__    
                if (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY)
                {
                    continue;
                }
            #endif /* __MMI_WLAN_FEATURES__ */
                if (!is_always_ask && is_valid_bearer && sim_info == CBM_SIM_ID_SIM2)
                {
                    hilighted_item = nNumofItem;
                }
            }
        #endif /* __MMI_DUAL_SIM__ */
        
        #ifdef __MMI_WLAN_FEATURES__
            if (g_dtcnt_selections_ext[i].bearer == DATA_ACCOUNT_BEARER_WIFI)
            {
                if (!(g_mmi_dtcnt_account_selection.bearers & DATA_ACCOUNT_BEARER_WIFI))
                {
                    continue;
                }
                if (mmi_netset_get_active_preferred_mode() == P_GSM_ONLY)
                {
                    continue;
                }
                if (!is_always_ask && is_valid_bearer && bearer_out == ABM_E_SOCKET_BEARER_WIFI)
                {
                    hilighted_item = nNumofItem;
                }
            }
        #endif /* __MMI_WLAN_FEATURES__ */

            nStrItemList[nNumofItem] = g_dtcnt_selections_ext_sim[i].name;
            g_mmi_dtcnt_account_selection.bearer_callbacks[nNumofItem] = g_dtcnt_selections_ext_sim[i].func;
            nNumofItem++;
        }
    }
    else /* DTCNT_SELECT_NO_SIM */
    {
        for (i = 0; g_dtcnt_selections_ext[i].bearer > 0; i++)
        {
            if (g_dtcnt_selections_ext[i].bearer == DATA_ACCOUNT_INVALID_ID)
            {
                if (!g_mmi_dtcnt_account_selection.select_none_option)
                {
                    continue;
                }
            }
        #ifdef __MMI_CBM_ALWAYS_ASK__
            if (g_dtcnt_selections_ext[i].bearer == DATA_ACCOUNT_ALWAYS_ASK)
            {
                if (g_mmi_dtcnt_account_selection.always_ask == DTCNT_SELECT_NO_ALWAYS_ASK)
                {
                    continue;
                }
            }
        #endif /* __MMI_CBM_ALWAYS_ASK__ */
            if (g_dtcnt_selections_ext[i].bearer == DATA_ACCOUNT_BEARER_CSD)
            {
                if (!(g_mmi_dtcnt_account_selection.bearers & DATA_ACCOUNT_BEARER_CSD))
                {
                    continue;
                }
            #ifdef __MMI_DUAL_SIM_MASTER__
                if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
            #else /*__MMI_DUAL_SIM_MASTER__*/
                if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
            #endif /*__MMI_DUAL_SIM_MASTER__*/
                {
                    continue;
                }
            #ifdef __MMI_WLAN_FEATURES__    
                if (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY)
                {
                    continue;
                }
            #endif /* __MMI_WLAN_FEATURES__ */
            }

        #ifdef __MMI_GPRS_FEATURES__
            if (g_dtcnt_selections_ext[i].bearer == DATA_ACCOUNT_BEARER_GPRS)
            {
                if (!(g_mmi_dtcnt_account_selection.bearers & DATA_ACCOUNT_BEARER_GPRS))
                {
                    continue;
                }
            #ifdef __MMI_DUAL_SIM_MASTER__
                if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
            #else /*__MMI_DUAL_SIM_MASTER__*/
                if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
            #endif /*__MMI_DUAL_SIM_MASTER__*/
                {
                    continue;
                }
            #ifdef __MMI_WLAN_FEATURES__    
                if (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY)
                {
                    continue;
                }
            #endif /* __MMI_WLAN_FEATURES__ */
            }
        #endif /* __MMI_GPRS_FEATURES__ */
            
        #ifdef __MMI_WLAN_FEATURES__
            if (g_dtcnt_selections_ext[i].bearer == DATA_ACCOUNT_BEARER_WIFI)
            {
                if (!(g_mmi_dtcnt_account_selection.bearers & DATA_ACCOUNT_BEARER_WIFI))
                {
                    continue;
                }
                if (mmi_netset_get_active_preferred_mode() == P_GSM_ONLY)
                {
                    continue;
                }
            }
        #endif /* __MMI_WLAN_FEATURES__ */

            nStrItemList[nNumofItem] = g_dtcnt_selections_ext[i].name;
            g_mmi_dtcnt_account_selection.bearer_callbacks[nNumofItem] = g_dtcnt_selections_ext[i].func;
            nNumofItem++;
        }

        if ((nNumofItem == 1) && (!g_entry_option_back_flag))
        {
            if (g_mmi_dtcnt_account_selection.bearer_callbacks[0] == mmi_dtcnt_pre_entry_app_csd_list)
            {/* popup csd account list directly */
                DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION);
                mmi_dtcnt_pre_entry_app_csd_list();
                return;
            }
        #ifdef __MMI_GPRS_FEATURES__
            else if (g_mmi_dtcnt_account_selection.bearer_callbacks[0] == mmi_dtcnt_pre_entry_app_gprs_list)
            {/* popup gprs account list directly */
                DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION);
                mmi_dtcnt_pre_entry_app_gprs_list();
                return;
            }
        #endif /* __MMI_GPRS_FEATURES__ */
        }
    }

    if (CheckIsBackHistory())
    {
        first_entrance = MMI_FALSE;
        exit_screen_id = GetExitScrnID();
    }
    if (first_entrance)
    {
        g_mmi_dtcnt_account_selection.CurrAppMainSelectItem = hilighted_item;
    }
    
    EntryNewScreen(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION, NULL, mmi_dtcnt_select_account_entry_option, NULL);
    
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION);
    
    /* SetDelScrnIDCallbackHandler(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION, (HistoryDelCBPtr) mmi_dtcnt_always_ask_screen_del_handler); */

    str_id = STR_GLOBAL_BACK;
    title_id = SERVICES_DATA_CONNECT_MAIN_STRING_ID;
    icon_id = GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID);
    
    if(nNumofItem == 0)
    {
        DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ACCOUNT_SELECTION);
        return;
    }
    
    RegisterHighlightHandler(mmi_dtcnt_account_select_highlight_hdlr);

    g_entry_option_back_flag = FALSE;
    ShowCategory52Screen(
        title_id,
        icon_id,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        str_id,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        0,
        0,
        g_mmi_dtcnt_account_selection.CurrAppMainSelectItem,
        guiBuffer);
    SetLeftSoftkeyFunction(mmi_dtcnt_account_select_ok, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_account_select_ok, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}


#define ALWAYS_ASK_OPTION
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_account_option_ext
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
void mmi_dtcnt_select_account_option_ext(FuncPtrU32Ext callback, U16 AppStrID, U16 AppIconID, U8 bearers, dtcnt_select_type_enum sim_info, dtcnt_select_type_enum always_ask)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_always_ask.app_callback_ext = callback;
    g_mmi_dtcnt_always_ask.CurrAAMainSelectItem = 0;
    g_mmi_dtcnt_always_ask.CurrAASelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_always_ask.GPRSCurrAASelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 
    g_mmi_dtcnt_always_ask.bearers = bearers;
    
    g_mmi_dtcnt_always_ask.sim_info = sim_info;
    g_mmi_dtcnt_always_ask.always_ask = always_ask;
    g_mmi_dtcnt_always_ask.app_str_id = AppStrID;
    g_mmi_dtcnt_always_ask.app_icon_id = AppIconID;
#ifdef __MMI_WLAN_FEATURES__
    g_wlan_highlight_index = 0;
#endif /* __MMI_WLAN_FEATURES__ */

    if (mmi_dtcnt_util_is_call_interrupt_allow())
    {
        mmi_dtcnt_select_account_entry_option_ext();
    }
    else
    {
        mmi_frm_add_history_before_cm_marker(SCR_ID_DTCNT_LIST_ALWAYS_ASK, mmi_dtcnt_select_account_entry_option_ext);
    }
}

/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_select_account_entry_option_ext
 * DESCRIPTION
 *  Entry select account screen for Always Ask
 * PARAMETERS
 *  void       
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_select_account_entry_option_ext(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i;
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U16 nNumofItem = 0;                 /* Stores no of children in the submenu */
    U16 str_id;
    U16 title_id, icon_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_mmi_dtcnt_always_ask.CurrAASelectItem = 0;
#ifdef __MMI_GPRS_FEATURES__
    g_mmi_dtcnt_always_ask.GPRSCurrAASelectItem = 0;
#endif /* __MMI_GPRS_FEATURES__ */ 

    g_always_ask_screen_del_handler_flag = FALSE;

#ifndef __MMI_CBM_ALWAYS_ASK__
    g_mmi_dtcnt_always_ask.always_ask = DTCNT_SELECT_NO_ALWAYS_ASK;
#endif /* __MMI_CBM_ALWAYS_ASK__ */
#ifndef __MMI_DUAL_SIM__
    g_mmi_dtcnt_always_ask.sim_info = DTCNT_SELECT_NO_SIM;
#endif /* __MMI_DUAL_SIM__ */

    if(g_mmi_dtcnt_always_ask.sim_info == DTCNT_SELECT_SIM)
    {
        for (i = 0; g_dtcnt_always_ask_selections_sim[i].bearer > 0; i++)
        {
        #ifdef __MMI_DUAL_SIM__
            if (g_dtcnt_always_ask_selections_sim[i].bearer == DATA_ACCOUNT_SIM1)
            {
                if (!mmi_bootup_is_sim_valid())
                {
                    continue;
                }
            #ifdef __MMI_DUAL_SIM_MASTER__
                if (MTPNP_AD_Get_Status() == MTPNP_AD_FLIGHT ||
                    MTPNP_AD_Get_Status() == MTPNP_AD_CARD2)
                {
                    continue;
                }
            #endif /* __MMI_DUAL_SIM_MASTER__ */
            #ifdef __MMI_WLAN_FEATURES__    
                if (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY)
                {
                    continue;
                }
            #endif /* __MMI_WLAN_FEATURES__ */
            }
        #endif /* __MMI_DUAL_SIM__ */

        #ifdef __MMI_DUAL_SIM__
            if ((g_dtcnt_always_ask_selections_sim[i].bearer == DATA_ACCOUNT_SIM2))            
            {
                if (!mmi_bootup_is_sim2_valid())
                {
                    continue;
                }
            #ifdef __MMI_DUAL_SIM_MASTER__
                if (MTPNP_AD_Get_Status() == MTPNP_AD_FLIGHT ||
                    MTPNP_AD_Get_Status() == MTPNP_AD_CARD1)
                {
                    continue;
                }
            #endif /* __MMI_DUAL_SIM_MASTER__ */
            #ifdef __MMI_WLAN_FEATURES__    
                if (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY)
                {
                    continue;
                }
            #endif /* __MMI_WLAN_FEATURES__ */
            }
        #endif /* __MMI_DUAL_SIM__ */
            
        #ifdef __MMI_WLAN_FEATURES__
            if (g_dtcnt_always_ask_selections_sim[i].bearer == DATA_ACCOUNT_BEARER_WIFI)
            {
                if (!(g_mmi_dtcnt_always_ask.bearers & DATA_ACCOUNT_BEARER_WIFI))
                {
                    continue;
                }
                if (mmi_netset_get_active_preferred_mode() == P_GSM_ONLY)
                {
                    continue;
                }
            }
        #endif /* __MMI_WLAN_FEATURES__ */
            
            nStrItemList[nNumofItem] = g_dtcnt_always_ask_selections_sim[i].name;
            g_mmi_dtcnt_always_ask.bearer_callbacks[nNumofItem] = g_dtcnt_always_ask_selections_sim[i].func;
            nNumofItem++;
        }
    }
    else /* DTCNT_SELECT_NO_SIM */
    {
        for (i = 0; g_dtcnt_always_ask_selections[i].bearer > 0; i++)
        {
            if (g_dtcnt_always_ask_selections[i].bearer == DATA_ACCOUNT_BEARER_CSD)
            {
                if (!(g_mmi_dtcnt_always_ask.bearers & DATA_ACCOUNT_BEARER_CSD))
                {
                    continue;
                }
                if (!mmi_dtcnt_is_sim_valid())
                {
                    continue;
                }
            #ifdef __MMI_DUAL_SIM_MASTER__
                if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
            #else /*__MMI_DUAL_SIM_MASTER__*/
                if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
            #endif /*__MMI_DUAL_SIM_MASTER__*/
                {
                    continue;
                }
            #ifdef __MMI_WLAN_FEATURES__    
                if (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY)
                {
                    continue;
                }
            #endif /* __MMI_WLAN_FEATURES__ */
            }
        #ifdef __MMI_GPRS_FEATURES__
            if (g_dtcnt_always_ask_selections[i].bearer == DATA_ACCOUNT_BEARER_GPRS)
            {
                if (!(g_mmi_dtcnt_always_ask.bearers & DATA_ACCOUNT_BEARER_GPRS))
                {
                    continue;
                }
                if (!mmi_dtcnt_is_sim_valid())
                {
                    continue;
                }
            #ifdef __MMI_DUAL_SIM_MASTER__
                if (MTPNP_AD_Get_UsableSide() < MTPNP_AD_SIMCARD1_USABLE)
            #else /*__MMI_DUAL_SIM_MASTER__*/
                if (simErrorDisplayString == STR_SIM_BLOCK_MSG)
            #endif /*__MMI_DUAL_SIM_MASTER__*/
                {
                    continue;
                }
            #ifdef __MMI_WLAN_FEATURES__    
                if (mmi_netset_get_active_preferred_mode() == P_WLAN_ONLY)
                {
                    continue;
                }
            #endif /* __MMI_WLAN_FEATURES__ */
            }
        #endif /* __MMI_GPRS_FEATURES__ */
            
        #ifdef __MMI_WLAN_FEATURES__
            if (g_dtcnt_always_ask_selections[i].bearer == DATA_ACCOUNT_BEARER_WIFI)
            {
                if (!(g_mmi_dtcnt_always_ask.bearers & DATA_ACCOUNT_BEARER_WIFI))
                {
                    continue;
                }
                if (mmi_netset_get_active_preferred_mode() == P_GSM_ONLY)
                {
                    continue;
                }
            }
        #endif /* __MMI_WLAN_FEATURES__ */

            nStrItemList[nNumofItem] = g_dtcnt_always_ask_selections[i].name;
            g_mmi_dtcnt_always_ask.bearer_callbacks[nNumofItem] = g_dtcnt_always_ask_selections[i].func;
            nNumofItem++;
        }

        if ((nNumofItem == 1) && (!g_entry_option_back_flag))
        {
            if (g_mmi_dtcnt_always_ask.bearer_callbacks[0] == mmi_dtcnt_always_ask_pre_entry_app_csd_list)
            {/* popup csd account list directly */
                DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
                mmi_dtcnt_always_ask_pre_entry_app_csd_list();
                return;
            }
        #ifdef __MMI_GPRS_FEATURES__
            else if (g_mmi_dtcnt_always_ask.bearer_callbacks[0] == mmi_dtcnt_always_ask_pre_entry_app_gprs_list)
            {/* popup gprs account list directly */
                DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
                mmi_dtcnt_always_ask_pre_entry_app_gprs_list();
                return;
            }
        #endif /* __MMI_GPRS_FEATURES__ */
        }
    }

    EntryNewScreen(SCR_ID_DTCNT_LIST_ALWAYS_ASK, NULL, mmi_dtcnt_select_account_entry_option_ext, NULL);
    
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
    
    SetDelScrnIDCallbackHandler(SCR_ID_DTCNT_LIST_ALWAYS_ASK, (HistoryDelCBPtr)mmi_dtcnt_always_ask_screen_del_handler);

    str_id = STR_GLOBAL_CANCEL;
    title_id = g_mmi_dtcnt_always_ask.app_str_id;
    icon_id = g_mmi_dtcnt_always_ask.app_icon_id;
    
    mmi_cbm_delete_fallback_screen_by_data_acct();
    
    if(nNumofItem == 0)
    {
        DisplayPopup((PU8) GetString(STR_ID_DTCNT_NO_AVAIABLE_ACCT), IMG_GLOBAL_ERROR, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
        DeleteScreenIfPresent(SCR_ID_DTCNT_LIST_ALWAYS_ASK);
        return;
    }
    
    RegisterHighlightHandler(mmi_dtcnt_always_ask_account_select_highlight_hdlr);

    g_entry_option_back_flag = FALSE;
    
    ShowCategory52Screen(
        title_id,
        icon_id,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        str_id,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        0,
        0,
        0,
        guiBuffer);
    SetLeftSoftkeyFunction(mmi_dtcnt_always_ask_select_ok, KEY_EVENT_UP);
    SetKeyHandler(mmi_dtcnt_always_ask_select_ok, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_dtcnt_always_ask_cancel, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(mmi_dtcnt_always_ask_cancel, KEY_EVENT_UP);
}


/*****************************************************************************
* FUNCTION
*  mmi_dtcnt_always_ask_screen_del_handler
* DESCRIPTION
*  
* PARAMETERS
*  in_param        [?]     
* RETURNS
*  void
*****************************************************************************/
U8 mmi_dtcnt_always_ask_screen_del_handler(void *in_param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FuncPtrU32Ext temp_callback_ext_ptr = NULL;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    PRINT_INFORMATION("$$$$$ CBM always ask screen end key handler app_call = %d, del_handler_flag = %d $$$$$", 
        0, g_always_ask_screen_del_handler_flag);

    if(!g_always_ask_screen_del_handler_flag)
    {
        g_always_ask_screen_del_handler_flag = TRUE;
        if(g_mmi_dtcnt_always_ask.app_callback_ext)
        {
            temp_callback_ext_ptr = g_mmi_dtcnt_always_ask.app_callback_ext;
            g_mmi_dtcnt_always_ask.app_callback_ext = NULL;
        }
        if (temp_callback_ext_ptr)
        {
            temp_callback_ext_ptr(0, FALSE, 0);
        }
    }
    return FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_is_sim_valid
 * DESCRIPTION
 *  Get SIM status for DataAccount use
 * PARAMETERS
 *  void
 * RETURNS
 *  U16 
 *****************************************************************************/
U16 mmi_dtcnt_is_sim_valid(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (mmi_bootup_is_sim_valid()
#if defined(__MMI_DUAL_SIM_MASTER__)	
        || mmi_bootup_is_sim2_valid()
#endif /* __MMI_DUAL_SIM_MASTER__ */
        )
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_bearer_type
 * DESCRIPTION
 *  
 * PARAMETERS
 *  bearers     [IN]        
 * RETURNS
 *  
 *****************************************************************************/
static void mmi_dtcnt_always_ask_cancel(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FuncPtrU32Ext temp_callback_ext_ptr = NULL;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_always_ask_screen_del_handler_flag = TRUE;
    if(g_mmi_dtcnt_always_ask.app_callback_ext)
    {
        temp_callback_ext_ptr = g_mmi_dtcnt_always_ask.app_callback_ext;
        g_mmi_dtcnt_always_ask.app_callback_ext = NULL;
    }
    GoBackHistory();
    if (temp_callback_ext_ptr)
    {
        temp_callback_ext_ptr(0, FALSE, 0);
    }
}


#define READONLY_ACCT_VIEWER
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_csd_editor_highlight_hdlr
 * DESCRIPTION
 *
 * PARAMETERS
 *
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_csd_viewer_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_DataAccount_Display.is_fallback_bearer)
    {
        if (g_DataAccount_Display.disp_primary)
        {
            ChangeLeftSoftkey(STR_ID_DTCNT_NEXT, 0);
            ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
            SetLeftSoftkeyFunction(mmi_dtcnt_switch_acct_view, KEY_EVENT_UP);
        }
        else
        {
            ChangeLeftSoftkey(STR_ID_DTCNT_PREVIOUS, 0);
            ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
            SetLeftSoftkeyFunction(mmi_dtcnt_switch_acct_view, KEY_EVENT_UP);
        }
    }
    else
    {
        ChangeLeftSoftkey(0, 0);
        ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        ClearKeyHandler(KEY_LSK, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTEdit
 * DESCRIPTION
 *  Edit Data Account
 *  
 *  This is used to edit Data Account Menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_csd_viewer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    U16 title_id = 0;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_DTCNT_EDIT, NULL, mmi_dtcnt_csd_viewer, NULL);
    if (g_DataAccount_Display.is_fallback_bearer)
    {
        if (g_DataAccount_Display.disp_primary)
        {
            title_id = STR_ID_DTCNT_PRIMARY_ACCT;
        }
        else
        {
            title_id = STR_ID_DTCNT_SECONDARY_ACCT;
        }
    }
    else
    {
        title_id = SERVICES_VIEW_DATA_CONNECT_GSM_STRING_ID;
    }
    InitializeCategory57Screen();
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_EDIT);
    SetParentHandler(MITEM_DATA_ACCOUNT_PARENT_ZERO);
    DataAccountFillInlineStruct();
    RegisterHighlightHandler(mmi_dtcnt_csd_viewer_highlight_hdlr);

    ShowCategory57Screen(
        title_id,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_EDIT,
        IMG_ID_DTCNT_LSK_EDIT,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_INLINE_ITEM_DATA_ACCOUNT_LIST,
        g_DataAccount_Display.IconList,
        wgui_inline_items,
        DATA_ACCOUNT_HILITED_ITEM,
        guiBuffer);

    SetCategory57RightSoftkeyFunctions(GoBackHistory, GoBackHistory);
    DeleteScreenIfPresent(SCR_ID_DTCNT_EDIT);
#ifdef __MMI_GPRS_FEATURES__
    DeleteScreenIfPresent(SCR_ID_DTCNT_GPRS_EDIT);
#endif /* __MMI_GPRS_FEATURES__ */
}


#ifdef __MMI_GPRS_FEATURES__
/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_gprs_editor_highlight_hdlr
 * DESCRIPTION
 *
 * PARAMETERS
 *
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_gprs_viewer_highlight_hdlr(S32 nIndex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_DataAccount_Display.is_fallback_bearer)
    {
        if (g_DataAccount_Display.disp_primary)
        {
            ChangeLeftSoftkey(STR_ID_DTCNT_NEXT, 0);
            ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
			SetLeftSoftkeyFunction(mmi_dtcnt_switch_acct_view, KEY_EVENT_UP);
        }
        else
        {
            ChangeLeftSoftkey(STR_ID_DTCNT_PREVIOUS, 0);
            ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
            SetLeftSoftkeyFunction(mmi_dtcnt_switch_acct_view, KEY_EVENT_UP);
        }
    }
    else
    {
        ChangeLeftSoftkey(0, 0);
        ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        ClearKeyHandler(KEY_LSK, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryDTCNTGPRSEdit
 * DESCRIPTION
 *  GPRS account editing screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_gprs_viewer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;      /* Buffer holding history data */
    U16 title_id = 0;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_DTCNT_GPRS_EDIT, NULL, mmi_dtcnt_gprs_viewer, NULL);
    if (g_DataAccount_Display.is_fallback_bearer)
    {
        if (g_DataAccount_Display.disp_primary)
        {
            title_id = STR_ID_DTCNT_PRIMARY_ACCT;
        }
        else
        {
            title_id = STR_ID_DTCNT_SECONDARY_ACCT;
        }
    }
    else
    {
        title_id = SERVICES_VIEW_DATA_CONNECT_GPRS_STRING_ID;
    }
    
    InitializeCategory57Screen();
    guiBuffer = GetCurrGuiBuffer(SCR_ID_DTCNT_GPRS_EDIT);
    SetParentHandler(MITEM_DATA_ACCOUNT_PARENT_ZERO);
    GPRSDataAccountFillInlineStruct();
    RegisterHighlightHandler(mmi_dtcnt_gprs_viewer_highlight_hdlr);

    ShowCategory57Screen(
        title_id,
        GetRootTitleIcon(SERVICES_DATA_CONNECT_MAIN_MENU_ID),
        STR_GLOBAL_EDIT,
        IMG_ID_DTCNT_LSK_EDIT,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_INLINE_ITEM_GPRSDATA_ACCOUNT_LIST,
        g_DataAccount_Display.IconList,
        wgui_inline_items,
        DATA_ACCOUNT_HILITED_ITEM,
        guiBuffer);
    
    SetCategory57RightSoftkeyFunctions(GoBackHistory, GoBackHistory);
    DeleteScreenIfPresent(SCR_ID_DTCNT_EDIT);
    DeleteScreenIfPresent(SCR_ID_DTCNT_GPRS_EDIT);
}
#endif /* __MMI_GPRS_FEATURES__ */


/*****************************************************************************
 * FUNCTION
 *  DTCNTGetAccountReq
 * DESCRIPTION
 *  Use the L4 to retrieve the Data Account Record.
 * PARAMETERS
 *  ItemNum     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_show_an_account_req(U8 bearer_type, U8 profile_type, U8 sim_id, U8 profile_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    void *my_msg_ptr = NULL;
    mmi_cc_get_csd_profile_req_struct *csdMsgPtr;
#ifdef __MMI_GPRS_FEATURES__
    mmi_ps_get_gprs_data_account_req_struct *gprsMsgPtr;
#endif /* __MMI_GPRS_FEATURES__ */
    MYQUEUE Message;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    /*
    MMI_EXT_ASSERT((sim_id == CBM_SIM_ID_SIM1 || sim_id == CBM_SIM_ID_SIM2) &&
                    (bearer_type == ABM_E_SOCKET_BEARER_GSM_CSD || bearer_type == ABM_E_SOCKET_BEARER_GSM_GPRS) &&
                     (profile_type == DATA_ACCT_CSD_PROF || profile_type == DATA_ACCT_GPRS_PROF || profile_type == DATA_ACCT_SPA_PROF) &&
                      (profile_id < MAX_DATA_ACCOUNT_GSM_LIMIT || profile_id <= MAX_DATA_ACCOUNT_GPRS_LIMIT),
                   sim_id,
                   bearer_type,
                   profile_id);
                   */
                   
    if (bearer_type == ABM_E_SOCKET_BEARER_GSM_CSD)
    {
        csdMsgPtr = (mmi_cc_get_csd_profile_req_struct*)
                        OslConstructDataPtr(sizeof(mmi_cc_get_csd_profile_req_struct));
        csdMsgPtr->prof_id = profile_id;
        csdMsgPtr->profile_type = profile_type;
        /* g_DataAccount_Display.disp_bearer = DATA_ACCOUNT_BEARER_CSD; */
        Message.oslMsgId = PRT_MMI_CC_GET_CSD_PROFILE_REQ;
        my_msg_ptr = csdMsgPtr;
        SetProtocolEventHandler(mmi_dtcnt_show_an_account_rsp, PRT_MMI_CC_GET_CSD_PROFILE_RSP);
    #ifdef __MMI_DUAL_SIM_MASTER__
        SetSlaveProtocolEventHandler(mmi_dtcnt_show_an_account_rsp, PRT_MMI_CC_GET_CSD_PROFILE_RSP); 
    #endif /* __MMI_DUAL_SIM_MASTER__ */
    }
#ifdef __MMI_GPRS_FEATURES__
    else if (bearer_type == ABM_E_SOCKET_BEARER_GSM_GPRS)
    {
        gprsMsgPtr = (mmi_ps_get_gprs_data_account_req_struct*)
                        OslConstructDataPtr(sizeof(mmi_ps_get_gprs_data_account_req_struct));
        gprsMsgPtr->profile_id = profile_id;
        gprsMsgPtr->profile_type = profile_type;
        /* g_DataAccount_Display.disp_bearer = DATA_ACCOUNT_BEARER_GPRS; */
        Message.oslMsgId = PRT_MMI_PS_GET_GPRS_DATA_ACCOUNT_REQ;
        my_msg_ptr = gprsMsgPtr; 
        SetProtocolEventHandler(mmi_dtcnt_show_an_account_rsp, PRT_MMI_PS_GET_GPRS_DATA_ACCOUNT_RSP);
    #ifdef __MMI_DUAL_SIM_MASTER__
        SetSlaveProtocolEventHandler(mmi_dtcnt_show_an_account_rsp, PRT_MMI_PS_GET_GPRS_DATA_ACCOUNT_RSP);
    #endif /* __MMI_DUAL_SIM_MASTER__ */
    }
#endif /* __MMI_GPRS_FEATURES__ */
    Message.oslDestId = MOD_L4C;
#ifdef __MMI_SIM_PROVISIONING_SUPPORT__
    if (profile_type == DATA_ACCT_CSD_PROF 
    #ifdef __MMI_GPRS_FEATURES__
        || profile_type == DATA_ACCT_GPRS_PROF
    #endif /* __MMI_GPRS_FEATURES__ */
        )
    {
        Message.oslDestId = MOD_L4C;
    }
    else if (profile_type == DATA_ACCT_SPA_PROF)
    {
        if (sim_id == CBM_SIM_ID_SIM1)
        {
            Message.oslDestId = MOD_L4C;
        }
    #ifdef __MMI_DUAL_SIM_MASTER__
        else if (sim_id == CBM_SIM_ID_SIM2)
        {
            Message.oslDestId = MOD_L4C_2;
        }
    #endif /* __MMI_DUAL_SIM_MASTER__ */
    }
#endif /* __MMI_SIM_PROVISIONING_SUPPORT__ */
    Message.oslSrcId = MOD_MMI;
    Message.oslDataPtr = (oslParaType*)my_msg_ptr;
    Message.oslPeerBuffPtr = NULL;
    OslMsgSendExtQueue(&Message);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_get_an_sim1_account_rsp
 * DESCRIPTION
 *  
 * PARAMETERS
 *  info        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_show_an_account_rsp(void *info)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_cc_get_csd_profile_rsp_struct *csd_ptr;
#ifdef __MMI_GPRS_FEATURES__
    mmi_ps_get_gprs_data_account_rsp_struct *gprs_ptr;
#endif /* __MMI_GPRS_FEATURES__ */
    U8 i = 0;
    U8 name_length = 0;
    S16 tmp_ucs2 = 0;
    
    U8 sim_id = CBM_SIM_ID_SIM1;
    U8 bearer_type = ABM_E_SOCKET_BEARER_GSM_GPRS;
    U8 profile_id = 0;
    U8 profile_type = CBM_NVRAM_PROFILE;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_DataAccount_Display.readonly = MMI_TRUE;
    if (g_DataAccount_Display.disp_primary)
    {
        cbm_get_profile_info_by_account_id(g_DataAccount_Display.primary_id, &profile_type, &bearer_type, &profile_id);
        sim_id = g_DataAccount_Display.primary_sim;
    }
    else if (g_DataAccount_Display.is_fallback_bearer)
    {
        cbm_get_profile_info_by_account_id(g_DataAccount_Display.secondary_id, &profile_type, &bearer_type, &profile_id);
        sim_id = g_DataAccount_Display.secondary_sim;
    }
    else /* something wrong */
    {
        DisplayPopup((PU8)GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
    }
    
    if (bearer_type == ABM_E_SOCKET_BEARER_GSM_CSD)
    {
        csd_ptr = (mmi_cc_get_csd_profile_rsp_struct*)info;
        
        g_DataAccount_Display.DialTypeOption[0] = (U8*) GetString(STR_ID_DTCNT_ANALOGUE_STR);
        g_DataAccount_Display.DialTypeOption[1] = (U8*) GetString(STR_ID_DTCNT_ISDN_STR);
        
        g_DataAccount_Display.DialRateOption[0] = (U8*) GetString(STR_ID_DTCNT_RATE_STR_ONE);
        g_DataAccount_Display.DialRateOption[1] = (U8*) GetString(STR_ID_DTCNT_RATE_STR_TWO);
        g_DataAccount_Display.DialRateOption[2] = (U8*) GetString(STR_ID_DTCNT_RATE_STR_THREE);

        /* Account Name */
        if (csd_ptr->name.name_dcs == DATA_ACCOUNT_UCS)
        {
            name_length = MAX_DATA_ACCOUNT_NAME_LEN * ENCODING_LENGTH;
            if (name_length >= csd_ptr->name.name_length)
            {
                name_length = csd_ptr->name.name_length;
            }
            else
            {
                MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_NAME_GET_FROM_L4C_ERROR, csd_ptr->name.name_length);
            }
            
            i = 0;
            if (name_length == 0)
            {
                mmi_ucs2cpy((PS8)g_DataAccount_Display.DataAccountName, (PS8)GetString(STR_ID_DTCNT_NAME));
            }
            else
            {
                while (i < name_length)
                {
                    g_DataAccount_Display.DataAccountName[i] = csd_ptr->name.name[i + 1];
                    g_DataAccount_Display.DataAccountName[i + 1] = csd_ptr->name.name[i];
                    i += 2;
                }
                g_DataAccount_Display.DataAccountName[name_length] = 0x00;
                g_DataAccount_Display.DataAccountName[name_length + 1] = 0x00;
            }
        }
        else if (csd_ptr->name.name_dcs == DATA_ACCOUNT_ASCII)
        {
            name_length = MAX_DATA_ACCOUNT_NAME_LEN;
            if (name_length >= csd_ptr->name.name_length)
            {
                name_length = csd_ptr->name.name_length;
            }
            else
            {
                MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_NAME_GET_FROM_L4C_ERROR, csd_ptr->name.name_length);
            }
        
            if (name_length == 0)
            {
                mmi_ucs2cpy((PS8)g_DataAccount_Display.DataAccountName, (PS8)GetString(STR_ID_DTCNT_NAME));
            }
            else
            {
                mmi_asc_n_to_ucs2(
                    (PS8)g_DataAccount_Display.DataAccountName,
                    (PS8)csd_ptr->name.name,
                    name_length);
                g_DataAccount_Display.DataAccountName[name_length * ENCODING_LENGTH] = 0x00;
                g_DataAccount_Display.DataAccountName[name_length * ENCODING_LENGTH + 1] = 0x00;
            }
        }

        /* User Name */
        mmi_asc_to_ucs2((PS8) g_DataAccount_Display.UserName, (PS8)csd_ptr->user_id);

        /* Password */
        mmi_asc_to_ucs2((PS8) g_DataAccount_Display.Passwd, (PS8)csd_ptr->passwd);

        /* Dial Number */
        if ((csd_ptr->dest.type) & 0x10)
        {
            tmp_ucs2 = L'+';
            g_DataAccount_Display.DialNumber[0] = *((U8*)(&tmp_ucs2));
            g_DataAccount_Display.DialNumber[1] = *(((U8*)(&tmp_ucs2)) + 1);
            mmi_asc_to_ucs2((PS8)g_DataAccount_Display.DialNumber + 2, (PS8)csd_ptr->dest.number);
        }
        else
        {
            mmi_asc_to_ucs2((PS8)g_DataAccount_Display.DialNumber, (PS8)csd_ptr->dest.number);
        }
        
        /* Dial Type */
        if (csd_ptr->type == (U8) CSMCC_ITC_3_1_K_AUDIO)
        {
            g_DataAccount_Display.DialType = DIAL_TYPE_ANALOGUE;
        }
        else
        {
            g_DataAccount_Display.DialType = DIAL_TYPE_ISDN;
        }

        /* Data Rate */
        if (csd_ptr->rate == (U8) CSD_PROF_RATE_4800)
        {
            g_DataAccount_Display.DataRate = DATA_RATE_FOUR_EIGHT - 1;
        }
        else if (csd_ptr->rate == (U8) CSD_PROF_RATE_9600)
        {
            g_DataAccount_Display.DataRate = DATA_RATE_NINE_SIX - 1;
        }
        else if (csd_ptr->rate == (U8) CSD_PROF_RATE_14400)
        {
            g_DataAccount_Display.DataRate = DATA_RATE_FOURTEEN_FOUR - 1;
        }
        else
        {
            g_DataAccount_Display.DataRate = DATA_RATE_FOUR_EIGHT - 1;
        }

        /* Dns Address */
        ReturnThreeDigitString(g_DataAccount_Display.IP1, csd_ptr->dns[0]);
        ReturnThreeDigitString(g_DataAccount_Display.IP2, csd_ptr->dns[1]);
        ReturnThreeDigitString(g_DataAccount_Display.IP3, csd_ptr->dns[2]);
        ReturnThreeDigitString(g_DataAccount_Display.IP4, csd_ptr->dns[3]);

        mmi_dtcnt_csd_viewer();
    }/* (g_DataAccount_Display.disp_bearer == DATA_ACCOUNT_BEARER_CSD) */
#ifdef __MMI_GPRS_FEATURES__
    else if(bearer_type == ABM_E_SOCKET_BEARER_GSM_GPRS)
    {
        gprs_ptr = (mmi_ps_get_gprs_data_account_rsp_struct*)info;

        g_DataAccount_Display.AuthTypeOption[0] = (U8*) GetString(STR_ID_DTCNT_GPRS_PAP_AUTH);
        g_DataAccount_Display.AuthTypeOption[1] = (U8*) GetString(STR_ID_DTCNT_GPRS_CHAP_AUTH);

        /* Account Name */
        if (gprs_ptr->gprs_account.name_dcs == DATA_ACCOUNT_UCS)
        {
            name_length = MAX_GPRS_DATAACCOUNT_NAME * ENCODING_LENGTH;
            if (name_length >= gprs_ptr->gprs_account.name_length)
            {
                name_length = gprs_ptr->gprs_account.name_length;
            }
            else
            {
                MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_NAME_GET_FROM_L4C_ERROR, gprs_ptr->gprs_account.name_length);
            }

            i = 0;
            if (name_length == 0)
            {
                mmi_ucs2cpy((PS8)g_DataAccount_Display.DataAccountName, (PS8)GetString(STR_ID_DTCNT_NAME));
            }
            else
            {
                while (i < name_length)
                {
                    g_DataAccount_Display.DataAccountName[i] = gprs_ptr->gprs_account.name[i + 1];
                    g_DataAccount_Display.DataAccountName[i + 1] = gprs_ptr->gprs_account.name[i];
                    i += 2;
                }
                g_DataAccount_Display.DataAccountName[name_length] = 0x00;
                g_DataAccount_Display.DataAccountName[name_length + 1] = 0x00;
            }
        }
        else if (gprs_ptr->gprs_account.name_dcs == DATA_ACCOUNT_ASCII)
        {
            name_length = MAX_GPRS_DATAACCOUNT_NAME * ENCODING_LENGTH;
            if (name_length >= gprs_ptr->gprs_account.name_length)
            {
                name_length = gprs_ptr->gprs_account.name_length;
            }
            else
            {
                MMI_TRACE(MMI_CONN_TRC_G6_DTCNT, MMI_DTCNT_ACCOUNT_NAME_GET_FROM_L4C_ERROR, gprs_ptr->gprs_account.name_length);
            }

            if (name_length == 0)
            {
                mmi_ucs2cpy((PS8)g_DataAccount_Display.DataAccountName, (PS8)GetString(STR_ID_DTCNT_NAME));
            }
            else
            {
                mmi_asc_n_to_ucs2(
                    (PS8)g_DataAccount_Display.DataAccountName,
                    (PS8)gprs_ptr->gprs_account.name,
                    name_length);
                g_DataAccount_Display.DataAccountName[name_length * ENCODING_LENGTH] = 0x00;
                g_DataAccount_Display.DataAccountName[name_length * ENCODING_LENGTH + 1] = 0x00;
            }
        }

        /* User Name */
        mmi_asc_to_ucs2((PS8)g_DataAccount_Display.UserName, (PS8)gprs_ptr->gprs_account.user_name);

        /* Password */
        mmi_asc_to_ucs2((PS8)g_DataAccount_Display.Passwd, (PS8)gprs_ptr->gprs_account.password);

        /* APN */
        mmi_asc_n_to_ucs2(
            (PS8)g_DataAccount_Display.APN,
            (PS8) gprs_ptr->gprs_account.apn,
            (U32) gprs_ptr->gprs_account.apn_length);

        /* Authentication Type */
        g_DataAccount_Display.AuthType = gprs_ptr->gprs_account.authentication_type;

        /* Dns Address */
        ReturnThreeDigitString(g_DataAccount_Display.IP1, (U8)gprs_ptr->gprs_account.dns[0]);
        ReturnThreeDigitString(g_DataAccount_Display.IP2, (U8)gprs_ptr->gprs_account.dns[1]);
        ReturnThreeDigitString(g_DataAccount_Display.IP3, (U8)gprs_ptr->gprs_account.dns[2]);
        ReturnThreeDigitString(g_DataAccount_Display.IP4, (U8)gprs_ptr->gprs_account.dns[3]);

        mmi_dtcnt_gprs_viewer();
    }/* (bearer_type == ABM_E_SOCKET_BEARER_GSM_GPRS) */
#endif /* __MMI_GPRS_FEATURES__ */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_account_view
 * DESCRIPTION
 *  Display the detail info of any GPRS/CSD account by U32 account id.
 * PARAMETERS
 *  acct_id     [in]    data account id
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_switch_acct_view(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_DataAccount_Display.is_fallback_bearer)
    {
        /* TRUE --> FALSE && FALSE --> TRUE */
        if (g_DataAccount_Display.disp_primary)
        {
            g_DataAccount_Display.disp_primary = MMI_FALSE;
        }
        else
        {
            g_DataAccount_Display.disp_primary = MMI_TRUE;
        }
    }
    else
    {
        DisplayPopup((PU8)GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
    }
    mmi_dtcnt_display_one_acct();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_display_primary
 * DESCRIPTION
 *  
 * PARAMETERS
 *  acct_id     [in]    data account id
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_dtcnt_display_one_acct(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 sim_id = CBM_SIM_ID_SIM1;
    U8 bearer_type = ABM_E_SOCKET_BEARER_GSM_GPRS;
    U8 profile_id = 0;
    U8 profile_type = CBM_NVRAM_PROFILE;
    U8 prof_type_l4c = DATA_ACCT_CSD_PROF;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_DataAccount_Display.disp_primary)
    {
        cbm_get_profile_info_by_account_id(g_DataAccount_Display.primary_id, &profile_type, &bearer_type, &profile_id);
        sim_id = g_DataAccount_Display.primary_sim;
    }
    else if (g_DataAccount_Display.is_fallback_bearer)
    {
        cbm_get_profile_info_by_account_id(g_DataAccount_Display.secondary_id, &profile_type, &bearer_type, &profile_id);
        sim_id = g_DataAccount_Display.secondary_sim;
    }
    else /* something wrong */
    {
        DisplayPopup((PU8)GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
    }

    /* call cbm checking function firstly */
    if (!(bearer_type == ABM_E_SOCKET_BEARER_GSM_CSD
        #ifdef __MMI_GPRS_FEATURES__
            || bearer_type == ABM_E_SOCKET_BEARER_GSM_GPRS
        #endif /* __MMI_GPRS_FEATURES__ */
        ))
    {
        /* Invalid bearer */
        DisplayPopup((PU8)GetString(STR_ID_DTCNT_NO_AVAIABLE_ACCT), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
    }
    else if (!(sim_id == CBM_SIM_ID_SIM1
        #ifdef __MMI_DUAL_SIM_MASTER__
            || sim_id == CBM_SIM_ID_SIM2
        #endif /* __MMI_DUAL_SIM_MASTER__ */
        ))
    {
        /* Invalid SIM */
        DisplayPopup((PU8)GetString(STR_ID_DTCNT_NO_AVAIABLE_ACCT), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
    }
    else if (bearer_type == ABM_E_SOCKET_BEARER_GSM_CSD && profile_id > MAX_DATA_ACCOUNT_GSM_LIMIT)
    {
        /* Invalid CSD account id */
        DisplayPopup((PU8)GetString(STR_ID_DTCNT_NO_AVAIABLE_ACCT), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
    }
#ifdef __MMI_GPRS_FEATURES__
    else if (bearer_type == ABM_E_SOCKET_BEARER_GSM_GPRS && profile_id > MAX_DATA_ACCOUNT_GPRS_LIMIT)
    {
        /* Invalid GPRS account id */
        DisplayPopup((PU8)GetString(STR_ID_DTCNT_NO_AVAIABLE_ACCT), IMG_GLOBAL_WARNING, 1, DATA_ACCOUNT_NOTIFY_TIMEOUT, ERROR_TONE);
    }
#endif /* __MMI_GPRS_FEATURES__ */
    else
    {
        if (profile_type == CBM_NVRAM_PROFILE)
        {
            if (bearer_type == ABM_E_SOCKET_BEARER_GSM_CSD)
            {
                prof_type_l4c = DATA_ACCT_CSD_PROF;
            }
        #ifdef __MMI_GPRS_FEATURES__
            else if (bearer_type == ABM_E_SOCKET_BEARER_GSM_GPRS)
            {
                prof_type_l4c = DATA_ACCT_GPRS_PROF;
            }
        #endif /* __MMI_GPRS_FEATURES__ */
        }
    #ifdef __MMI_SIM_PROVISIONING_SUPPORT__
        else if (profile_type == CBM_SPA_PROFILE)
        {
            prof_type_l4c = DATA_ACCT_SPA_PROF;
        }
    #endif /* __MMI_SIM_PROVISIONING_SUPPORT__ */
        mmi_dtcnt_show_an_account_req(bearer_type, prof_type_l4c, sim_id, profile_id);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_dtcnt_account_view
 * DESCRIPTION
 *  Display the detail info of any GPRS/CSD account by U32 account id.
 * PARAMETERS
 *  acct_id     [in]    data account id
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_dtcnt_account_view(U32 acct_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cbm_account_info_struct* acct_info = OslMalloc(sizeof(cbm_account_info_struct));
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_DataAccount_Display.is_fallback_bearer = MMI_FALSE;
    
    cbm_decode_data_account_id_ext(acct_id, acct_info);
    g_DataAccount_Display.primary_id = acct_info->account[0].account_id;
    g_DataAccount_Display.primary_sim = acct_info->account[0].sim_id;
    g_DataAccount_Display.disp_primary = MMI_TRUE;
#ifdef __MMI_CBM_BEARER_FALLBACK__
    if (acct_info->acct_num > 1)
    {
        g_DataAccount_Display.is_fallback_bearer = MMI_TRUE;
        g_DataAccount_Display.secondary_id = acct_info->account[1].account_id;
        g_DataAccount_Display.secondary_sim= acct_info->account[1].sim_id;
    }
#endif /* __MMI_CBM_BEARER_FALLBACK__ */
    OslMfree(acct_info);
    mmi_dtcnt_display_one_acct();
}
#endif /* __TCPIP__ */ 

