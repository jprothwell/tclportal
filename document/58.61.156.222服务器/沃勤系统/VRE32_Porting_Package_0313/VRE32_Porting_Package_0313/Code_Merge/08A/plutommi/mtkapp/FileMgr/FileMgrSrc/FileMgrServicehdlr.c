/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE.
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/
/*****************************************************************************
 *
 * Filename:
 * ---------
 *
 *
 * Project:
 * --------
 *  MAUI
 *
 * Description:
 * ------------
 *
 *
 * Author:
 * -------
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
/****************************************************************************
* Include Files                                                                
*****************************************************************************/
#include "MMI_include.h"

#include "CommonScreens.h"
#include "ProtocolEvents.h"

/* Temprary */
#include "drm_def.h"
#include "FileMgrGProt.h"
#include "FileMgrServicehdlr.h"
#include "FileMgrServiceResDef.h"
#include "fmt_struct.h"

#if defined(__MMI_FILE_MANAGER__)

#include "SimDetectionGprot.h"
#include "ProfileGprots.h"
#include "Wapadp.h"
#include "Drm_gprot.h"
#include "ImageViewerGprot.h"
#include "PhotoEditorGProt.h"
#include "PictBridgeGProt.h"
#include "PhoneSetupGprots.h"
#ifdef __MMI_AUDIO_PLAYER__
#include "mdi_datatype.h"
#include "AudioPlayerProt.h"
#include "AudioPlayerDef.h"
#endif 
#ifdef __MMI_VIDEO_PLAYER__
#include "VdoPlyGProt.h"
#endif
#ifdef __MMI_MESSAGES_EMS__
#include "MessagesExDcl.h"
#endif
/* Bluetooth sending API revise */
#ifdef __MMI_BT_SEND_SUPPORT__
#include "BTMMIOBEXGprots.h"
#endif
#ifdef __CERTMAN_SUPPORT__
#include "CertManMMIGprots.h"
#endif
#ifdef __MMI_MMS_BGSR_SUPPORT__
#include "MMSBGSRGProt.h"
#endif
#ifdef __MMI_PROFILE_EXTMELODY_SUPPORT__
#include "ProfileMgrGProt.h"
#endif
#ifdef __MMI_SWFLASH__
#include "SWFlashGProt.h"
#include "SWFlashResDef.h"
#endif
#ifdef __MMI_IRDA_SUPPORT__
#include "IrdaMMIGProts.h"
#endif
#include "mdi_datatype.h"
#include "mdi_video.h"      // for mmi_fmgr_util_file_limit_check()
#include "CallSetupEnumResDef.h"

#include "RightsMgrGProt.h"

#include "vCard.h"
#include "vCalendar.h"
#include "vBookmark.h"

#ifdef __MMI_MY_FAVORITE__
/* under construction !*/
#endif

#ifdef __SYNCML_SUPPORT__
#include "SyncMLResDef.h"
#include "SyncMLGprot.h"
#endif

#ifdef __J2ME__
#include "JavaAgencyGProt.h"
#include "Jma_interface.h"
#include "Jvm_adaptor.h"
#include "jam_internal.h"
#endif
#ifdef __MMI_OP11_MMS_SEND_TO_PHOTO_BLOG__
#ifdef __MMI_MMS_2__
/* under construction !*/
#endif
#endif

#include "PhoneBookGprot.h"
#include "BGSoundGProt.h"
#include "EbookGprot.h"

#include "MMIThemes.h"
#include "UnifiedMessageGProt.h"
#include "UnifiedComposerGProt.h"
#include "BrowserGprots.h"
#include "ThemeManager.h"
#include "SMSApi.h"
#include "EmailAppGProt.h"
#include "Wapadp.h"

#include "Mmsadp.h"

#ifdef __MMI_DOWNLOADABLE_THEMES_SUPPORT__
#include "FunAndGamesResdef.h"
#endif
#endif

#ifdef __MMI_LANGLN__
#include "LangLnCommon.h"
#endif

#include "MMI_features_camera.h"
/* Vogins Start */
#ifdef __VRE30_AM__
#include "AMGprot.h"
#endif
/* Vogins End */

/****************************************************************************
* Define
*****************************************************************************/

/* 
 * size     : Kbyte
 * width    : pixel  
 * height   : pixel     
 */
#define IMG_BMP_LIMIT_ITEM(size,width,height)   GDI_IMAGE_TYPE_BMP_FILE,size,width,height
#define IMG_JPG_LIMIT_ITEM(size,width,height)   GDI_IMAGE_TYPE_JPG_FILE,size,width,height
#define IMG_GIF_LIMIT_ITEM(size,width,height)   GDI_IMAGE_TYPE_GIF_FILE,size,width,height
#define IMG_WBMP_LIMIT_ITEM(size,width,height)  GDI_IMAGE_TYPE_WBMP_FILE,size,width,height
#define IMG_PNG_LIMIT_ITEM(size,width,height)   GDI_IMAGE_TYPE_PNG_FILE,size,width,height
#define IMG_M3D_LIMIT_ITEM(size,width,height)   GDI_IMAGE_TYPE_M3D_FILE,size,width,height

#ifdef SVG12_SUPPORT
    #define IMG_SVG_LIMIT_ITEM(size,width,height)   GDI_IMAGE_TYPE_SVG_FILE,0,0,0
#else
    #define IMG_SVG_LIMIT_ITEM(size,width,height)   GDI_IMAGE_TYPE_SVG_FILE,size,width,height
#endif

/* 
 * size     : Kbyte
 * duration : sec       
 * width    : pixel  
 * height   : pixel     
 */
#define VDO_3GP_LIMIT_ITEM(size,duration,width,height)      GDI_IMAGE_TYPE_3GP_FILE,size,duration,width,height
#define VDO_MP4_LIMIT_ITEM(size,duration,width,height)      GDI_IMAGE_TYPE_MP4_FILE,size,duration,width,height
#define VDO_AVI_LIMIT_ITEM(size,duration,width,height)      GDI_IMAGE_TYPE_AVI_FILE,size,duration,width,height
#define VDO_SWFLASH_LIMIT_ITEM(size,duration,width,height)  GDI_IMAGE_TYPE_SWFLASH_FILE,size,duration,width,height

#define END_LIMIT_ITEM     GDI_IMAGE_TYPE_INVALID


/****************************************************************************
* Global Variable
*****************************************************************************/


/****************************************************************************
* Static Variable
*****************************************************************************/

const S32 g_fmgr_image_viewer_limit_arry[] = 
{
#if defined(MT6225)
    IMG_JPG_LIMIT_ITEM(1230, 0, 0),
    IMG_WBMP_LIMIT_ITEM(1536, 2048, 2048),
    IMG_BMP_LIMIT_ITEM(6656, 0, 0),
    IMG_GIF_LIMIT_ITEM(0, 1280, 1280),
    IMG_PNG_LIMIT_ITEM(0, 640, 480),
    IMG_SVG_LIMIT_ITEM(0, 0, 0),
    IMG_M3D_LIMIT_ITEM(200, 0, 0),
#elif defined(MT6226) || defined(MT6226M) || defined(MT6227) || defined(MT6227D)
    IMG_JPG_LIMIT_ITEM(2253, 0, 0),
    IMG_WBMP_LIMIT_ITEM(1536, 2048, 2048),
    IMG_BMP_LIMIT_ITEM(1230, 0, 0),
    IMG_GIF_LIMIT_ITEM(0, 640, 640),
    IMG_PNG_LIMIT_ITEM(0, 480, 320),
    IMG_SVG_LIMIT_ITEM(0, 0, 0),
    IMG_M3D_LIMIT_ITEM(200, 0, 0),
#elif defined(MT6228) || defined(MT6229) || defined(MT6230) || defined(MT6235) || defined(MT6235B) || defined(MT6238) || defined(MT6239)
    IMG_JPG_LIMIT_ITEM(3175, 0, 0),
    IMG_WBMP_LIMIT_ITEM(1536, 2048, 2048),
    IMG_BMP_LIMIT_ITEM(16384, 0, 0),
    IMG_GIF_LIMIT_ITEM(0, 1280, 1280),
    IMG_PNG_LIMIT_ITEM(0, 1024, 768),
    IMG_SVG_LIMIT_ITEM(125, 0, 0),
    IMG_M3D_LIMIT_ITEM(200, 0, 0),
#else
    IMG_JPG_LIMIT_ITEM(0, 0, 0),
    IMG_WBMP_LIMIT_ITEM(512, 1536, 1536),
    IMG_BMP_LIMIT_ITEM(512, 1536, 1536),
    IMG_GIF_LIMIT_ITEM(0, 640, 640),
    IMG_PNG_LIMIT_ITEM(0, 0, 0),
    IMG_SVG_LIMIT_ITEM(200,0,0),
    IMG_M3D_LIMIT_ITEM(200,0,0),
#endif
    END_LIMIT_ITEM
};

const S32 g_fmgr_wallpaper_limit_arry[] = 
{
#if defined(MT6225)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(256, 0, 0),
    IMG_GIF_LIMIT_ITEM(256, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#elif defined(MT6226) || defined(MT6226M) || defined(MT6227) || defined(MT6227D)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(384, 0, 0),
    IMG_GIF_LIMIT_ITEM(384, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#elif defined(MT6228) || defined(MT6229) || defined(MT6230) || defined(MT6235) || defined(MT6235B) || defined(MT6238) || defined(MT6239)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(896, 0, 0),
    IMG_GIF_LIMIT_ITEM(896, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#else
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(128, 0, 0),
    IMG_GIF_LIMIT_ITEM(128, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#endif
    END_LIMIT_ITEM
};

#ifdef __MMI_SUB_WALLPAPER__
const S32 g_fmgr_sub_wallpaper_limit_arry[] = 
{
#if defined(MT6225)
    IMG_BMP_LIMIT_ITEM(0, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_JPG_LIMIT_ITEM(128, 0, 0),
    IMG_GIF_LIMIT_ITEM(128, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#elif defined(MT6226) || defined(MT6226M) || defined(MT6227) || defined(MT6227D)
    IMG_BMP_LIMIT_ITEM(0, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_JPG_LIMIT_ITEM(384, 0, 0),
    IMG_GIF_LIMIT_ITEM(384, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#elif defined(MT6228) || defined(MT6229) || defined(MT6230) || defined(MT6235) || defined(MT6235B) || defined(MT6238) || defined(MT6239)
    IMG_BMP_LIMIT_ITEM(0, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_JPG_LIMIT_ITEM(896, 0, 0),
    IMG_GIF_LIMIT_ITEM(896, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#else
    IMG_BMP_LIMIT_ITEM(0, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_JPG_LIMIT_ITEM(128, 0, 0),
    IMG_GIF_LIMIT_ITEM(128, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, SUBLCD_WIDTH, SUBLCD_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#endif
    END_LIMIT_ITEM
};
#endif /* __MMI_SUB_WALLPAPER__ */ 

const S32 g_fmgr_screensaver_limit_arry[] = 
{
#if defined(MT6225)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(256, 0, 0),
    IMG_GIF_LIMIT_ITEM(256, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#elif defined(MT6226) || defined(MT6226M) || defined(MT6227) || defined(MT6227D)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(512, 0, 0),
    IMG_GIF_LIMIT_ITEM(512, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#elif defined(MT6228) || defined(MT6229) || defined(MT6230) || defined(MT6235) || defined(MT6235B) || defined(MT6238) || defined(MT6239)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(1024, 0, 0),
    IMG_GIF_LIMIT_ITEM(1024, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#else
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(128, 0, 0),
    IMG_GIF_LIMIT_ITEM(128, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#endif
    END_LIMIT_ITEM
};

const S32 g_fmgr_power_on_off_disp_limit_arry[] = 
{
#if defined(MT6225)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(128, 0, 0),
    IMG_GIF_LIMIT_ITEM(128, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#elif defined(MT6226) || defined(MT6226M) || defined(MT6227) || defined(MT6227D)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(256, 0, 0),
    IMG_GIF_LIMIT_ITEM(256, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#elif defined(MT6228) || defined(MT6229) || defined(MT6230) || defined(MT6235) || defined(MT6235B) || defined(MT6238) || defined(MT6239)
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(512, 0, 0),
    IMG_GIF_LIMIT_ITEM(512, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#else
    IMG_BMP_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_JPG_LIMIT_ITEM(128, 0, 0),
    IMG_GIF_LIMIT_ITEM(128, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_PNG_LIMIT_ITEM(0, UI_DEVICE_WIDTH, UI_DEVICE_HEIGHT),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(20,0,0),
#endif
    END_LIMIT_ITEM
};


#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_SUB_WALLPAPER__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_SUB_WALLPAPER__ */ 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* 0 */

const S32 g_fmgr_caller_picture_limit_arry[] = 
{
    IMG_BMP_LIMIT_ITEM(20, 0, 0),
    IMG_JPG_LIMIT_ITEM(20, 0, 0),
    IMG_GIF_LIMIT_ITEM(20, 0, 0),
    IMG_PNG_LIMIT_ITEM(20, 0, 0),
    IMG_PNG_LIMIT_ITEM(20, 0, 0),    
    IMG_M3D_LIMIT_ITEM(100, 0, 0),
    IMG_SVG_LIMIT_ITEM(20, 0, 0),
    END_LIMIT_ITEM
};

const S32 g_fmgr_caller_video_limit_arry[] = 
{
    VDO_3GP_LIMIT_ITEM(50000, 0, 0, 0),
    VDO_MP4_LIMIT_ITEM(50000, 0, 0, 0),
    VDO_AVI_LIMIT_ITEM(50000, 0, 0, 0),
    VDO_SWFLASH_LIMIT_ITEM(50000, 0, 0, 0),
    END_LIMIT_ITEM
};

const S32 g_fmgr_mms_category_limit_arry[] = 
{
    IMG_JPG_LIMIT_ITEM(0, 2048, 2048),
    IMG_WBMP_LIMIT_ITEM(512, 1536, 1536),
    IMG_BMP_LIMIT_ITEM(512, 1536, 1536),
    IMG_GIF_LIMIT_ITEM(0, 640, 640),
    IMG_PNG_LIMIT_ITEM(0, 640, 640),
    IMG_SVG_LIMIT_ITEM(20,0,0),
    IMG_M3D_LIMIT_ITEM(200,0,0),
    END_LIMIT_ITEM
};

#ifdef __MMI_LANGLN__
extern void mmi_langln_card_plug_out_hdlr(void);
#endif

#if defined(__MMI_FILE_MANAGER__)

/****************************************************************************
* Function Forward Declaration
*****************************************************************************/
void entry_fmgr_request_rights_confirm(void);

#define END_OF_FUNCTION_DECLARATION
/****************************************************************************
* Function Body
*****************************************************************************/
#ifdef __DRM_SUPPORT__

static void _fmgr_check_drm_rights_callback(MMI_BOOL result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(result)
    {
        mmi_fmgr_close_option_screen();
    }
}

static BOOL _fmgr_check_drm_rights(S8* filepath, U8 drm_permission, U16 icon_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return mmi_rmgr_check_rights_full_procedure((kal_wchar*)filepath, 0, (kal_uint8)drm_permission, icon_id, _fmgr_check_drm_rights_callback);
}
#endif

static BOOL fmgr_is_network_services_available(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifdef __MMI_DUAL_SIM_SINGLE_CALL__
    E_MTPNP_AD_SIMCARD_USABLE_SIDE state;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_DUAL_SIM_SINGLE_CALL__
    state = MTPNP_AD_Get_UsableSide();
    if(state == MTPNP_AD_SIMCARD1_USABLE ||
        state == MTPNP_AD_SIMCARD2_USABLE ||
        state == MTPNP_AD_DUALSIM_USABLE)
    {
        return TRUE;
    }
#ifdef __MMI_WLAN_FEATURES__
    if (mmi_netset_get_active_preferred_mode() > 0)
    {
        return TRUE;
    }
#endif 
    return FALSE;

#else /* __MMI_DUAL_SIM_SINGLE_CALL__ */

    return mmi_bootup_is_network_service_available();

#endif /* __MMI_DUAL_SIM_SINGLE_CALL__ */
}

#define FORWARD_HANDLER

void mmi_fmgr_forward_2d_media_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* Disable in 2 case:
     * 1. file is EMS/ANM
     * 2. no Idle screen
     */
    if(
#ifdef __MMI_MESSAGES_EMS__
        FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_EMS) ||
        FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_ANM) ||
#endif
        !IsScreenPresent(IDLE_SCREEN_ID)
       )
    {
        mmi_frm_hide_menu_item(menu_id);
        return;
    }

#ifdef __MMI_SUB_WALLPAPER__		
    if(menu_id == MENU_ID_FMGR_FWD_SUB_WALLPAPER)
    {
#ifdef M3D_MMI_SUPPORT
        if(FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_M3D))
        {
            mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_SUB_WALLPAPER);
            return;
        }
#endif    
    }
#endif    
}

static void mmi_fmgr_to_wallpaper_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    PhnsetWallpaperForwardFromFmgr(filepath, &info.file_type, info.is_short);
    mmi_fmgr_close_option_screen();
}

void mmi_fmgr_highlight_to_wallpaper(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_wallpaper_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_wallpaper_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_wallpaper_hdlr);
#endif 
}

#ifdef __MMI_SUB_WALLPAPER__		
static void mmi_fmgr_to_sub_wallpaper_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    PhnsetSubWallpaperForwardFromFmgr(filepath, &info.file_type, info.is_short);
    mmi_fmgr_close_option_screen();    
}

void mmi_fmgr_highlight_to_sub_wallpaper(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_sub_wallpaper_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_sub_wallpaper_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_sub_wallpaper_hdlr);
#endif 
}
#endif

static void mmi_fmgr_to_screensaver_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    PhnsetScrSvrForwardFromFmgr(filepath, &info.file_type, info.is_short);
    mmi_fmgr_close_option_screen();    
}

void mmi_fmgr_highlight_to_screensaver(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_screensaver_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_screensaver_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_screensaver_hdlr);
#endif 
}

#ifdef __MMI_POWER_ON_OFF_DISPLAY__
static void mmi_fmgr_to_power_on_display_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    PhnsetPwrOnOffForwardFromFmgr(filepath, &info.file_type, TRUE, info.is_short);
    mmi_fmgr_close_option_screen();    
}

void mmi_fmgr_highlight_to_power_on_display(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_power_on_display_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_power_on_display_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_power_on_display_hdlr);
#endif 
}

static void mmi_fmgr_to_power_off_display_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    PhnsetPwrOnOffForwardFromFmgr(filepath, &info.file_type, FALSE, info.is_short);
    mmi_fmgr_close_option_screen();    
}

void mmi_fmgr_highlight_to_power_off_display(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_power_off_display_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_power_off_display_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_power_off_display_hdlr);
#endif 
}
#endif

void mmi_fmgr_forward_phb_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* Disable in 1 case:
     * 1. file is EMS/ANM
     */
#ifdef __MMI_MESSAGES_EMS__
    if (FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_EMS) ||
        FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_ANM))
    {
        mmi_frm_hide_menu_item(menu_id);
        return;
    }
#endif

#ifndef SVG12_SUPPORT
    if (FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_SVG))
    {
        mmi_frm_hide_menu_item(menu_id);
        return;
    }
#endif
}

static void mmi_fmgr_to_phb_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
#ifdef __MMI_VCARD__
    if (FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_VCF))
    {
    #ifdef __SYNCML_SUPPORT__
        if (mmi_syncml_is_phb_sync_now())
        {
            DisplayPopup((U8*) GetString(STR_ID_SYNC_CODE_FORBIDDEN), IMG_GLOBAL_INFO, 0, 1000, WARNING_TONE);
            return;
        }
    #endif
        mmi_vcard_recv_from_file_mgr(filepath);
    }
    else
#endif
    {
        mmi_phb_fmgr_from_file_mgr(filepath);
    }
    mmi_fmgr_close_option_screen();
}

void mmi_fmgr_highlight_to_phb(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_phb_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_phb_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_phb_hdlr);
#endif 
}

#ifdef __MMI_PROFILE_EXTMELODY_SUPPORT__
static void mmi_fmgr_to_profile_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    PmgSetShortFileName(info.is_short);    /* let PMGR know whether it's short filename */
    PmgFmgrAddExtMelodyFunc(filepath);
    mmi_fmgr_close_option_screen();    
}

void mmi_fmgr_highlight_to_profile(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_profile_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_profile_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_profile_hdlr);
#endif 
}
#endif

#ifdef __MMI_BG_SOUND_EFFECT__		
void mmi_fmgr_forward_bgsound_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_WAV) ||
        !fmgr_is_network_services_available()
#ifdef __FLIGHT_MODE_SUPPORT__
        || mmi_bootup_get_active_flight_mode() != 0
#endif 
        )
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_BGSOUND);
        return;
    }
}

static void mmi_fmgr_to_bgsound_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    mmi_bgsnd_fmgr_from_file_mgr(filepath, info.is_short);
    mmi_fmgr_close_option_screen();    
}

void mmi_fmgr_highlight_to_bgsound(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_bgsound_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_bgsound_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_bgsound_hdlr);
#endif 
}
#endif

#ifdef __MMI_VCALENDAR__
static void mmi_fmgr_to_todolist_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);

#ifdef __SYNCML_SUPPORT__
    if (FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_VCS) && mmi_syncml_is_tdl_sync_now())
    {
        DisplayPopup((U8*) GetString(STR_ID_SYNC_CODE_FORBIDDEN), IMG_GLOBAL_INFO, 0, 1000, WARNING_TONE);
        return;
    }
#endif

    mmi_vclndr_fmgr_recv(filepath);
    mmi_fmgr_close_option_screen();
}

void mmi_fmgr_highlight_to_todolist(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_todolist_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_todolist_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_todolist_hdlr);
#endif 
}
#endif

#if !defined (__MMI_MESSAGES_NO_SEND_BY_SMS_OPTION__)
void mmi_fmgr_forward_sms_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 app_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (mmi_frm_sms_is_hide_send_sms_menu_item())
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_SMS);
        return;
    }

    mmi_fmgr_get_current_fileinfo(NULL, &app_id);
    if (app_id == APP_DOWNLOADAGENT)
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_SMS);
        return;
    }
    
}

static void mmi_fmgr_to_sms_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);

#ifdef __MMI_VCARD__
    if (FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_VCF))
    {
        EntryNewScreen(SCR_ID_FMGR_FORWARD_DUMMY, NULL, NULL, NULL);
        mmi_vcard_fmgr_sms_forward(filepath);
        mmi_fmgr_close_option_screen();        
        return;
    }
#endif
#ifdef __MMI_VCALENDAR__
    if (FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_VCS))
    {
        EntryNewScreen(SCR_ID_FMGR_FORWARD_DUMMY, NULL, NULL, NULL);
        mmi_vclndr_fmgr_sms_forward(filepath);
        mmi_fmgr_close_option_screen();        
        return;
    }
#endif
#ifdef __MMI_VBOOKMARK__
    if (FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_URL) || 
        FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_VBM))
    {
        EntryNewScreen(SCR_ID_FMGR_FORWARD_DUMMY, NULL, NULL, NULL);
        mmi_vbkm_fmgr_sms_forward(filepath);
        mmi_fmgr_close_option_screen();                
        return;
    }
#endif
}

void mmi_fmgr_highlight_to_sms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_sms_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_sms_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_sms_hdlr);
#endif 
}
#endif

#if (defined( __MMI_MESSAGES_EMS__) && !defined (__MMI_FMGR_NO_FWD_SMS__))
void mmi_fmgr_forward_ems_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 app_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    /*  Only enable when file is IMY/EMS/ANM and have SIM
     */
    if ((!FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_IMY) &&
         !FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_EMS) &&
         !FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_ANM)) ||
        !mmi_bootup_is_sim_valid())
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_EMS);
        return;
    }

#if defined(__MMI_UNIFIED_COMPOSER__)
    // TODO: if defined UC, always hide this option??
    
    /* ??? Hide it if file is IMY/EMS/ANM */
    if (FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_IMY) ||
        FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_EMS) ||
        FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_ANM))
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_EMS);
        return;
    }
#endif

    mmi_fmgr_get_current_fileinfo(NULL, &app_id);
    if (app_id == APP_DOWNLOADAGENT)
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_EMS);
        return;
    }

}

static void mmi_fmgr_to_ems_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    if (FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_IMY))
    {
        mmi_ems_fm_send_by_ems(filepath, EMS_OBJECT_MY_MELODY_STATE);
    }
    else if (FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_ANM))
    {
        mmi_ems_fm_send_by_ems(filepath, EMS_OBJECT_MY_ANIMATION_STATE);
    }
    else if (FMGR_FILTER_IS_SET(&info.file_type, FMGR_TYPE_EMS))
    {
        mmi_ems_fm_send_by_ems(filepath, EMS_OBJECT_MY_PICTURE_STATE);
    }
    else
    {
        DisplayPopup((PU8) GetString(STR_FMGR_INVALID_EMS_FORMAT), IMG_GLOBAL_ERROR, 0, 1000, ERROR_TONE);
    }
    mmi_fmgr_close_option_screen();        
}

void mmi_fmgr_highlight_to_ems(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_ems_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_ems_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_ems_hdlr);
#endif 
}
#endif

#ifdef __MMI_MMS__
void mmi_fmgr_forward_mms_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8* filepath;
    U16 app_id;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    filepath = mmi_fmgr_get_current_fileinfo(NULL, &app_id);
    filepath = mmi_fmgr_util_extract_filename(filepath);
    
    if (mms_is_content_forward((char*)filepath) == MMI_FALSE)
    {
#ifdef __MMI_MMS_2__
#ifdef __MMI_OP11_MMS_SEND_TO_PHOTO_BLOG__
/* under construction !*/
#endif
#endif
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_MMS);
        return;
    }
    
    if (app_id == APP_DOWNLOADAGENT ||
        mmi_fmgr_is_file_in_archive(fileinfo))
    {
#ifdef __MMI_MMS_2__
#ifdef __MMI_OP11_MMS_SEND_TO_PHOTO_BLOG__
/* under construction !*/
#endif
#endif
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_MMS);
        return;
    }
}

static void mmi_fmgr_to_mms_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    mms_content_insert_hdlr(mmi_fmgr_get_current_fileinfo(NULL, NULL));
    mmi_fmgr_close_option_screen();        
}

void mmi_fmgr_highlight_to_mms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_mms_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_mms_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_mms_hdlr);
#endif 
}
#endif

#ifdef __MMI_MMS_2__
#ifdef __MMI_OP11_MMS_SEND_TO_PHOTO_BLOG__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_TOUCH_SCREEN__
/* under construction !*/
#endif 
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
#endif
#ifdef __MMI_EMAIL__
void mmi_fmgr_forward_email_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 app_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(!fmgr_is_network_services_available() ||
        mmi_bootup_get_active_flight_mode())
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_EMAIL);
        return;
    }

    mmi_fmgr_get_current_fileinfo(NULL, &app_id);
    if (app_id == APP_DOWNLOADAGENT)
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FWD_EMAIL);
        return;
    }
}

static void mmi_fmgr_to_email_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    mmi_email_fmgr_send(filepath, info.is_short);
    mmi_fmgr_close_option_screen();            
}

void mmi_fmgr_highlight_to_email(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_email_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_email_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_email_hdlr);
#endif 
}
#endif

void mmi_fmgr_forward_peripheral_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 app_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __FLIGHT_MODE_SUPPORT__
    if(mmi_bootup_get_active_flight_mode())
    {
        mmi_frm_hide_menu_item(menu_id);
        return;
    }
#endif

    mmi_fmgr_get_current_fileinfo(NULL, &app_id);
    if (app_id == APP_DOWNLOADAGENT ||
        mmi_fmgr_is_file_in_archive(fileinfo))
    {
        mmi_frm_hide_menu_item(menu_id);
        return;
    }
}

#ifdef __MMI_IRDA_SUPPORT__
static void mmi_fmgr_to_irda_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);
    if (MMI_IRDA_ERR_SUCCESS == mmi_irda_send_file_obj(filepath, mmi_irda_fmgr_forward_to_irda_callback))
    {
        mmi_irda_entry_fmgr_fwd();
    }
    mmi_fmgr_close_option_screen();            
}

void mmi_fmgr_highlight_to_irda(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_irda_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_irda_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_irda_hdlr);
#endif 
}
#endif
/* Bluetooth sending API revise */
#ifdef __MMI_BT_SEND_SUPPORT__
static void mmi_fmgr_to_bt_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    FMGR_FILE_INFO_STRUCT   info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&info, NULL);

    {
        btsend_obj_struct obj;
        btsend_app_struct app;
    
        memset(&obj, 0, sizeof(obj));
        memset(&app, 0, sizeof(app));
    
        obj.data.obj_type = BTSEND_USE_FILE;
        obj.data.u.file.path = (U16 *)filepath;
        obj.data.u.file.is_sfn = info.is_short;
    
        app.id = APP_FILEMANAGER;

#ifdef __MMI_BT_AUTO_PROMPT_SWITCH__    
        mmi_bt_send_object(&obj, &app, BTSEND_PROF_ALL, BTSEND_OPT_DEFAULT_DEVICE);
#else
        mmi_bt_send_object(&obj, &app, BTSEND_PROF_ALL, BTSEND_OPT_NORMAL);
#endif
    }
#if 0
/* under construction !*/
#endif

    mmi_fmgr_close_option_screen();        
}

void mmi_fmgr_highlight_to_bt(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_to_bt_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_to_bt_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_to_bt_hdlr);
#endif 
}
#endif /* __MMI_BT_SEND_SUPPORT__ */

#define FILE_HANDLER

void mmi_fmgr_option_img_print_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_fmgr_filetype_enum type;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    type = mmi_fmgr_get_main_filetype(&(fileinfo->file_type));
    /* handle PRINT_PICTBRIDGE / PRINT_BLUETOOTH */

#if defined(__MMI_PICT_BRIDGE_SUPPORT__)
    /* PRINT_PICTBRIDGE 
     */
    if (!mmi_imgview_is_image_type_printable(type, MMI_IMGVIEW_PRINT_PICTBRIDGE) ||
        mmi_fmgr_is_file_in_archive(fileinfo))
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_PRINT_PICTBRIGE);
    }
#endif

#if defined(__MMI_BPP_SUPPORT__)
    /* PRINT_BLUETOOTH 
     *  only support when not in Flight mode
     */
    if (mmi_bootup_get_active_flight_mode() ||
        !mmi_imgview_is_image_type_printable(type, MMI_IMGVIEW_PRINT_BPP) ||
        mmi_fmgr_is_file_in_archive(fileinfo))
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_PRINT_BLUETOOTH);
    }    
#endif
    
}

void mmi_fmgr_option_image_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    BOOL    is_drm = FALSE;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* handle PRINT/JPG_DETAIL/EDIT */

    /* check DRM */
#ifdef __DRM_SUPPORT__
    if(DRM_METHOD_NONE != DRM_get_object_method(0, (kal_wchar*)mmi_fmgr_get_current_fileinfo(NULL, NULL)))
    {
        is_drm = TRUE;
    }
#endif
    
#ifdef __MMI_PHOTOEDITOR__
    /* EDIT 
     *  only support non-DRM JPG files
     */
    if(is_drm || (!FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_JPG) && !FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_JPEG)))
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_IMG_OPTION_EDIT);
    }
#endif
    
    /* JPG_DETAIL 
     *  only support JPG files and when EXIF is defined.
     */
#if defined(__MMI_EXIF__)
    if((!FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_JPG) && !FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_JPEG)) ||
        mmi_fmgr_is_file_in_archive(fileinfo))
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_IMG_OPTION_JPG_DETAIL);
    }
#else
    mmi_frm_hide_menu_item(MENU_ID_FMGR_IMG_OPTION_JPG_DETAIL);
#endif

#if defined(__MMI_BPP_SUPPORT__) || defined(__MMI_PICT_BRIDGE_SUPPORT__)
    /* PRINT 
     *  
     */
    mmi_fmgr_reset_menu_set(MENU_ID_FMGR_IMG_OPTION_PRINT);
    mmi_fmgr_option_img_print_enabler(MENU_ID_FMGR_IMG_OPTION_PRINT, fileinfo);
    if(0 == GetNumOfChild_Ext(MENU_ID_FMGR_IMG_OPTION_PRINT))
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_IMG_OPTION_PRINT);
    }
#endif

}

void mmi_fmgr_option_imgviewer_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    BOOL    is_drm = FALSE;
   
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* check DRM */
#ifdef __DRM_SUPPORT__
    if(DRM_METHOD_NONE != DRM_get_object_method(0, (kal_wchar*)mmi_fmgr_get_current_fileinfo(NULL, NULL)))
    {
        is_drm = TRUE;
    }
#endif
    
#ifdef __MMI_PHOTOEDITOR__
    /* EDIT 
     *  only support non-DRM JPG files
     */
    if(is_drm || (!FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_JPG) && !FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_JPEG)))
    {
        mmi_frm_hide_menu_item(MENU_ID_IMGVIEW_ENTRY_PHOTOEDITOR);
    }
#endif


    if(fileinfo->attribute & FS_ATTR_DIR)
    {
        mmi_frm_hide_menu_item(MENU_ID_IMGVIEW_VIEW_DETAIL);
        mmi_frm_hide_menu_item(MENU_ID_FMGR_IMG_OPTION_JPG_DETAIL);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_FOLDER_OPEN);
    }
    mmi_frm_hide_menu_item(MENU_ID_FMGR_GEN_OPTION_DETAIL);

    /* JPG_DETAIL 
     *  only support JPG files and when EXIF is defined.
     */
#if defined(__MMI_EXIF__)
    if((!FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_JPG) && !FMGR_FILTER_IS_SET(&fileinfo->file_type, FMGR_TYPE_JPEG)) ||
        mmi_fmgr_is_file_in_archive(fileinfo))
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_IMG_OPTION_JPG_DETAIL);
    }
#else
    mmi_frm_hide_menu_item(MENU_ID_FMGR_IMG_OPTION_JPG_DETAIL);
#endif

#if defined(__MMI_BPP_SUPPORT__) || defined(__MMI_PICT_BRIDGE_SUPPORT__)
    /* PRINT 
     *  
     */
    mmi_fmgr_reset_menu_set(MENU_ID_FMGR_IMG_OPTION_PRINT);
    mmi_fmgr_option_img_print_enabler(MENU_ID_FMGR_IMG_OPTION_PRINT, fileinfo);
    if(0 == GetNumOfChild_Ext(MENU_ID_FMGR_IMG_OPTION_PRINT))
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_IMG_OPTION_PRINT);
    }
#endif
}


#if defined(__MMI_BROWSER_2__)
void mmi_fmgr_option_bookmark_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* handle OPEN */
    
    if (!fmgr_is_network_services_available() ||
        mmi_bootup_get_active_flight_mode() )
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_BOOKMARK_FILE_OPEN);
    }  
}
#endif

#ifdef __MMI_VBOOKMARK__ 
void mmi_fmgr_option_vbookmark_enabler(U16 menu_id, const FMGR_FILE_INFO_STRUCT* fileinfo)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!fmgr_is_network_services_available() ||
        mmi_bootup_get_active_flight_mode() )
    {
        mmi_frm_hide_menu_item(MENU_ID_FMGR_VBOOKMARK_OPTION_GOTO);
        mmi_frm_hide_menu_item(MENU_ID_FMGR_VBOOKMARK_OPTION_OPEN);
    }
}
#endif

/****************************************************************************
 *  Image
 */
static void mmi_fmgr_image_view_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;

    U16                     app_id;
    U16                     icon_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, &app_id);

    mmi_fmgr_get_app_title_info(app_id, NULL, &icon_id, filepath);
#ifdef __DRM_SUPPORT__
    if(!_fmgr_check_drm_rights(filepath, DRM_PERMISSION_DISPLAY, icon_id))
    {
        return;
    }
#endif 
    mmi_imgview_view_image_hdlr(filepath, file_info.is_short, file_info.file_type, icon_id);

    mmi_fmgr_close_option_screen();        
    
}

void mmi_fmgr_highlight_image_view(void)
{
    SetKeyHandler(mmi_fmgr_image_view_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_image_view_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_image_view_hdlr);
#endif 
}

#ifdef __MMI_PHOTOEDITOR__
static void mmi_fmgr_image_edit_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, NULL);

    mmi_phoart_entry_from_fmgr(filepath, file_info.is_short);

    mmi_fmgr_close_option_screen();            
}

void mmi_fmgr_highlight_image_edit(void)
{
    SetKeyHandler(mmi_fmgr_image_edit_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_image_edit_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_image_edit_hdlr);
#endif 
}
#endif /* __MMI_PHOTOEDITOR__ */

#if defined(__MMI_EXIF__)

static S8* g_fmgr_image_jpg_detail_filepath = NULL;
static U16 g_fmgr_image_jpg_detail_icon = 0;

static S32 mmi_fmgr_image_jpg_detail_print_buffer(gdi_image_jpeg_exif_info_struct* exif_info, S8* buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      UCS2_buf[128];
    S32                     length, count = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#define PRINT_EXIF_INFO(__a__,__A__)                          \
    do{                                                           \
        length = strlen((PS8)exif_info->##__a__##);                 \
        if(length)                                               \
        {                                                          \
            mmi_ucs2cat(buffer, (PS8)GetString(##__A__##)); \
            mmi_ucs2cat (buffer, (PS8)L":\n");              \
            mmi_asc_to_ucs2(UCS2_buf,(PS8)exif_info->##__a__##);\
            mmi_ucs2cat (buffer,(PS8)UCS2_buf);             \
            mmi_ucs2cat (buffer, (PS8)L"\n");               \
            count++;                                                \
        }                                                          \
   }while(0);

#ifdef __MMI_EXIF_MAKE__
    PRINT_EXIF_INFO(make, STR_ID_FMGR_EXIF_MAKE);
#endif 
#ifdef __MMI_EXIF_MODEL__
    PRINT_EXIF_INFO(model, STR_ID_FMGR_EXIF_MODEL);
#endif 
#ifdef __MMI_EXIF_ORIENTATION__
    PRINT_EXIF_INFO(orientation, STR_ID_FMGR_EXIF_ORIENTATION);
#endif 
#ifdef __MMI_EXIF_X_RESOLUTION__
    PRINT_EXIF_INFO(x_resolution, STR_ID_FMGR_EXIF_X_RESOLUTION);
#endif 
#ifdef __MMI_EXIF_Y_RESOLUTION__
    PRINT_EXIF_INFO(y_resolution, STR_ID_FMGR_EXIF_Y_RESOLUTION);
#endif 
#ifdef __MMI_EXIF_RESOLUTION_UNIT__
    PRINT_EXIF_INFO(resolution_unit, STR_ID_FMGR_EXIF_RESOLUTION_UNIT);
#endif 
#ifdef __MMI_EXIF_SOFTWARE__
    PRINT_EXIF_INFO(software, STR_ID_FMGR_EXIF_SOFTWARE);
#endif 
#ifdef __MMI_EXIF_DATE_TIME__
    PRINT_EXIF_INFO(date_time, STR_ID_FMGR_EXIF_DATE_TIME);
#endif 
#ifdef __MMI_EXIF_YCBCR_POSITIONING__
    PRINT_EXIF_INFO(ycbcr_positioning, STR_ID_FMGR_EXIF_YCBCR_POSITIONING);
#endif 
#ifdef __MMI_EXIF_EXIF_IFD__
    PRINT_EXIF_INFO(exif_ifd, STR_ID_FMGR_EXIF_EXIF_IFD);
#endif 
#ifdef __MMI_EXIF_EXPOSURE_TIME__
    PRINT_EXIF_INFO(exposure_time, STR_ID_FMGR_EXIF_EXPOSURE_TIME);
#endif 
#ifdef __MMI_EXIF_FNUMBER__
    PRINT_EXIF_INFO(fnumber, STR_ID_FMGR_EXIF_FNUMBER);
#endif 
#ifdef __MMI_EXIF_EXPOSURE_PROGRAM__
    PRINT_EXIF_INFO(exposure_program, STR_ID_FMGR_EXIF_EXPOSURE_PROGRAM);
#endif 
#ifdef __MMI_EXIF_ISO_SPEED_RATINGS__
    PRINT_EXIF_INFO(iso_speed_ratings, STR_ID_FMGR_EXIF_ISO_SPEED_RATINGS);
#endif 
#ifdef __MMI_EXIF_EXIF_VERSION__
    PRINT_EXIF_INFO(exif_version, STR_ID_FMGR_EXIF_EXIF_VERSION);
#endif 
#ifdef __MMI_EXIF_DATE_TIME_ORIGINAL__
    PRINT_EXIF_INFO(date_time_original, STR_ID_FMGR_EXIF_DATE_TIME_ORIGINAL);
#endif 
#ifdef __MMI_EXIF_DATE_TIME_DIGITIZED__
    PRINT_EXIF_INFO(date_time_digitized, STR_ID_FMGR_EXIF_DATE_TIME_DIGITIZED);
#endif 
#ifdef __MMI_EXIF_COMPONENTS_CONFIG__
    PRINT_EXIF_INFO(components_config, STR_ID_FMGR_EXIF_COMPONENTS_CONFIG);
#endif 
#ifdef __MMI_EXIF_EXPOSURE_BIAS_VALUE__
    PRINT_EXIF_INFO(exposure_bias_value, STR_ID_FMGR_EXIF_EXPOSURE_BIAS_VALUE);
#endif 
#ifdef __MMI_EXIF_METERING_MODE__
    PRINT_EXIF_INFO(metering_mode, STR_ID_FMGR_EXIF_METERING_MODE);
#endif 
#ifdef __MMI_EXIF_LIGHT_SOURCE__
    PRINT_EXIF_INFO(light_source, STR_ID_FMGR_EXIF_LIGHT_SOURCE);
#endif 
#ifdef __MMI_EXIF_FLASH__
    PRINT_EXIF_INFO(flash, STR_ID_FMGR_EXIF_FLASH);
#endif 
#ifdef __MMI_EXIF_MAKER_NOTE__
    PRINT_EXIF_INFO(maker_note, STR_ID_FMGR_EXIF_MAKER_NOTE);
#endif 
#ifdef __MMI_EXIF_FLASHPIX_VERSION__
    PRINT_EXIF_INFO(flashpix_version, STR_ID_FMGR_EXIF_FLASHPIX_VERSION);
#endif 
#ifdef __MMI_EXIF_COLOR_SPACE__
    PRINT_EXIF_INFO(color_space, STR_ID_FMGR_EXIF_COLOR_SPACE);
#endif 
#ifdef __MMI_EXIF_PIXEL_X_DIMENSION__
    PRINT_EXIF_INFO(pixel_x_dimension, STR_ID_FMGR_EXIF_PIXEL_X_DIMENSION);
#endif 
#ifdef __MMI_EXIF_PIXEL_Y_DIMENSION__
    PRINT_EXIF_INFO(pixel_y_dimension, STR_ID_FMGR_EXIF_PIXEL_Y_DIMENSION);
#endif 
#ifdef __MMI_EXIF_EXPOSURE_MODE__
    PRINT_EXIF_INFO(exposure_mode, STR_ID_FMGR_EXIF_EXPOSURE_MODE);
#endif 
#ifdef __MMI_EXIF_DIGITAL_ZOOM_RATIO__
    PRINT_EXIF_INFO(digital_zoom_ratio, STR_ID_FMGR_EXIF_DIGITAL_ZOOM_RATIO);
#endif 
#ifdef __MMI_EXIF_SCENE_CAPTURE_TYPE__
    PRINT_EXIF_INFO(scene_capture_type, STR_ID_FMGR_EXIF_SCENE_CAPTURE_TYPE);
#endif 

    return count;
}

static void mmi_fmgr_image_exit_jpg_detail(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    extern void mmi_fmgr_image_entry_jpg_detail(void);
    history currHistory;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* When exit, copy filepath into inputBuffer */
    if(!CheckIsBackHistory())
    {
        ASSERT(g_fmgr_image_jpg_detail_filepath);
        currHistory.scrnID = SCR_ID_FMGR_JPG_DETAIL;
        *((U16*)currHistory.inputBuffer) = (g_fmgr_image_jpg_detail_icon + 1);
        mmi_ucs2cpy(((S8*)currHistory.inputBuffer + 2), g_fmgr_image_jpg_detail_filepath);
        currHistory.entryFuncPtr = mmi_fmgr_image_entry_jpg_detail;
        GetCategoryHistory(currHistory.guiBuffer);
        AddHistory(currHistory);
    }
    OslMfree(g_fmgr_image_jpg_detail_filepath);
    g_fmgr_image_jpg_detail_filepath = NULL;
}

static void mmi_fmgr_image_entry_jpg_detail(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32                     length;
    U8                      *guiBuffer;
    gdi_image_jpeg_exif_info_struct exif_info;
    GDI_RESULT              result = GDI_SUCCEED;
    S16                     count = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if(CheckIsBackHistory())
    {
        /* load filepath from input buffer */
        ASSERT(!g_fmgr_image_jpg_detail_filepath);
        length = mmi_ucs2strlen(((S8*)GetCurrInputBuffer(SCR_ID_FMGR_JPG_DETAIL))+2);
        ASSERT(length);
        g_fmgr_image_jpg_detail_filepath = OslMalloc((length+1)*2);
        mmi_ucs2cpy(g_fmgr_image_jpg_detail_filepath, ((S8*)GetCurrInputBuffer(SCR_ID_FMGR_JPG_DETAIL))+2);
        g_fmgr_image_jpg_detail_icon = (U16)(*((U16*)GetCurrInputBuffer(SCR_ID_FMGR_JPG_DETAIL))-1);
    }

    mmi_ucs2cpy((PS8) subMenuData, (PS8) L"");
    result = gdi_image_jpeg_get_exif_info(g_fmgr_image_jpg_detail_filepath, &exif_info);

    if (result != GDI_FAILED)
    {
        count = mmi_fmgr_image_jpg_detail_print_buffer(&exif_info, (S8*)subMenuData);
    }

    if (count == 0)
    {
        mmi_ucs2cat((PS8) subMenuData, (PS8) GetString(STR_ID_FMGR_EXIF_NO_INFORMATION));
    }

    EntryNewScreen(SCR_ID_FMGR_JPG_DETAIL, mmi_fmgr_image_exit_jpg_detail, NULL, NULL);

    guiBuffer = GetCurrGuiBuffer(SCR_ID_FMGR_JPG_DETAIL);

    ShowCategory74Screen(
        STR_FMGR_VIEW_IMG_JPG_DETAIL,
        g_fmgr_image_jpg_detail_icon,
        0,
        0,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        (PU8) subMenuData,
        MAX_SUB_MENUS * MAX_SUB_MENU_SIZE,
        guiBuffer);

    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}

static void mmi_fmgr_image_jpg_detail_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    U16                     app_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, &app_id);

    // Copy string
    ASSERT(!g_fmgr_image_jpg_detail_filepath);
    g_fmgr_image_jpg_detail_filepath = OslMalloc((mmi_ucs2strlen(filepath)+1)*2);
    mmi_ucs2cpy(g_fmgr_image_jpg_detail_filepath, filepath);
    mmi_fmgr_get_app_title_info(app_id, NULL, &g_fmgr_image_jpg_detail_icon, filepath);
        
    mmi_fmgr_image_entry_jpg_detail();
    mmi_fmgr_close_option_screen();        
    
}

void mmi_fmgr_highlight_image_jpg_detail(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_image_jpg_detail_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_image_jpg_detail_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_image_jpg_detail_hdlr);
#endif 
}
#endif /* defined(__MMI_EXIF__) */ 

#if defined(__MMI_PICT_BRIDGE_SUPPORT__) || defined(__MMI_BPP_SUPPORT__)

static S8* g_fmgr_image_print_filepath = NULL;
static U16 g_fmgr_image_print_icon_id = 0;

static void mmi_fmgr_image_exit_print_option(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    extern void mmi_fmgr_image_entry_print_option(void);
    history currHistory;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /* When exit, copy filepath into inputBuffer */
    if(!CheckIsBackHistory())
    {
        ASSERT(g_fmgr_image_print_filepath);
        currHistory.scrnID = SCR_FMGR_PRINT_OPTION;
        mmi_ucs2cpy((S8*)currHistory.inputBuffer+2, g_fmgr_image_print_filepath);
        *((U16*)currHistory.inputBuffer) = g_fmgr_image_print_icon_id+1;
        currHistory.entryFuncPtr = mmi_fmgr_image_entry_print_option;
        GetCategoryHistory(currHistory.guiBuffer);
        AddHistory(currHistory);
    }
    OslMfree(g_fmgr_image_print_filepath);
    g_fmgr_image_print_filepath = NULL;
}

static void mmi_fmgr_image_entry_print_option(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    U16                     icon_id;
    FS_HANDLE               handle;

    U16                     nNumofItem;
    U8                      *guiBuffer;
    U16                     nStrItemList[20];
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if(CheckIsBackHistory())
    {
        /* load filepath from input buffer */
        ASSERT(!g_fmgr_image_print_filepath);
        g_fmgr_image_print_filepath = OslMalloc((mmi_ucs2strlen((S8*)GetCurrInputBuffer(SCR_FMGR_PRINT_OPTION))+1)*2);
        mmi_ucs2cpy(g_fmgr_image_print_filepath, (S8*)GetCurrInputBuffer(SCR_FMGR_PRINT_OPTION)+2);
        g_fmgr_image_print_icon_id = (U16)(*((U16*)GetCurrInputBuffer(SCR_FMGR_PRINT_OPTION)) - 1);
    }
    else
    {
        ASSERT(g_fmgr_image_print_filepath);
    }
    
    filepath = g_fmgr_image_print_filepath;
    icon_id = g_fmgr_image_print_icon_id;
    handle = mmi_fmgr_get_file_info_by_path(filepath, &file_info);
    if(handle < 0)
    {
        /* FS error */
        DisplayPopup((PU8) GetString(GetFileSystemErrorString(handle)), IMG_GLOBAL_ERROR, 0, 1000, ERROR_TONE);
        goto print_error;
    }

#ifdef __DRM_SUPPORT__
    if(!_fmgr_check_drm_rights(filepath, DRM_PERMISSION_PRINT, icon_id))
    {
        goto print_error;
    }
#endif /* __DRM_SUPPORT__ */ 

    /* enabler logic */
    mmi_fmgr_reset_menu_set(MENU_ID_FMGR_IMG_OPTION_PRINT);
    mmi_fmgr_option_img_print_enabler(MENU_ID_FMGR_IMG_OPTION_PRINT, &file_info);
    nNumofItem = GetNumOfChild_Ext(MENU_ID_FMGR_IMG_OPTION_PRINT);
    if (nNumofItem == 0)
    {
        DisplayPopup((U8*) GetString(STR_FMGR_INVALID_FORMAT), IMG_GLOBAL_WARNING, 0, 1000, WARNING_TONE);
        goto print_error;
    }

    EntryNewScreen(SCR_FMGR_PRINT_OPTION, mmi_fmgr_image_exit_print_option, NULL, NULL);

    guiBuffer = GetCurrGuiBuffer(SCR_FMGR_PRINT_OPTION);

    SetParentHandler(MENU_ID_FMGR_IMG_OPTION_PRINT);
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    GetSequenceStringIds_Ext(MENU_ID_FMGR_IMG_OPTION_PRINT, nStrItemList);

    ShowCategory15Screen(
        STR_ID_FMGR_PRINT,
        icon_id,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (U16*) gIndexIconsImageList,
        1,
        0,
        guiBuffer);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    return;

print_error:
    if(g_fmgr_image_print_filepath)
    {
        OslMfree(g_fmgr_image_print_filepath);
        g_fmgr_image_print_filepath = NULL;
    }
}

void mmi_fmgr_image_print_by_imgviewer(S8* filepath, U16 icon_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    // Copy string
    ASSERT(!g_fmgr_image_print_filepath);
    g_fmgr_image_print_filepath = OslMalloc((mmi_ucs2strlen(filepath)+1)*2);
    mmi_ucs2cpy(g_fmgr_image_print_filepath, filepath);

    g_fmgr_image_print_icon_id = icon_id;

    mmi_fmgr_image_entry_print_option();
}

static void mmi_fmgr_image_print_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8* filepath;
    U16 app_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    filepath = mmi_fmgr_get_current_fileinfo(NULL, &app_id);

    // Copy string
    ASSERT(!g_fmgr_image_print_filepath);
    g_fmgr_image_print_filepath = OslMalloc((mmi_ucs2strlen(filepath)+1)*2);
    mmi_ucs2cpy(g_fmgr_image_print_filepath, filepath);

    mmi_fmgr_get_app_title_info(app_id, NULL, &g_fmgr_image_print_icon_id, filepath);
    mmi_fmgr_image_entry_print_option();
//    mmi_fmgr_set_option_link(SCR_FMGR_PRINT_OPTION);
}

void mmi_fmgr_highlight_image_print(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_image_print_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_image_print_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_image_print_hdlr);
#endif 
}

#ifdef __MMI_PICT_BRIDGE_SUPPORT__
static void mmi_fmgr_image_print_to_pictbridge(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    filepath = g_fmgr_image_print_filepath;
    mmi_fmgr_get_file_info_by_path(filepath, &file_info);
    
    mmi_pict_print_file_forward_from_fmgr(filepath, &file_info.file_type, (int)file_info.is_short);
    
    mmi_fmgr_close_option_screen();
    DeleteScreenIfPresent(SCR_FMGR_PRINT_OPTION);
}

void mmi_fmgr_highlight_image_print_to_pictbridge(void)
{
    SetLeftSoftkeyFunction(mmi_fmgr_image_print_to_pictbridge, KEY_EVENT_UP);
}
#endif

#ifdef __MMI_BPP_SUPPORT__
static void mmi_fmgr_image_print_to_bluetooth(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    filepath = g_fmgr_image_print_filepath;
    mmi_fmgr_get_file_info_by_path(filepath, &file_info);
    
    mmi_imgview_bpp_print_file (filepath, file_info.is_short);
    
    mmi_fmgr_close_option_screen();
    DeleteScreenIfPresent(SCR_FMGR_PRINT_OPTION);
}

void mmi_fmgr_highlight_image_print_to_bluetooth(void)
{
    SetLeftSoftkeyFunction(mmi_fmgr_image_print_to_bluetooth, KEY_EVENT_UP);
}
#endif

#endif /* defined(__MMI_PICT_BRIDGE_SUPPORT__) || defined(__MMI_BPP_SUPPORT__) */

/****************************************************************************
 *  Audio
 */
static void mmi_fmgr_audio_play_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    U16                     app_id, icon_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, &app_id);

    mmi_fmgr_get_app_title_info(app_id, NULL, &icon_id, filepath);
#ifdef __DRM_SUPPORT__
    if(!_fmgr_check_drm_rights(filepath, DRM_PERMISSION_PLAY, icon_id))
    {
        return;
    }
#endif
    mmi_audply_single_play((U16*)filepath, NULL, icon_id);

    mmi_fmgr_close_option_screen();            
    
}

void mmi_fmgr_highlight_audio_play(void)
{
    SetKeyHandler(mmi_fmgr_audio_play_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_audio_play_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_audio_play_hdlr);
#endif 
}

/****************************************************************************
 *  Video
 */
#ifdef __MMI_VIDEO_PLAYER__
static void mmi_fmgr_video_play_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    U16                     app_id, icon_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, &app_id);
    mmi_fmgr_get_app_title_info(app_id, NULL, &icon_id, filepath);

#ifdef __DRM_SUPPORT__
    if(!_fmgr_check_drm_rights(filepath, DRM_PERMISSION_PLAY, icon_id))
    {
        return;
    }
#endif

#ifdef __MMI_VIDEO_STREAM__  
    if (FMGR_FILTER_IS_SET(&file_info.file_type, FMGR_TYPE_SDP))
    {
        mmi_vdoply_entry_player_screen_from_sdp_file(filepath, file_info.is_short); 
    }
    else if (FMGR_FILTER_IS_SET(&file_info.file_type, FMGR_TYPE_RAM))
    {
        mmi_vdoply_entry_player_screen_from_ram_file(filepath, file_info.is_short);        
    }
    else /* other video type */
    {
        mmi_vdoply_entry_player_screen_from_file(filepath, file_info.is_short);
    }
#else
    mmi_vdoply_entry_player_screen_from_file(filepath, file_info.is_short);
#endif /* __MMI_VIDEO_STREAM__ */  

    mmi_fmgr_close_option_screen();        

}

void mmi_fmgr_highlight_video_play(void)
{
    SetKeyHandler(mmi_fmgr_video_play_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_video_play_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_video_play_hdlr);
#endif 
}
#endif /* __MMI_VIDEO_PLAYER__ */

#ifdef __J2ME__
/****************************************************************************
 *  Java
 */
static void mmi_fmgr_java_execute_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    U16                     app_id, icon_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, &app_id);
    mmi_fmgr_get_app_title_info(app_id, NULL, &icon_id, filepath);

#ifdef __DRM_SUPPORT__
    if(!_fmgr_check_drm_rights(filepath, DRM_PERMISSION_EXECUTE, icon_id))
    {
        return;
    }
#endif 

    mmi_java_local_install_content_routing((kal_uint16*) filepath);

    mmi_fmgr_close_option_screen();        
}

void mmi_fmgr_highlight_java_execute(void)
{
    SetKeyHandler(mmi_fmgr_java_execute_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_java_execute_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_java_execute_hdlr);
#endif 
}
#endif    

#ifdef __MMI_DOWNLOADABLE_THEMES_SUPPORT__
/****************************************************************************
 *  Downloadable Theme
 */

static S8* g_dlt_filepath = NULL;

// TODO: add notify handler for theme delete.

tm_theme_type_enum dlt_get_path_location(S8* path)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8  buf_UCS2[FMGR_PATH_BUFFER_SIZE];
    S16 len;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if(MMI_CARD_DRV)
    {
        kal_wsprintf((WCHAR*)buf_UCS2, "%c:\\%w", MMI_CARD_DRV, FMGR_DEFAULT_FOLDER_THEMES);
        len = mmi_ucs2strlen(buf_UCS2);

        if(mmi_ucs2nicmp(buf_UCS2, path, len) == 0)
            return THEME_TYPE_DOWNLOADED_CARD;
    }

    kal_wsprintf((WCHAR*)buf_UCS2, "%c:\\%w", MMI_PUBLIC_DRV, FMGR_DEFAULT_FOLDER_THEMES);
    len = mmi_ucs2strlen(buf_UCS2);

    if(mmi_ucs2nicmp(buf_UCS2, path, len) == 0)
        return THEME_TYPE_DOWNLOADED_PHONE;
    
    return 0;
}


static tm_theme_type_enum dlt_activate_from_fmgr(PS8 path, PS8 filename , MMI_BOOL is_short)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    tm_theme_type_enum  flag;
    tm_theme_error_enum status;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    flag = dlt_get_path_location(path);

    status = mmi_tm_activate_theme_from_fmgr(flag, (PU8) filename, is_short);
	/*
	 *	WenWu, Start. Update auto-update theme order after active.
	 */
	if (status == 0) /* theme success */
	{
		mmi_thm_activate_update_thm_order();
	}
	/*
	 * WenWu, End
	 */
	 
    if(flag)
        mmi_tm_handle_theme_activation_error_status((U16) status);

    return flag;
}


static void dlt_move_theme_file(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT file_info;
    S32 fs_result, len;
    S8 *new_path = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(g_dlt_filepath);
    
    /* check file if present */
    fs_result = mmi_fmgr_get_file_info_by_path(g_dlt_filepath, &file_info);
    if(fs_result < 0)
        goto fs_error;
    
    /* compose folder path, create dir */
    len = 3 + mmi_ucs2strlen((S8*)FMGR_DEFAULT_FOLDER_THEMES) + mmi_ucs2strlen(file_info.file_name) + 1;
    
    new_path = OslMalloc(len * ENCODING_LENGTH);
    mmi_ucs2ncpy(new_path, g_dlt_filepath, 3);
    mmi_ucs2cat(new_path, (S8*)FMGR_DEFAULT_FOLDER_THEMES);

    fs_result = mmi_fmgr_util_create_folder(new_path);
    if(fs_result < 0)
        goto fs_error;

    mmi_ucs2cat(new_path, (S8*)file_info.file_name);
	fs_result = FS_Open((WCHAR*)new_path, FS_CREATE_ALWAYS | FS_READ_WRITE);
	if (fs_result < 0)
	{
		fs_result = DRM_RESULT_FILE_EXISTS;
		goto fs_error;
	}
	else
	{
		FS_Close(fs_result);
        FS_Delete((WCHAR*)new_path);
	}
		
    fs_result = FS_Move((WCHAR*)g_dlt_filepath, (WCHAR*)new_path, FS_MOVE_KILL, NULL, NULL, 0);
    if(fs_result < 0)
        goto fs_error;
	
    mmi_fmgr_util_remove_last_dir(new_path);
    dlt_activate_from_fmgr(new_path, (PS8) file_info.file_name, file_info.is_short);
    
fs_error:
    if(new_path)
        OslMfree(new_path);
    if(fs_result < 0)
    {
        DisplayPopup((PU8) GetString(mmi_fmgr_util_get_fs_error_string(fs_result)),
                    IMG_GLOBAL_ERROR, 0, 1000, ERROR_TONE);
    }
    OslMfree(g_dlt_filepath);
    g_dlt_filepath = NULL;
}

static void dlt_display_theme_popup(S8* filepath)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 len;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if(g_dlt_filepath)
        OslMfree(g_dlt_filepath);
    len = mmi_ucs2strlen(filepath);
    g_dlt_filepath = OslMalloc((len+1)*ENCODING_LENGTH);
    mmi_ucs2cpy(g_dlt_filepath, filepath);
    
    DisplayConfirm(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        get_string(STR_ID_FMGR_THEME_INCORRECT_LOCATION),
        IMG_GLOBAL_QUESTION,
        WARNING_TONE);

    SetLeftSoftkeyFunction(dlt_move_theme_file, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

    mmi_fmgr_close_option_screen();
}

static void mmi_fmgr_theme_activate_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	/*
	 *	WenWu, Start, Add progress screen for activation
	 */
    EntryNewScreen(0, NULL, NULL, NULL);
    ShowCategory66Screen(
        STR_FMGR_THEME_OPTION,
        GetRootTitleIcon(MENU3101_THEMES),
        0,
        0,
        0,
        0,
        (PU8) GetString(STR_ID_DLT_THM_PROGRESS),
        IMG_GLOBAL_PROGRESS,
        NULL);
	/*
	 *	WenWu, End
	 */
    filepath = mmi_fmgr_get_current_fileinfo(&file_info, NULL);
    if(dlt_activate_from_fmgr(filepath, (PS8) file_info.file_name, file_info.is_short) == 0)
	{
		dlt_display_theme_popup(filepath);
	}
      
    mmi_fmgr_close_option_screen();        
}

void mmi_fmgr_highlight_theme_activate(void)
{
    SetKeyHandler(mmi_fmgr_theme_activate_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_theme_activate_hdlr, KEY_EVENT_UP);
}
#endif /* __MMI_DOWNLOADABLE_THEMES_SUPPORT__ */

#ifdef __MMI_EBOOK_READER__
/****************************************************************************
 *  Ebook
 */
/*****************************************************************************
 * FUNCTION
 *  fmgr_open_ebook_hdlr
 * DESCRIPTION
 *  Open book
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_fmgr_ebook_open_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    S8                      *folder;
    S32                     len;
    U16                     app_id;
	U16                     icon_id;
	BOOL                is_entry_from_myfavor = FALSE;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, &app_id);
#ifdef __MMI_MY_FAVORITE__
/* under construction !*/
/* under construction !*/
#endif
	
	mmi_fmgr_get_app_title_info(app_id, NULL, &icon_id, filepath);

    len = mmi_ucs2strlen(filepath);
    folder = OslMalloc((len+1)*ENCODING_LENGTH);
    mmi_ucs2cpy(folder, filepath);
    mmi_fmgr_util_remove_last_dir(folder);

    ebr_frm_open_book_from_file_manager((S8*)file_info.file_name,
                                        (S8*)folder,
                                        icon_id,
                                        file_info.is_short,
                                        is_entry_from_myfavor);
    OslMfree(folder);

    mmi_fmgr_close_option_screen();        
    
}

void mmi_fmgr_highlight_ebook_open(void)
{
    SetKeyHandler(mmi_fmgr_ebook_open_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_ebook_open_hdlr, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(mmi_fmgr_ebook_open_hdlr);
#endif 
}
#endif /* __MMI_EBOOK_READER__ */ 
/* Vogins Start */
#if defined(__VRE__)

void vm_open_vre_exec_file(void)
{
    FMGR_FILE_INFO_STRUCT file_info;
    S8 *filepath_p;
   
    filepath_p = mmi_fmgr_get_current_fileinfo (&file_info,0);

   #ifdef __VRE30_AM__
    mmi_am_start_from_fm((PU16)filepath_p);
#else
    vm_open_vre_exec_file_callback((VMWSTR)filepath_p, (VMINT)file_info.is_short);
#endif

    mmi_fmgr_close_option_screen();    
}

void mmi_fmgr_highlight_vre_open(void)
{
    SetKeyHandler(vm_open_vre_exec_file, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(vm_open_vre_exec_file, KEY_EVENT_UP);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_register_list_item_selected_callback(vm_open_vre_exec_file);
#endif 
}

extern int mmi_vre_pre_format_hdlr(char drv);
BOOL mmi_fmgr_vre_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 drv;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    #ifdef __VRE30_AM__    
    case MMI_FMGR_NOTIFY_DRV_POST_MOUNT:
        mmi_am_card_plug_in_hdlr();
        break;
    #endif         

    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        mmi_vre_card_plug_out_hdlr();
		#ifdef __VRE30_AM__
        mmi_am_card_plug_out_hdlr();
        #endif
        break;
    case MMI_FMGR_NOTIFY_DRV_PRE_FORMAT:
        #ifdef __VRE_V30__
    	drv = *((S8*)para);
		return mmi_vre_pre_format_hdlr(drv);
        #endif
		break;
    }
    return TRUE;
}

#endif
/* Vogins End */
#if defined(__MMI_BROWSER_2__)
/****************************************************************************
 *  Bookmark
 */
/*****************************************************************************
 * FUNCTION
 *  fmgr_goto_bookmark_hdlr
 * DESCRIPTION
 *  Open book
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_fmgr_bookmark_goto_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, NULL);
    mmi_brw_open_file_from_fmgr(filepath, file_info.is_short);

    mmi_fmgr_close_option_screen();            
}

void mmi_fmgr_highlight_bookmark_goto(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(mmi_fmgr_bookmark_goto_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_bookmark_goto_hdlr, KEY_EVENT_UP);
}

#endif /* (__MMI_BROWSER_2__) */

#ifdef __MMI_SWFLASH__      
/*****************************************************************************
 * FUNCTION
 *  fmgr_play_swflash_hdlr
 * DESCRIPTION
 *  get the file full path and play swflash works
  * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_fmgr_swflash_play_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(NULL, NULL);

    mmi_swflash_set_file_full_path(filepath, NULL);
    mmi_swflash_option_play_entry_screen();

    mmi_fmgr_close_option_screen();            
}


/*****************************************************************************
 * FUNCTION
 *  fmgr_download_swflash_hdlr
 * DESCRIPTION
 * get the file full path and resume download
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_fmgr_swflash_download_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(NULL, NULL);

    mmi_swflash_set_file_full_path(filepath, NULL);
    
    mmi_swflash_dl_continue_confirm();
//    mmi_swflash_option_download();     

    mmi_fmgr_close_option_screen();            
}


/*****************************************************************************
 * FUNCTION
 *  fmgr_info_swflash_hdlr
 * DESCRIPTION
 *  get the file full path and view its attribute
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_fmgr_swflash_info_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8                      *filepath;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(NULL, NULL);

    mmi_swflash_set_file_full_path(filepath, NULL);
    mmi_swflash_option_info_entry_screen();

    mmi_fmgr_close_option_screen();            
}

void mmi_fmgr_highlight_swflash_info(void)
{
    SetKeyHandler(mmi_fmgr_swflash_info_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_swflash_info_hdlr, KEY_EVENT_UP);
}

void mmi_fmgr_highlight_swflash_play(void)
{
    SetKeyHandler(mmi_fmgr_swflash_play_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_swflash_play_hdlr, KEY_EVENT_UP);
}

void mmi_fmgr_highlight_swflash_download(void)
{
    SetKeyHandler(mmi_fmgr_swflash_download_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_swflash_download_hdlr, KEY_EVENT_UP);
}

#endif /* __MMI_SWFLASH__ */ 

#ifdef __MMI_VBOOKMARK__
/*****************************************************************************
 * FUNCTION
 *  fmgr_vbookmark_goto_hdlr
 * DESCRIPTION
 *  Open book
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_fmgr_vbookmark_goto_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, NULL);
    mmi_brw_bookmarks_goto_from_fmgr(filepath, file_info.is_short);

    /* brw will close option later */
    // mmi_fmgr_close_option_screen();            
}


/*****************************************************************************
 * FUNCTION
 *  fmgr_vbookmark_open_hdlr
 * DESCRIPTION
 *  Open book
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_fmgr_vbookmark_open_hdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    FMGR_FILE_INFO_STRUCT   file_info;
    S8                      *filepath;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    filepath = mmi_fmgr_get_current_fileinfo(&file_info, NULL);

    mmi_brw_bookmarks_open_from_fmgr(filepath, file_info.is_short);

    /* brw will close option later */
    // mmi_fmgr_close_option_screen();            
}

void mmi_fmgr_highlight_vbookmark_goto(void)
{
    SetKeyHandler(mmi_fmgr_vbookmark_goto_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_vbookmark_goto_hdlr, KEY_EVENT_UP);
}

void mmi_fmgr_highlight_vbookmark_open(void)
{
    SetKeyHandler(mmi_fmgr_vbookmark_open_hdlr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_fmgr_vbookmark_open_hdlr, KEY_EVENT_UP);
}
#endif /* __MMI_VBOOKMARK__ */


void mmi_fmgri_service_hdlr_init(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

}

#define NOTIFY_HANDLER

#ifdef __MMI_AUDIO_PLAYER__
BOOL mmi_fmgr_audio_player_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_fmgr_notify_delete_all_info_struct  *del_info;
    mmi_fmgr_notify_path_info_struct        *paths;
    AUDPLY_UPDATE_LIST_ACTION_ENUM          action;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_PRE_FORMAT:
        mmi_audply_fmgr_notify_drv_pre_format_hdlr(*((S8*)para));
        break;
        
    case MMI_FMGR_NOTIFY_DRV_POST_FORMAT:
        mmi_audply_fmgr_notify_drv_post_format_hdlr(*((S8*)para));
        break;
        
    case MMI_FMGR_NOTIFY_DRV_POST_MOUNT:
        mmi_audply_msdc_plug_in_hdlr((BOOL)!mmi_bootup_is_in_power_on_period());
        break;
        
    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        mmi_audply_msdc_plug_out_hdlr((BOOL)!mmi_bootup_is_in_power_on_period());
        break;
       
    case MMI_FMGR_NOTIFY_POST_COPY:
    case MMI_FMGR_NOTIFY_POST_MOVE:
    case MMI_FMGR_NOTIFY_POST_DELETE:
        paths = (mmi_fmgr_notify_path_info_struct*)para;

        if(notify_flag == MMI_FMGR_NOTIFY_POST_COPY)
            action = AUDPLY_ACTION_COPY;
        else if(notify_flag == MMI_FMGR_NOTIFY_POST_MOVE)
        {
            S32 src_len, trg_len;
            trg_len = mmi_fmgr_util_get_filename_index(paths->trg_path.path) / 2;
            src_len = mmi_fmgr_util_get_filename_index(paths->src_path.path) / 2;
            if(src_len == trg_len && mmi_ucs2ncmp(paths->src_path.path, paths->trg_path.path, src_len) == 0)
                action = AUDPLY_ACTION_RENAME;
            else
                action = AUDPLY_ACTION_MOVE;
        }
        else
            action = AUDPLY_ACTION_DELETE;

        mmi_audply_update_list_hdlr(paths->src_path.path, paths->trg_path.path, (U8)action, paths->src_path.is_folder);
        break;

    case MMI_FMGR_NOTIFY_POST_DEL_ALL:
        del_info = (mmi_fmgr_notify_delete_all_info_struct*)para;
        mmi_audply_update_list_hdlr(del_info->folder_path.path, NULL, AUDPLY_ACTION_DELETE, del_info->folder_path.is_folder);
        break;
    }
    
    return TRUE;
}
#endif

#if defined(__J2ME__)
BOOL mmi_fmgr_jma_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return TRUE;
}
#endif

#if defined(__J2ME__)
BOOL mmi_fmgr_java_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_PRE_FORMAT:
        return jam_is_allow_format(*((S8*)para));
        break;
    }
    return TRUE;
}
#endif

#ifdef __MMI_BG_SOUND_EFFECT__
BOOL mmi_fmgr_bgsound_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        mmi_bgsnd_util_setup_sd_plug_out_hdlr();
        mmi_bgsnd_util_calling_sd_plug_out_hdlr();
        break;
    }
    return TRUE;
}
#endif

#if defined(__MMI_BROWSER_2__) || defined(OBIGO_Q03C)
BOOL mmi_fmgr_wap_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        #ifdef __MMI_BROWSER_2__
            mmi_brw_memory_card_plug_out_hdlr();
        #elif OBIGO_Q03C
            wap_memory_card_plug_out_hdlr();
        #endif
        break;
    }
    return TRUE;
}
#endif



#ifdef __MMI_EBOOK_READER__
BOOL mmi_fmgr_ebook_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_fmgr_notify_string_struct*      path;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_POST_DELETE:
        {
        path = (mmi_fmgr_notify_string_struct*)para;
        if(!path->is_folder)
        {
            ebr_fmgr_delete_file(path->path, 0);
        }
        
        break;
    }
	    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        {
            ebr_fmgr_unmount_delete_screen();
        }
		
    }
    return TRUE;
}
#endif

#ifdef __MMI_EMAIL__
BOOL mmi_fmgr_email_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 drv, drv_enum;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_POST_FORMAT:
        drv = *((S8*)para);
        mmi_fmgr_get_drive_enum_by_letter(drv, &drv_enum);
        if (drv_enum == FMGR_NAND_STORAGE || drv_enum == FMGR_NOR_STORAGE)
        {
            mmi_email_fmgr_reset_status_icon();
        }
        break;
    }
    return TRUE;
}
#endif

#ifdef __UNIFIED_MESSAGE_ARCHIVE_SUPPORT__
BOOL mmi_fmgr_um_archive_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_POST_FORMAT:
        mmi_frm_sms_format_archive();
        break;
    }
    return TRUE;
}
#endif

#ifdef __MMI_LANGLN__
BOOL mmi_fmgr_langln_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        mmi_langln_card_plug_out_hdlr();
        break;
    }
    return TRUE;
}
#endif

#ifdef __MMI_MMS_BGSR_SUPPORT__
BOOL mmi_fmgr_mms_bgsr_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_POST_FORMAT:
        mmi_mms_bgsr_change_msg_notify(0, MMI_MMS_BGSR_OP_FORMAT, 0, NULL);
        break;
    }
    return TRUE;
}
#endif

#ifdef __MMI_SWFLASH__
BOOL mmi_fmgr_swflash_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        mmi_swflash_card_plug_out_hdlr();
        break;
    }
    return TRUE;
}
#endif

#ifdef __MMI_THEMES_V2_SUPPORT__
BOOL mmi_fmgr_theme_v2_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_PRE_FORMAT:
        mmi_thm_activate_dflt_sys_theme();
        break;
        
    case MMI_FMGR_NOTIFY_DRV_POST_FORMAT:
        break;

    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        mmi_thm_card_plug_out_hdlr();
        break;
    }
    
    return TRUE;
}
#endif

#ifdef __MMI_DOWNLOADABLE_THEMES_SUPPORT__
BOOL mmi_fmgr_theme_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 themetype;
    S8 drv, drv_enum;
    S16 flag;
    mmi_fmgr_notify_string_struct* path;
    mmi_fmgr_notify_path_info_struct* paths;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_PRE_FORMAT:
        drv = *((S8*)para);
        mmi_fmgr_get_drive_enum_by_letter(drv, &drv_enum);

        themetype = mmi_tm_get_curr_theme_type();

        if ((themetype == THEME_TYPE_DOWNLOADED_PHONE) &&
            ((drv_enum == FMGR_NAND_STORAGE) || (drv_enum == FMGR_NOR_STORAGE)))
        {
            ActivateDefaultTheme();
        }
        else if ((themetype == THEME_TYPE_DOWNLOADED_CARD) && (drv_enum == FMGR_REMOVABLE_STORAGE))
        {
            ActivateDefaultTheme();
        }
        break;

    case MMI_FMGR_NOTIFY_PRE_COPY:
    case MMI_FMGR_NOTIFY_PRE_DELETE:
    case MMI_FMGR_NOTIFY_PRE_MOVE:
        path = (mmi_fmgr_notify_string_struct*)para;
        if(!path->is_folder)
        {
            flag = dlt_get_path_location(path->path);
            if(flag)
            {
                return mmi_tm_is_theme_activated(flag, mmi_fmgr_util_extract_filename(path->path)) ? FALSE : TRUE;
            }
        }
        break;
        
    case MMI_FMGR_NOTIFY_POST_MOVE:
        paths = (mmi_fmgr_notify_path_info_struct*)para;
        path = &(paths->src_path);
        goto theme_deleted;
        
    case MMI_FMGR_NOTIFY_POST_DELETE:
        path = (mmi_fmgr_notify_string_struct*)para;
theme_deleted:
        if(!path->is_folder)
        {
            flag = dlt_get_path_location(path->path);
            if(flag)
            {
                mmi_tm_delete_theme_from_fmgr(flag, (U8*)mmi_fmgr_util_extract_filename(path->path), NULL);
            }
        }
        break;    
        
    }
    
    return TRUE;
}
#endif


#if (defined(__MMI_UNIFIED_COMPOSER__) || defined(__MMI_MMS_STANDALONE_COMPOSER__))
BOOL mmi_fmgr_uc_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_DRV_POST_UNMOUNT:
        mmi_uc_sd_plug_out_hdlr();
        break;
    }
    
    return TRUE;
}
#endif


#if defined(__MMI_FMGR_MULTI_SELECT_SUPPORT__) && defined(__MMI_PICT_BRIDGE_SUPPORT__) && !defined(__MMI_PICT_BRIDGE_MULTI_FILE_PRINT__)
/*****************************************************************************
 * FUNCTION
 *  fmgr_main_entry_mark_print
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void fmgr_main_pict_bridge_mark_print(U8 *full_path, FMGR_FILE_INFO_STRUCT file_info, U8 total_count, U8 callback_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_pict_mark_several_for_print_callback(full_path, file_info, total_count, callback_index);
    
}

#endif /* #ifndef __MMI_PICT_BRIDGE_MULTI_FILE_PRINT__ */


#ifdef __MMI_PROFILE_EXTMELODY_SUPPORT__
BOOL mmi_fmgr_setting_notify_hdlr(U32 notify_flag, void* para)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_fmgr_notify_path_info_struct*   paths;
    mmi_fmgr_notify_string_struct*      path;
    mmi_fmgr_notify_delete_all_info_struct* del_info;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(notify_flag)
    {
    case MMI_FMGR_NOTIFY_POST_MOVE:
        paths = (mmi_fmgr_notify_path_info_struct*)para;
        path = &(paths->src_path);
        goto pmg_remove;
        break;
        
    case MMI_FMGR_NOTIFY_POST_DELETE:
        path = (mmi_fmgr_notify_string_struct*)para;
        goto pmg_remove;
        break;
        
    case MMI_FMGR_NOTIFY_POST_DEL_ALL:
        del_info = (mmi_fmgr_notify_delete_all_info_struct*)para;
        path = &(del_info->folder_path);
        goto pmg_remove;
        break;

pmg_remove:
        if(path->is_folder)
            PmgFmgrDelExtMelodyFunc(path->path, PMG_FMGR_DEL_ALL);
        else
            PmgFmgrDelExtMelodyFunc(path->path, PMG_FMGR_DEL_CERTAIN);
        break;

    case MMI_FMGR_NOTIFY_DRV_POST_FORMAT:
        {
            S8 buf[8];
            kal_wsprintf((WCHAR*)buf, "%c:\\", *((S8*)para));
            PmgFmgrDelExtMelodyFunc(buf, PMG_FMGR_DEL_ALL);
        }
        break;
    }
    
    return TRUE;
}
#endif

#define HYPERLINK_HANDLER

#if defined(__MMI_MY_FAVORITE_SWFLASH_HYPERLINK__)
BOOL mmi_swflash_hyperlink_callback(U16 app_id, S8* path, fmgr_hyperlink_action_enum action, S32 para, S32* result)
{
    extern void mmi_my_favorite_open_swflash_wap_hdlr(void);
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_fmgr_hyperlink_info_struct *info;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ASSERT(app_id == APP_MYFAVORITE);

    switch(action)
    {
    case FMGR_HYPERLINK_GET_COUNT:
        /* only show hyperlink when:
         *  1: has network service and
         *  2: not in flight mode and
         *  3: the path is on phone
         */
        if (fmgr_is_network_services_available() == TRUE && mmi_bootup_get_active_flight_mode() == 0 && path[0] == MMI_PUBLIC_DRV)
            *result = 1;
        else
            *result = 0;
        break;
        
    case FMGR_HYPERLINK_GET_INFO:
        if(para < 0 || para > 1)
            return FALSE;
        if (fmgr_is_network_services_available() != TRUE && mmi_bootup_get_active_flight_mode() != 0)
            return FALSE;
        
        info = (mmi_fmgr_hyperlink_info_struct*)result;
        info->small_icon_id = IMG_ID_MY_FAVORITE_WAP_SWFLASH;
        info->large_icon_id = IMG_ID_FMGR_FILE_TYPE_UNKNOWN;
        info->string_ptr = (S8*)GetString(STR_ID_MY_FAVORITE_WAP_SWFLASH);
        info->lsk_string_id = STR_GLOBAL_OPEN;
        info->lsk_handler = mmi_my_favorite_open_swflash_wap_hdlr;
        break;
    }
    return TRUE;
}
#endif


#endif // defined (__MMI_FILE_MANAGER__)


#define FILE_LIMIT_API

#define FILE_LIMIT_ERROR_STR_LEN    (100)
#define FILE_LIMIT_ERROR_BUF_SIZE   ((FILE_LIMIT_ERROR_STR_LEN+1)*ENCODING_LENGTH)

#define FILE_LIMIT_FALSE_RETURN(_str_id_)                       \
do{                                                             \
   mmi_ucs2ncpy(g_fmgr_file_limit_error_str,                    \
                     (PS8)(GetString(_str_id_)),                \
                     FILE_LIMIT_ERROR_STR_LEN);                 \
   g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE-1] = 0;\
   g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE-2] = 0;\
   return FALSE;                                                \
} while(0);


/*****************************************************************************
 * FUNCTION
 *  mmi_fmgr_util_file_limit_check
 * DESCRIPTION
 *  util function for some api to check file's limit
 *  to gather all api's file decode limit here
 * PARAMETERS
 *  array_ptr           [IN]        Array pointer
 *  filename            [IN]        Filename
 *  error_str_pp        [OUT]       Error string pointer's ptr
 * RETURNS
 * BOOL
 *****************************************************************************/
BOOL mmi_fmgr_util_file_limit_check(const S32 *array_ptr, PS8 filename, PS8 *error_str_pp)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    static S8 g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE];
    
    U32         file_size;
    S32         image_width, image_height, result;
    U16         res_group_type;
    FS_HANDLE   fs_handle;

    S32         *check_start_ptr;
    U16         resource_type = 0;
    S16         jump = 0;    

    S32         check_file_size, check_image_width, check_image_height;

#ifdef __MMI_VIDEO_PLAYER__
    S32         check_duration;
    PS8         ext_ptr;
    mdi_video_info_struct vdo_info;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    check_start_ptr = (PS32) array_ptr;

    /* assign buffer */
    *error_str_pp = g_fmgr_file_limit_error_str;
    memset(g_fmgr_file_limit_error_str, 0, FILE_LIMIT_ERROR_BUF_SIZE);

    if (filename == NULL)
    {
        FILE_LIMIT_FALSE_RETURN(FMGR_FS_INVALID_FILENAME_TEXT);
    }

    fs_handle = DRM_open_file((PU16) filename, FS_READ_ONLY, DRM_PERMISSION_DISPLAY);

    if (fs_handle < 0)
    {
        FILE_LIMIT_FALSE_RETURN(FMGR_FS_FILE_NOT_FOUND_TEXT);
    }

    DRM_close_file(fs_handle);

    /* source from file */
    res_group_type = mmi_fmgr_get_file_group(filename);


    if (res_group_type == FMGR_GROUP_IMAGE)
    {
        /* images */
        jump = 4;
        resource_type = gdi_image_get_type_from_file(filename);

    }
    else if (res_group_type == FMGR_GROUP_VIDEO)
    {
        /* video */
    #ifdef __MMI_VIDEO_PLAYER__

	FMGR_FILTER file_type;
        jump = 5;

	mmi_fmgr_get_file_type((PS8) filename, &file_type);

	if (FMGR_FILTER_IS_SET(&file_type, FMGR_TYPE_3GP))
        {
            resource_type = GDI_IMAGE_TYPE_3GP_FILE;
        }
        else if (FMGR_FILTER_IS_SET(&file_type, FMGR_TYPE_MP4))
        {
            resource_type = GDI_IMAGE_TYPE_MP4_FILE;
        }
	else if (FMGR_FILTER_IS_SET(&file_type, FMGR_TYPE_AVI))
        {
            resource_type = GDI_IMAGE_TYPE_AVI_FILE;
        }
	else if (FMGR_FILTER_IS_SET(&file_type, FMGR_TYPE_MPG))
        {
            resource_type = GDI_IMAGE_TYPE_MPG_FILE;
        }
	else if (FMGR_FILTER_IS_SET(&file_type, FMGR_TYPE_3G2))
        {
            resource_type = GDI_IMAGE_TYPE_3G2_FILE;
        }    
        else
        {
            FILE_LIMIT_FALSE_RETURN(STR_FMGR_INVALID_FORMAT);
        }

    #endif /* __MMI_VIDEO_PLAYER__ */ 

    }
    else
    {
        /* do not have limit */
        return TRUE;
    }

    /* check if has limit */
    while (1)
    {
        if (*check_start_ptr == resource_type)
        {
            /* find limit */
            break;
        }

        check_start_ptr += jump;
        if (*check_start_ptr == END_LIMIT_ITEM)
        {
            /* all checked, no limitation */
            return TRUE;
        }
    };

    if (res_group_type == FMGR_GROUP_IMAGE)
    {
        check_start_ptr++;
        check_file_size = *check_start_ptr++;
        check_image_width = *check_start_ptr++;
        check_image_height = *check_start_ptr;

      /*******************************************/
        /* Image size checking                     */
      /*******************************************/
        if (check_image_width!=0 || check_image_height!=0)
        {
            result = gdi_image_get_dimension_file(filename, &image_width, &image_height);

            if ((result < 0) ||
                ( image_width == 0 || image_height == 0))
            {
                if (result == GDI_IMAGE_ENCODER_ERR_MEMORY_NOT_ENOUGH)
                {
                    FILE_LIMIT_FALSE_RETURN(STR_ID_FMGR_MEMORY_NOT_ENOUGH);
                }
                else
                {
                    FILE_LIMIT_FALSE_RETURN(STR_FMGR_INVALID_FORMAT);
                }
            }

            /* checking */
            if (((check_image_width != 0) && (image_width > check_image_width)) ||
                ((check_image_height != 0) && (image_height > check_image_height)))
            {
                mmi_ucs2ncpy(
                    g_fmgr_file_limit_error_str,
                    (PS8) (GetString(STR_ID_FMGR_FILE_LIMIT_IMAGE_TOO_LARGE)),
                    FILE_LIMIT_ERROR_STR_LEN);

                /* avoid overflow - force have EOS */
                g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 1] = 0;
                g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 2] = 0;

                return FALSE;
            }
        }

      /*******************************************/
        /* Image file size checking (width/height) */
      /*******************************************/
        fs_handle = DRM_open_file((PU16) filename, FS_READ_ONLY, DRM_PERMISSION_DISPLAY);

        if (fs_handle < 0)
        {
            FILE_LIMIT_FALSE_RETURN(FMGR_FS_FILE_NOT_FOUND_TEXT);
        }
        else
        {
            DRM_file_size(fs_handle, (PU32) & file_size );

            if (file_size == 0)
            {
                DRM_close_file(fs_handle);
                FILE_LIMIT_FALSE_RETURN(STR_FMGR_INVALID_FORMAT);
            }

            DRM_close_file(fs_handle);
        }


        if ((check_file_size != 0) && (file_size > (check_file_size * 1024)))
        {

            mmi_ucs2ncpy(
                g_fmgr_file_limit_error_str,
                (PS8) (GetString(STR_ID_FMGR_FILE_LIMIT_FILE_TOO_LARGE)),
                FILE_LIMIT_ERROR_STR_LEN);

            /* avoid overflow - force have EOS */
            g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 1] = 0;
            g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 2] = 0;

            return FALSE;
        }

        /* all pass */
        return TRUE;

    }
    else if (res_group_type == FMGR_GROUP_VIDEO)
    {
        /* video */
    #ifdef __MMI_VIDEO_PLAYER__

        check_start_ptr++;
        check_file_size = *check_start_ptr++;
        check_duration = *check_start_ptr++;
        check_image_width = *check_start_ptr++;
        check_image_height = *check_start_ptr;

        ext_ptr = mmi_fmgr_extract_ext_file_name(filename);

         /*******************************************/
        /* Video file size checking                */
         /*******************************************/
        fs_handle = DRM_open_file((PU16) filename, FS_READ_ONLY, DRM_PERMISSION_PLAY);

        if (fs_handle < 0)
        {
            FILE_LIMIT_FALSE_RETURN(FMGR_FS_FILE_NOT_FOUND_TEXT);
        }
        else
        {
            DRM_file_size(fs_handle, (PU32) & file_size );

            if (file_size == 0)
            {
                DRM_close_file(fs_handle);

                FILE_LIMIT_FALSE_RETURN(STR_FMGR_INVALID_FORMAT);
            }

            DRM_close_file(fs_handle);
        }

        if ((check_file_size != 0) && (file_size > (check_file_size * 1024)))
        {
            mmi_ucs2ncpy(
                g_fmgr_file_limit_error_str,
                (PS8) (GetString(STR_ID_FMGR_FILE_LIMIT_FILE_TOO_LARGE)),
                FILE_LIMIT_ERROR_STR_LEN);

            /* avoid overflow - force have EOS */
            g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 1] = 0;
            g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 2] = 0;

            return FALSE;
        }

         /*******************************************/
        /* Vdieo info checking  (width/height/dur) */
         /*******************************************/
        result = mdi_video_ply_open_clip_file(filename, &vdo_info);

        if (result < 0)
        {
            FILE_LIMIT_FALSE_RETURN(STR_FMGR_INVALID_FORMAT);
        }
        else
        {
            mdi_video_ply_close_clip_file();
        }

        if ((check_duration != 0) && (vdo_info.total_time_duration / 1000 > check_duration))
        {
            mmi_ucs2ncpy(
                g_fmgr_file_limit_error_str,
                (PS8) (GetString(STR_ID_FMGR_FILE_LIMIT_VIDEO_TOO_LONG)),
                FILE_LIMIT_ERROR_STR_LEN);

            /* avoid overflow - force have EOS */
            g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 1] = 0;
            g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 2] = 0;

            return FALSE;
        }

        if (((check_image_width != 0) && (vdo_info.width > check_image_width)) ||
            ((check_image_height != 0) && (vdo_info.height > check_image_height)))
        {
            mmi_ucs2ncpy(
                g_fmgr_file_limit_error_str,
                (PS8) (GetString(STR_ID_FMGR_FILE_LIMIT_VIDEO_TOO_LARGE)),
                FILE_LIMIT_ERROR_STR_LEN);

            /* avoid overflow - force have EOS */
            g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 1] = 0;
            g_fmgr_file_limit_error_str[FILE_LIMIT_ERROR_BUF_SIZE - 2] = 0;

            return FALSE;
        }

        /* pass all */
        return TRUE;

    #else /* __MMI_VIDEO_PLAYER__ */ 
        FILE_LIMIT_FALSE_RETURN(STR_FMGR_INVALID_FORMAT);
        return FALSE;
    #endif /* __MMI_VIDEO_PLAYER__ */ 

    }

    return TRUE;

}

U16 mmi_fmgr_query_custom_icon(BOOL is_large, U16 filetype, U16 grouptype, S8* filepath)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_SWFLASH__
    if(grouptype == FMGR_TYPE_GRP_SWFLASH && !is_large)
    {
        FMGR_FILTER filter;
        U16 image_id = 0;
        S32 downloaded = 0;
        S32 category = 0;

        FMGR_FILTER_INIT(&filter);
        FMGR_FILTER_SET(&filter, filetype);

        category = mmi_swflash_get_category(filepath, &downloaded,&filter);
        switch (category)
        {
        case 1:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT1_PL : IMG_ID_SWFLASH_CAT1_DL);
            break;
        case 2:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT2_PL : IMG_ID_SWFLASH_CAT2_DL);
            break;
        case 3:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT3_PL : IMG_ID_SWFLASH_CAT3_DL);
            break;
        case 4:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT4_PL : IMG_ID_SWFLASH_CAT4_DL);
            break;
        case 5:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT5_PL : IMG_ID_SWFLASH_CAT5_DL);
            break;
        case 6:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT6_PL : IMG_ID_SWFLASH_CAT6_DL);
            break;
        case 7:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT7_PL : IMG_ID_SWFLASH_CAT7_DL);
            break;
        case 8:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT8_PL : IMG_ID_SWFLASH_CAT8_DL);
            break;
        case 9:
            image_id = (downloaded ? IMG_ID_SWFLASH_CAT9_PL : IMG_ID_SWFLASH_CAT9_DL);
            break;
        default:
            image_id = IMG_ID_FMGR_ICON_FILE_TYPE_UNKNOWN;
            break;
        }
        return image_id;
    }
#endif

    return is_large ? IMG_ID_FMGR_FILE_TYPE_UNKNOWN : IMG_ID_FMGR_ICON_FILE_TYPE_UNKNOWN;
}



