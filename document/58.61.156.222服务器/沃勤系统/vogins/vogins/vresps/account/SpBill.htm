<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<TITLE>sp结算</TITLE>
	<meta http-equiv="Pragma" content="no-cache">
	<link rel="stylesheet" type="text/css" href="../css/jwdf_main.css">
	<link rel="stylesheet" type="text/css" href="../css/jwdf_swin.css">
	<link rel="stylesheet" type="text/css" href="../css/jwdf_cal.css">
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_util.js"></SCRIPT>
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_xml.js"></SCRIPT>
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_view.js"></SCRIPT>
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_swin.js"></SCRIPT>
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_cal.js"></SCRIPT>
	<script language=javascript>

			var cur_spid = "";
			var year = "";
			var month = "";
			<!------------------选择SP---------------------------->
			var spwindow = new SimpleWindow();

			function assignSp(){
				year = "";
		        month = "";
				if(SearchForm.Year.value==""){
			           alert("请选择结算年份！")
			           return false;  
			    }
		        year = SearchForm.Month.value;
		        month = SearchForm.Year.value;
			}
			
			function showSp(){
				if(SearchForm.Month.value==""){
		           alert("请选择结算月份！")
		           return false;  
		        }
		        if(SearchForm.Year.value==""){
		           alert("请选择结算年份！")
		           return false;  
		        }
		        year = "";
		        month = "";
		        year = SearchForm.Month.value;
		        month = SearchForm.Year.value;
		        
				spwindow.Create('sp_window','选择SP',600,400,spHTML);
				spwindow.Show();
				listPageURL.put('splist','../GetUNCleBillSP.do?Year='+year+'&Month='+month+'&index=#index#');
				openPage('splist','1');
			}
		
			function selectSP(){
				if(listCurrentKey.get('splist') == ""){
					alert("没有选择SP！");
					return;
				}else{
					sendG("../GetFeeInfo.do?SPId="+listCurrentKey.get('splist'),getPDetail);
				}
			}

			function getPDetail(cartXML){
				var cart = cartXML.getElementsByTagName("result")[0];
				var code = cart.getElementsByTagName("code")[0].firstChild.nodeValue;
				var detail = cart.getElementsByTagName("detail")[0];
				var fields = detail.getElementsByTagName("field");
				for(i=0;i<fields.length;i++){
					var name = fields[i].getElementsByTagName("name")[0].firstChild.nodeValue;
					var value = "";
					if(fields[i].getElementsByTagName("value")[0].firstChild != null){
						value = fields[i].getElementsByTagName("value")[0].firstChild.nodeValue;
					}
					if(name == "编号"){
						cur_spid = value;
						SearchForm.SelSp.value = value;
					}
					if(name == "公司名称"){
						SearchForm.SelSpText.value = value;
					}
				}
				spwindow.Close();
			}

		<!-----------------------------显示查询结果---------------------------------->
	      function BillQuery(){
	         if(SearchForm.Month.value==""){
	            alert("请选择结算月份！")
	            return false;  
	         }
	         if(SearchForm.Year.value==""){
	            alert("请选择结算年份！")
	            return false;  
	         }
	         listPageURL.put('billlist','../SpBillQuery.do?'+getP(SearchForm)+'&index=#index#');
			 openPage('billlist','1');
	         
	      }
	      
	      function showBill(){
	         if(SearchForm.Month.value==""){
	            alert("请选择结算月份！")
	            return false;  
	         }
	         if(SearchForm.Year.value==""){
	            alert("请选择结算年份！")
	            return false;  
	         }
	         if(SearchForm.BillMoney.value=""){
	           alsert("请输入结算金额");
	           return falss;
	         } 
	         sendP("../SpBill.do",getP(SearchForm),billResult);   
	         
	      }
	      function billResult(){
	        openPage('billlist',listIndex.get('billlist'));
	      
	      }


	      <!---------------------------SP查询列表---------------------------------->
			function searchBySP(){
				listIndex.put('splist','1');
				var spName = SearchBySP.value;
				listPageURL.put('splist','../GetSPListBySP.do?SPName='+encodeURIComponent(spName)+'&index=#index#');
				listDetailURL.put('splist','');
				listCurrentId.put('splist','');
				listCurrentKey.put('splist','');
				listDetailWidth.put('splist','400');
				listDetailHeight.put('splist','300');
				listListXSL.put('splist','../xsl/jwdf_list.xsl');
				listDblClickEvent.put('splist',selectSP);
				openPage('splist','1');
			}

	      
		<!------------------页面初始化---------------------->
		var updateHTML = "";
		var spHTML = "";
		
		function init(){
			spHTML = document.all["tb_sp"].innerHTML;
			document.all["tb_sp"].innerHTML = "";
			
			initList();
		}

		function initList(){
			listIndex.put('billlist','1');
			listPageURL.put('billlist','');
			listDetailURL.put('billlist','../GetSPBillInfo.do?SPId=#id#');
			listCurrentId.put('billlist','');
			listCurrentKey.put('billlist','');
			listDetailWidth.put('billlist','400');
			listDetailHeight.put('billlist','300');
			listListXSL.put('billlist','../xsl/jwdf_list.xsl');
			listDetailXSL.put('billlist','../xsl/jwdf_sdetail.xsl');

			listIndex.put('splist','1');
			//listPageURL.put('splist','../GetFeeList.do?index=#index#');
			listDetailURL.put('splist','');
			listCurrentId.put('splist','');
			listCurrentKey.put('splist','');
			listDetailWidth.put('splist','300');
			listDetailHeight.put('splist','320');
			listListXSL.put('splist','../xsl/jwdf_list.xsl');
			listDetailXSL.put('splist','');
			listDblClickEvent.put('splist',selectSP);
		}
		<!------------------------------------------------------------->
	</script>
</head>

<body onload="init();">
	<!-- 页面标题 -->
	<table class="table_pagetitle" border="0" cellspacing="0" cellpadding="0" align="center">
	<tr>
		<td class="td_pagetitle" valign="middle">SP结算</td>
	</tr>
	</table>
	<!-- <select name="SelSp"><option value="0">全部</option></select> -->
	<!-- 结算条件 -->
	<table width="90%" border="0" cellspacing="0" cellpadding="0" align="center">
	<tr><td height="5"></td></tr>
	<tr>
		<td valign="middle" style="font-size:9pt;color:#4796ee;">
			<form method="POST" name="SearchForm" class="edit">
			<b>结算条件：</b><br/>年份：<input class="input_edit" type="text" name="Year" style="width:80;" value="">年

			&nbsp;&nbsp;&nbsp;&nbsp;月份：<select name="Month"  onchange="assignSp();"><option value="01">01月</option>
			                                         <option value="02">02月</option>
			                                         <option value="03">03月</option>
			                                         <option value="04">04月</option>
			                                         <option value="05">05月</option>
			                                         <option value="06">06月</option>
			                                         <option value="07">07月</option>
			                                         <option value="08">08月</option>
			                                         <option value="09">09月</option>
			                                         <option value="10">10月</option>
			                                         <option value="11">11月</option>
			                                         <option value="12">12月</option>
			                    </select>
			    &nbsp;&nbsp;
			    本月未结算的SP：<input type="text" class="input_edit"  name="SelSpText" readonly>
				<input type="hidden" name="SelSp">
				<a href="#" onclick="showSp();"><img src="../buttons/select_001.gif" width="48" height="18" border="0" align="middle" vspace="0" /></a>
			 <br/> 实际结算额：<input class="input_edit" type="text" name="BillMoney" style="width:80;" value="">元

			<b>　　</b>备注：<input class="input_edit" type="text" name="Remark" style="width:80;" value="">
			<b>　　             </b>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#" onclick="showBill();"><img src="../buttons/balance_001.gif" width="68" height="18" border="0" align="top" vspace="1" /></a>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#" onclick="BillQuery();"><img src="../buttons/search_001.gif" width="48" height="18" border="0" align="top" vspace="1" /></a>
			</form>
		</td>
	</tr>
	<tr><td height="5"></td></tr>
	</table>

	<!-- 结算列表显示区域 -->
	<div align="center" id="billlist" style="width:100%; overflow-x:auto; overflow-y:auto; scrollbar-face-color:#efebef;">
	</div>

</body>
	<!-- 手机厂商列表显示区域 -->
	<div id="tb_sp" class="datainfo">
		<table width="90%" border="0" cellspacing="0" cellpadding="0" align="center">
			<tr>
				<td class="td_buttonbar" valign="middle" style="font-size:9pt;">搜索SP：
					<input type="text" class="input_edit"  name="SearchSPBySPName">
					<a href="#" onclick="searchSPBySPName();"><img src="../buttons/search_003.gif" width="48" height="18" border="0" align="top" vspace="1" /></a>
				</td>
			</tr>
		</table>
		<div align="center" id="splist" style="width:100%; overflow-x:auto; overflow-y:auto; scrollbar-face-color:#efebef;">
		</div>
	</div>
</html>
