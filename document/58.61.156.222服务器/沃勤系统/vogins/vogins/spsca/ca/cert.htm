<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<TITLE>证书管理</TITLE>
	<meta http-equiv="Pragma" content="no-cache">
	<link rel="stylesheet" type="text/css" href="../css/jwdf_main.css">
	<link rel="stylesheet" type="text/css" href="../css/jwdf_swin.css">
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_util.js"></SCRIPT>
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_xml.js"></SCRIPT>
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_view.js"></SCRIPT>
	<SCRIPT language="JavaScript" type="text/javascript" src="../js/jwdf_swin.js"></SCRIPT>
	<script language=javascript>

	var cur_countrycode = "";

	<!------------------显示CP选择窗口---------------------------->
			var cpwindow = new SimpleWindow();
			function showCP(){
				cpwindow.Create('cp_window','选择国家/地区',500,400,cpHTML);
				cpwindow.Show();
				openPage('cplist','1');
			}

			//选择收费渠道
			function selectCP(){
				if(listCurrentKey.get('cplist') == ""){
					alert("没有选择国家/地区！");
					return;
				}else{
					document.all["apptitle"].innerHTML = "证书列表（" + listCurrentKey.get('cplist') + "）";
					cur_countrycode = listCurrentKey.get('cplist');
					cpwindow.Close();
					listPageURL.put('certlist','../GetCertList.do?CountryCode='+cur_countrycode);
					openPage('certlist','1');
				}
			}
	<!------------------------------------------------------------->
		
<!--------------------添加证书------------------------------>
		var newwindow = new SimpleWindow();
		function showNew(){
			newwindow.Create('new_window','添加证书',280,165,newHTML);
			newwindow.Show();
		}
		function newCancel(){
			newwindow.Close();
		}
		function newSubmit(){
			if(NewCert.CertId.value == ""){
				alert("请输入证书编号！");
				NewCert.CertId.focus();
				return false;
			}
			if(NewCert.ReleaseTime.value == ""){
				alert("请输入证书发放时间！");
				NewCert.ReleaseTime.focus();
				return false;
			}
			if(NewCert.ExpireTime.value == ""){
				alert("请输入证书过期时间！");
				NewCert.ExpireTime.focus();
				return false;
			}
			NewCert.CountryCode.value = cur_countrycode;
			sendP("../AddCert.do",getP(NewCert),newResult);
		}
		function newResult(){
			newwindow.Close();
			openPage('certlist',listIndex.get('certlist'));
		}
<!------------------------------------------------------------->
		
<!--------------------修改证书------------------------------>
		var updatewindow = new SimpleWindow();
		function showUpdate(){
			if(listCurrentKey.get('certlist')==""){
				alert("请先指定要修改的证书！");
				return;
			}else{
				updatewindow.Create('update_window','修改证书',280,165,updateHTML);
				updatewindow.Show();
				sendG("../GetCertInfo.do?RecId="+listCurrentKey.get('certlist'),getUpdate);
			}
		}
		function updateCancel(){
			updatewindow.Close();
		}
		function getUpdate(cartXML){
			var cart = cartXML.getElementsByTagName("result")[0];
			var code = cart.getElementsByTagName("code")[0].firstChild.nodeValue;
			var detail = cart.getElementsByTagName("detail")[0];
			var fields = detail.getElementsByTagName("field");
			for(i=0;i<fields.length;i++){
				var name = fields[i].getElementsByTagName("name")[0].firstChild.nodeValue;
				var value = "";
				if(fields[i].getElementsByTagName("value")[0].firstChild != null){
					value = fields[i].getElementsByTagName("value")[0].firstChild.nodeValue;
				}
				if(name == "编号") UpdateCert.RecId.value = value;
				if(name == "证书编号") UpdateCert.CertId.value = value;
				else if(name == "发放时间") UpdateCert.ReleaseTime.value = value;
				else if(name == "过期时间") UpdateCert.ExpireTime.value = value;
				else if(name == "备注") UpdateCert.Remark.value = value;
			}
		}
		function updateResult(){
			updatewindow.Close();
			openPage('certlist',listIndex.get('certlist'));
		}
		function updateSubmit(){
			if(UpdateCert.ReleaseTime.value == ""){
				alert("请输入证书发放时间！");
				UpdateCert.ReleaseTime.focus();
				return false;
			}
			if(UpdateCert.ExpireTime.value == ""){
				alert("请输入证书过期时间！");
				UpdateCert.ExpireTime.focus();
				return false;
			}
			sendP("../UpdateCert.do",getP(UpdateCert),updateResult);
		}
<!------------------------------------------------------------->
		
<!--------------------删除证书----------------------------->
		function deleteObj(){
			if(listCurrentKey.get('certlist')==""){
				alert("请首先选择要停用的证书！");
				return;
			}else{
				if(confirm("确认要停用该证书吗？")){
					sendG("../DeleteCert.do?RecId="+listCurrentKey.get('certlist'),deleteResult);
				}
			}
		}
		function deleteResult(){
			openPage('certlist',listIndex.get('certlist'));
		}
<!------------------------------------------------------------->

<!------------------页面初始化---------------------->
		var newHTML = "";
		var updateHTML = "";
		var cpHTML = "";
		function init(){
			newHTML = document.all["tb_new"].innerHTML;
			document.all["tb_new"].innerHTML = "";
			updateHTML = document.all["tb_update"].innerHTML;
			document.all["tb_update"].innerHTML = "";

			cpHTML = document.all["tb_cp"].innerHTML;
			document.all["tb_cp"].innerHTML = "";
			
			initList();
		}
		
		function initList(){
			listIndex.put('certlist','1');
			listPageURL.put('certlist','');
			listDetailURL.put('certlist','../GetCertInfo.do?RecId=#id#');
			listCurrentId.put('certlist','');
			listCurrentKey.put('certlist','');
			listDetailWidth.put('certlist','350');
			listDetailHeight.put('certlist','265');
			listListXSL.put('certlist','../xsl/jwdf_listnopage.xsl');
			listDetailXSL.put('certlist','../xsl/jwdf_sdetail.xsl');

			listIndex.put('cplist','1');
			listPageURL.put('cplist','../GetCountryList.do?index=#index#');
			listDetailURL.put('cplist','');
			listCurrentId.put('cplist','');
			listCurrentKey.put('cplist','');
			listDetailWidth.put('cplist','300');
			listDetailHeight.put('cplist','320');
			listListXSL.put('cplist','../xsl/jwdf_list.xsl');
			listDetailXSL.put('cplist','');
			listDblClickEvent.put('cplist',selectCP);
		}
<!------------------------------------------------------------->
	</script>
</head>

<body onload="init();">
	<!-- 页面标题 -->
	<table class="table_pagetitle" border="0" cellspacing="0" cellpadding="0">
		<tr>
			<td class="td_pagetitle" valign="middle">证书管理</td>
		</tr>
	</table>

	<!-- 选择的内容提供商 -->
	<table width="90%" border="0" cellspacing="0" cellpadding="0" align="center">
	<tr>
		<td width="120" class="td_buttonbar" valign="middle" style="font-size:9pt;">
			<input type="button"  value="选择国家/地区" onclick="showCP();" class="button" onmouseover="this.className='buttonover';"  onmouseout="this.className='button';">
		</td>
		<td id="apptitle" class="td_buttonbar" valign="middle" style="font-size:9pt;">证书列表（）</td>
	</tr>
	</table>
	
	<!-- 操作按钮 -->
	<table align="center" width="90%" border="0" cellspacing="0" cellpadding="0" align="center">
		<tr>
			<td class="td_buttonbar" valign="middle">
				&nbsp;<input type="button"  value="新建" onclick="showNew();" class="button" style="width:40;" onmouseover="this.className='buttonover';"  onmouseout="this.className='button';">&nbsp;&nbsp;
				<input type="button"  value="修改" onclick="showUpdate();" class="button" style="width:40;" onmouseover="this.className='buttonover';"  onmouseout="this.className='button';">&nbsp;&nbsp;
				<input type="button"  value="停用" onclick="deleteObj();" class="button" style="width:40;" onmouseover="this.className='buttonover';"  onmouseout="this.className='button';">
			</td>
		</tr>
	</table>

	<!-- 角色列表显示区域 -->
	<div align="center" id="certlist" style="width:100%; overflow-x:auto; overflow-y:auto; scrollbar-face-color:#efebef;"></div>
	
	<!-- 添加角色表单 -->
	<div align="center" id="tb_new">
		<table class="table_edit" cellpadding="0" cellspacing="1" align="center">
		<form method="POST" name="NewCert" class="editform">
			<input type="hidden" name="CountryCode" value="">
		<tr>
			<td class="td_edittitle" width="25%">证书编号</td>
			<td class="td_editcontent" width="75%">
				<select name="CertId">
					<option value="0">0</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
					<option value="13">13</option>
					<option value="14">14</option>
					<option value="15">15</option>
				</select>
			</td>
		</tr>
		<tr>
			<td class="td_edittitle">发放时间</td>
			<td class="td_editcontent"><input class="input_edit" style="width:100%;" type="text" name="ReleaseTime"></td>
		</tr>
		<tr>
			<td class="td_edittitle">过期时间</td>
			<td class="td_editcontent"><input class="input_edit" style="width:100%;" type="text" name="ExpireTime"></td>
		</tr>
		<tr>
			<td class="td_edittitle">备注</td>
			<td class="td_editcontent"><textarea class="input_textarea" name="Remark"></textarea></td>
		</tr>
		</form>
		<tr>
			<td class="td_editbutton" colspan="2">
				<input type="button"  value="确认" onclick="newSubmit();" class="button" onmouseover="this.className='buttonover';"  onmouseout="this.className='button';">&nbsp;&nbsp;
				<input type="button"  value="取消" onclick="newCancel();" class="button" onmouseover="this.className='buttonover';"  onmouseout="this.className='button';">
			</td>
		</tr>
		</table>
	</div>

	<!-- 修改角色表单 -->
	<div align="center" id="tb_update">
		<table class="table_edit" cellpadding="0" cellspacing="1" align="center">
		<form method="POST" name="UpdateCert" class="editform">
			<input type="hidden" name="RecId" value="">
		<tr>
			<td class="td_edittitle" width="25%">证书编号</td>
			<td class="td_editcontent" width="75%"><input class="input_edit" readonly style="width:100%;" type="text" name="CertId"></td>
		</tr>
		<tr>
			<td class="td_edittitle">发放时间</td>
			<td class="td_editcontent"><input class="input_edit" style="width:100%;" type="text" name="ReleaseTime"></td>
		</tr>
		<tr>
			<td class="td_edittitle">过期时间</td>
			<td class="td_editcontent"><input class="input_edit" style="width:100%;" type="text" name="ExpireTime"></td>
		</tr>
		<tr>
			<td class="td_edittitle">备注</td>
			<td class="td_editcontent"><textarea class="input_textarea" name="Remark"></textarea></td>
		</tr>
		</form>
		<tr>
			<td class="td_editbutton" colspan="2">
				<input type="button"  value="确认" onclick="updateSubmit();" class="button" onmouseover="this.className='buttonover';"  onmouseout="this.className='button';">&nbsp;&nbsp;
				<input type="button"  value="取消" onclick="updateCancel();" class="button" onmouseover="this.className='buttonover';"  onmouseout="this.className='button';">
			</td>
		</tr>
		</table>
	</div>
	
		<!-- cp列表显示区域 -->
	<div id="tb_cp" class="datainfo">
		<div align="center" id="cplist" style="width:100%; overflow-x:auto; overflow-y:auto; scrollbar-face-color:#efebef;">
		</div>
	</div>
	
</body>

</html>
